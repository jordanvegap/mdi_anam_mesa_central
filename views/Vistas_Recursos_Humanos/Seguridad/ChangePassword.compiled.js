$(function(){function h(){}window.DnaMdiPswd=new h;localStorage.setItem("__isLogin",!1);h.changePasswordModel=function(){var b=this,l=new Date,f=$("#loadPanel").dxLoadPanel({hideOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",showIndicator:!0,showPane:!0,shading:!0,visible:!1}).dxLoadPanel("instance");b.__Clave_Empresa="";b.__Logotipo_Empresa="";b.subdomain=window.location.host.split(".")[1]?window.location.host.split(".")[0]:!1;b.TimeZoneServidor="Etc/GMT";b.TimeZoneEmpleado="Etc/GMT";b.tokenSystem=
"";b.init=function(){Globalize.loadMessages(dictionary);var e=function(){var c=sessionStorage.getItem("locale");return null!=c?c:"es"}();Globalize.locale(e);DevExpress.localization.locale(e);b.__Logotipo_Empresa=subdomains_config[b.subdomain].__Logotipo_Empresa;b.__Clave_Empresa=subdomains_config[b.subdomain].__Clave_Empresa;setTimeout(()=>{b._RunLogin(locales,e)},1E3);ErrorDB.abrirDB().then(function(c){console.log(c)}).catch(function(c){console.error(c)})};b.convertDate=function(e){function c(a){return 10>
a?"0"+a:a}e=new Date(e);return[c(e.getDate()),c(e.getMonth()+1),e.getFullYear()].join("/")};b._RunLogin=function(e,c){moment.tz.zonesForCountry("MX");sessionStorage.setItem("locale",c);$("#VersionCodeLogin").html("VERSI\u00d3N: "+getJSON(DeveloperType).VersionCode);document.getElementById("Logo_Des").style.backgroundImage="url('images/Logotipos/"+b.__Logotipo_Empresa+"/logo.svg')";$("#Fecha").html(b.convertDate(l));$("#txt_EstatusSession_new").html(Globalize.formatMessage("LoadText"));f.hide();b.BarraUsuarios=
$("#Barra_Usuarios").dxToolbar({onContentReady:function(){b.btn_Salvar_Modifica_Usuario.option("visible",!0)},items:[{location:"center",widget:"dxButton",locateInMenu:"auto",options:{icon:"save",text:"Cambiar contrase\u00f1a",type:"success",onInitialized:function(a){b.btn_Salvar_Modifica_Usuario=a.component},onClick(){b.ActualizaDatosUsuario()}}}]}).dxToolbar("instance");$("#strength-indicator").dxLinearGauge({scale:{startValue:0,endValue:100,tickInterval:25},title:{text:"Fortaleza de contrase\u00f1a",
font:{size:11}},rangeContainer:{palette:"pastel",width:4,ranges:[{startValue:0,endValue:25,color:"#f44336"},{startValue:25,endValue:50,color:"#FF853A"},{startValue:50,endValue:75,color:"#EDE100"},{startValue:75,endValue:100,color:"#00AA13"}]}});b.__Frm_Usuario_Psw=$("#__Frm_Usuario").dxForm({readOnly:!1,showColonAfterLabel:!0,showValidationSummary:!1,validationGroup:"Validacion_Frm_Usuario",colCount:"auto",labelLocation:"top",colCountByScreen:{md:6},screenByWidth(a){return"md"},items:[{dataField:"USU_PASSWORD",
label:{text:"Contrase\u00f1a"},editorType:"dxTextBox",colSpan:6,editorOptions:{valueChangeEvent:"keyup",onValueChanged:function(a){a=a.value;var d=$("#strength-indicator").dxLinearGauge("instance");if(0===a.length)d.value(0);else if(validatePassword(a))d.value(100);else{var g=0;8<=a.length&&(g+=25);/[A-Z]/.test(a)&&(g+=25);/\d/.test(a)&&(g+=25);/[@$!%*#?&]/.test(a)&&(g+=25);d.value(g)}},mode:"password"},validationRules:[{type:"custom",validationCallback:function(a){return validatePassword(a.value)?
!0:!1},message:"La contrase\u00f1a debe tener al menos una letra may\u00fascula, un n\u00famero y un s\u00edmbolo, sin espacios y con un m\u00ednimo de 8 d\u00edgitos."}]},{dataField:"USU_PASSWORD_CONFIRMA",label:{text:"Confirmar contrase\u00f1a"},editorType:"dxTextBox",colSpan:6,editorOptions:{mode:"password",valueChangeEvent:"change",onValueChanged:function(a){f.show();null!=a.value&&""!=a.value&&(a={USU_PASSWORD:a.value},__Reques_ajax(getJSON(DeveloperType).ApiGeneral.url+"CodificaPsw","GET",a,
getJSON(DeveloperType).ApiGeneral.token).then(d=>{1==d.success?$("#__Frm_Usuario").dxForm("instance").getEditor("USU_PASSWORD_CRYPTO").option("value",d.JsonData):DevExpress.ui.notify({message:"Error en comunicaci\u00f3n con codificadores",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"});f.hide()}).catch(function(d){f.hide();DevExpress.ui.notify({message:"Error en comunicaci\u00f3n con servidores",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",
direction:"up-push"})}))}},validationRules:[{type:"compare",comparisonTarget(){const a=$("#__Frm_Usuario").dxForm("instance").getEditor("USU_PASSWORD");return a?a.option("value"):null},message:"'Contrase\u00f1a' y 'Confirmar contrase\u00f1a' no coinciden."},{type:"stringLength",min:8,message:"Minimo 8 caracteres"},{type:"required",message:"requerido"},{type:"stringLength",max:30,message:"Maximo 30 caractres"}]},{dataField:"USU_PASSWORD_CRYPTO",label:{text:"Crypto"},cssClass:"hidden_box",editorType:"dxTextBox",
colSpan:6,editorOptions:{valueChangeEvent:"keyup",mode:"password"},validationRules:[{type:"stringLength",min:4,message:"Minimo 8 caracteres"},{type:"required",message:"requerido"}]}]}).dxForm("instance");b.ActualizaDatosUsuario=function(){f.show();var a={},d=b.__Frm_Usuario_Psw.option("formData"),g=moment().tz(b.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss");1==b.__Frm_Usuario_Psw.validate().isValid?(delete d.USU_PASSWORD,delete d.USU_PASSWORD_CONFIRMA,a.AUDITORIA_FEC_ULT_MOD=g,a.USU_PASSWORD=d.USU_PASSWORD_CRYPTO,
a={EMP_CLV_EMPRESA:"ANAM",Type:"Pru",EMP_CSC_EMPRESA_HOST:1,TokenSystem:getUrlParam("idTokenSystem"),DATA_UPDATE:a},__Reques_ajax(getJSON(DeveloperType).ApiGeneral.url+"updateChangePswd","POST",JSON.stringify(a),getJSON(DeveloperType).ApiGeneral.token).then(k=>{1==k.success?(f.hide(),DevExpress.ui.notify({message:"Contrase\u00f1a cambiada correctamente, puede cerrar esta ventana",minWidth:150,type:"success",displayTime:15E3},{position:"bottom right",direction:"up-push"}),b.btn_Salvar_Modifica_Usuario.option("visible",
!1)):f.hide()}).catch(function(k){f.hide();DevExpress.ui.notify({message:"Error en comunicaci\u00f3n con servidores",minWidth:150,type:"error",displayTime:1E4},{position:"bottom right",direction:"up-push"})})):(f.hide(),DevExpress.ui.notify({message:"Llene los campos en rojo",minWidth:150,type:"error",displayTime:1E4},{position:"bottom right",direction:"up-push"}))};setTimeout(function(){$("#splashscreen").fadeOut(1E3)},2E3)}};h.currentModel=new h.changePasswordModel;h.currentModel.init()});
