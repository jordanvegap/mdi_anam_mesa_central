SalesDashboard.dashboardModel=function(){var b=this,e=$("#loadPanel").dxLoadPanel({hideOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",showIndicator:!0,showPane:!0,shading:!0,visible:!0}).dxLoadPanel("instance");b.patname=window.location.pathname;b.TimeZoneServidor=localStorage.getItem("tmzServidor");b.TimeZoneEmpleado=localStorage.getItem("tmzEmpleado");b.TiempoUTCEmpleado=DiferencieTimeZones();b.IdEmpleado=null;b.TpoUsuario=null;b.DatosUsuariosPsw=null;b.obj_DatosEmpleado=null;b.init=function(){$("#splashscreen").fadeOut(1E3);
Globalize.loadMessages(dictionary);var c=function(){var a=sessionStorage.getItem("locale");return null!=a?a:"es"}();Globalize.locale(c);DevExpress.localization.locale(c);c=decrypt(localStorage.getItem("DatosEncriptados"));b.obj_DatosEmpleado=JSON.parse(c);$("#strength-indicator").dxLinearGauge({scale:{startValue:0,endValue:100,tickInterval:25},title:{text:"Fortaleza de contrase\u00f1a",font:{size:11}},rangeContainer:{palette:"pastel",width:4,ranges:[{startValue:0,endValue:25,color:"#f44336"},{startValue:25,
endValue:50,color:"#FF853A"},{startValue:50,endValue:75,color:"#EDE100"},{startValue:75,endValue:100,color:"#00AA13"}]}});e.hide();b.IdEmpleado=getUrlParam("idemp");b.TpoUsuario=getUrlParam("TpoUsuario");b.BarraUsuarios=$("#Barra_Usuarios").dxToolbar({onContentReady:function(){$btn_Alta_Usuario.option("visible",!0);$btn_Modificar_Usuario.option("visible",!0);$btn_Salvar_Alta_Usuario.option("visible",!1);$btn_Salvar_Modifica_Usuario.option("visible",!1);$btn_Cancelar_Alta_Usuario.option("visible",
!1);$btn_Cancelar_Modificar_Usuario.option("visible",!1)},items:[{location:"before",widget:"dxButton",locateInMenu:"auto",options:{icon:"plus",text:"Alta",type:"default",onInitialized:function(a){$btn_Alta_Usuario=a.component},onClick(){$btn_Alta_Usuario.option("visible",!1);$btn_Modificar_Usuario.option("visible",!1);$btn_Cancelar_Alta_Usuario.option("visible",!0);$btn_Salvar_Alta_Usuario.option("visible",!0);b.__Frm_Usuario_Psw.resetValues();b.__Frm_Usuario_Psw.option("readOnly",!1);b.__Frm_Usuario_Psw.getEditor("NEWID").option("value",
createUUID(36));b.__Frm_Usuario_Psw.getEditor("EMPLEADO_CSC_EMPLEADO").option("value",b.IdEmpleado)}}},{location:"before",widget:"dxButton",locateInMenu:"auto",options:{icon:"save",text:"Salvar Alta",type:"success",onInitialized:function(a){$btn_Salvar_Alta_Usuario=a.component},onClick(){b.onClickAlta_Usuario()}}},{location:"after",widget:"dxButton",locateInMenu:"auto",options:{icon:"clear",text:"Cancelar Alta",type:"danger",onInitialized:function(a){$btn_Cancelar_Alta_Usuario=a.component},onClick(){$btn_Alta_Usuario.option("visible",
!0);$btn_Modificar_Usuario.option("visible",!0);$btn_Cancelar_Alta_Usuario.option("visible",!1);$btn_Salvar_Alta_Usuario.option("visible",!1);b.__Frm_Usuario_Psw.resetValues();b.__Frm_Usuario_Psw.option("readOnly",!0)}}},{location:"after",widget:"dxButton",locateInMenu:"auto",options:{icon:"edit",text:"Modificar",type:"normal",onInitialized:function(a){$btn_Modificar_Usuario=a.component},onClick(){null==b.DatosUsuariosPsw?DevExpress.ui.notify({message:"No ha seleccionado un Usuario",minWidth:150,
type:"info",displayTime:5E3},{position:"bottom right",direction:"up-push"}):($btn_Modificar_Usuario.option("visible",!1),$btn_Alta_Usuario.option("visible",!1),$btn_Salvar_Modifica_Usuario.option("visible",!0),$btn_Cancelar_Modificar_Usuario.option("visible",!0),b.__Frm_Usuario_Psw.option("readOnly",!1))}}},{location:"before",widget:"dxButton",locateInMenu:"auto",options:{icon:"save",text:"Salvar Modifica",type:"success",onInitialized:function(a){$btn_Salvar_Modifica_Usuario=a.component},onClick(){b.ActualizaDatosUsuario()}}},
{location:"after",widget:"dxButton",locateInMenu:"auto",options:{icon:"clear",text:"Cancelar Modificar",type:"danger",onInitialized:function(a){$btn_Cancelar_Modificar_Usuario=a.component},onClick(){$btn_Modificar_Usuario.option("visible",!0);$btn_Salvar_Modifica_Usuario.option("visible",!1);$btn_Cancelar_Modificar_Usuario.option("visible",!1);b.__Frm_Usuario_Psw.resetValues();var a=JSON.stringify(b.DatosUsuariosPsw);b.DatosUsuariosPsw=JSON.parse(a);b.__Frm_Usuario_Psw.updateData(b.DatosUsuariosPsw);
b.__Frm_Usuario_Psw.option("readOnly",!0);null!=b.DatosUsuariosPsw&&$btn_Alta_Usuario.option("visible",!1)}}}]}).dxToolbar("instance");b.__Frm_Usuario_Psw=$("#__Frm_Usuario").dxForm({readOnly:!0,showColonAfterLabel:!0,showValidationSummary:!1,validationGroup:"Validacion_Frm_Usuario",colCount:"auto",labelLocation:"top",colCountByScreen:{md:6},screenByWidth(a){return"md"},items:[{dataField:"NEWID",label:{text:"NEWID"},cssClass:"hidden_box",editorType:"dxTextBox",colSpan:2,editorOptions:{valueChangeEvent:"keyup"},
validationRules:[{type:"stringLength",min:1,message:"Minimo 1 caracteres"},{type:"required",message:"requerido"},{type:"stringLength",max:36,message:"Maximo 36 caractres"}]},{dataField:"USU_CSC_USUARIO",label:{text:"Id. Usuario"},cssClass:"hidden_box",editorType:"dxTextBox",colSpan:2},{dataField:"EMPLEADO_CSC_EMPLEADO",label:{text:"Id. Empleado"},cssClass:"hidden_box",editorType:"dxTextBox",colSpan:2,validationRules:[{type:"stringLength",min:1,message:"Minimo 1 caracteres"},{type:"required",message:"requerido"},
{type:"stringLength",max:36,message:"Maximo 36 caractres"}]},{dataField:"USU_LOGIN",label:{text:"Usuario"},editorType:"dxTextBox",colSpan:4,editorOptions:{valueChangeEvent:"keyup"},validationRules:[{type:"stringLength",min:8,message:"Minimo 8 caracteres"},{type:"required",message:"requerido"},{type:"stringLength",max:100,message:"Maximo 100 caractres"}]},{dataField:"USU_INDICAACTIVO",label:{text:"Activo"},editorType:"dxSwitch",colSpan:2,editorOptions:{switchedOffText:"Inactivo",switchedOnText:"Activo",
width:"100%"}},{dataField:"USU_PASSWORD",label:{text:"Contrase\u00f1a"},editorType:"dxTextBox",colSpan:6,editorOptions:{valueChangeEvent:"keyup",onValueChanged:function(a){a=a.value;var d=$("#strength-indicator").dxLinearGauge("instance");if(0===a.length)d.value(0);else if(validatePassword(a))d.value(100);else{var f=0;8<=a.length&&(f+=25);/[A-Z]/.test(a)&&(f+=25);/\d/.test(a)&&(f+=25);/[@$!%*#?&]/.test(a)&&(f+=25);d.value(f)}},mode:"password"},validationRules:[{type:"custom",validationCallback:function(a){return validatePassword(a.value)?
!0:!1},message:"La contrase\u00f1a debe tener al menos una letra may\u00fascula, un n\u00famero y un s\u00edmbolo, sin espacios y con un m\u00ednimo de 8 d\u00edgitos."}]},{dataField:"USU_PASSWORD_CONFIRMA",label:{text:"Confirmar contrase\u00f1a"},editorType:"dxTextBox",colSpan:6,editorOptions:{mode:"password",valueChangeEvent:"change",onValueChanged:function(a){e.show();null!=a.value&&""!=a.value&&(a={USU_PASSWORD:a.value},__Reques_ajax(getJSON(DeveloperType).ApiGeneral.url+"CodificaPsw","GET",a,
getJSON(DeveloperType).ApiGeneral.token).then(d=>{1==d.success?$("#__Frm_Usuario").dxForm("instance").getEditor("USU_PASSWORD_CRYPTO").option("value",d.JsonData):DevExpress.ui.notify({message:"Error en comunicaci\u00f3n con codificadores",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"});e.hide()}).catch(function(d){e.hide();DevExpress.ui.notify({message:"Error en comunicaci\u00f3n con servidores",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",
direction:"up-push"})}))}},validationRules:[{type:"compare",comparisonTarget(){const a=$("#__Frm_Usuario").dxForm("instance").getEditor("USU_PASSWORD");return a?a.option("value"):null},message:"'Contrase\u00f1a' y 'Confirmar contrase\u00f1a' no coinciden."},{type:"stringLength",min:8,message:"Minimo 8 caracteres"},{type:"required",message:"requerido"},{type:"stringLength",max:30,message:"Maximo 30 caractres"}]},{dataField:"USU_PASSWORD_CRYPTO",label:{text:"Crypto"},cssClass:"hidden_box",editorType:"dxTextBox",
colSpan:6,editorOptions:{valueChangeEvent:"keyup",mode:"password"},validationRules:[{type:"stringLength",min:4,message:"Minimo 8 caracteres"},{type:"required",message:"requerido"}]},{dataField:"USU_FECHA_EXPIRA",label:{text:"Fecha de expiraci\u00f3n"},editorType:"dxDateBox",colSpan:6,editorOptions:{type:"datetime",placeholder:"DD/MM/AAAA HH:mm:ss",useMaskBehavior:!0,displayFormat:"dd/MM/yyyy HH:mm:ss"},validationRules:[{type:"required",message:"requerido"}]}]}).dxForm("instance");b.ValidaUsuario({EMPLEADO_CSC_EMPLEADO:b.IdEmpleado})};
b.ValidaUsuario=function(c){c={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),Type:localStorage.getItem("Type"),...c};__Reques_ajax(getJSON(DeveloperType).ApiRecursosHumanos.url+"Get_Usuario","GET",c,getJSON(DeveloperType).ApiRecursosHumanos.token).then(a=>{1==a.success&&(a=a.JsonData[0],a.USU_FECHA_EXPIRA&&(a.USU_FECHA_EXPIRA=moment(a.USU_FECHA_EXPIRA).add(DiferencieTimeZones(),"hours").format("YYYY-MM-DD HH:mm:ss")),a=JSON.stringify(a),
b.DatosUsuariosPsw=JSON.parse(a),b.__Frm_Usuario_Psw.updateData(b.DatosUsuariosPsw),$btn_Alta_Usuario.option("visible",!1))})};b.onClickAlta_Usuario=function(){e.show();var c=moment().tz(b.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss");if(!0===b.__Frm_Usuario_Psw.validate().isValid){var a={},d=b.__Frm_Usuario_Psw.option("formData"),f;for(f in d)d[f]&&(a[f]=d[f]);a.AUDITORIA_USU_ALTA=b.obj_DatosEmpleado.EMPLEADO_CSC_EMPLEADO;a.AUDITORIA_USU_ULT_MOD=b.obj_DatosEmpleado.EMPLEADO_CSC_EMPLEADO;a.EMP_CSC_EMPRESA_HOST=
localStorage.getItem("EMP_CSC_EMPRESA_HOST");a.AUDITORIA_FEC_ALTA=c;a.AUDITORIA_FEC_ULT_MOD=c;a.USU_CODESQUEMASEG=3;a.USU_AUTENTIFICA_REMOTO=1;a.USU_FECHA_EXPIRA&&(a.USU_FECHA_EXPIRA=moment(a.USU_FECHA_EXPIRA).add(CalculaTimeposInsertUpdate(),"hours").format("YYYY-MM-DD HH:mm:ss"));delete a.USU_PASSWORD_CONFIRMA;delete a.USU_PASSWORD_CRYPTO;delete a.USU_PASSWORD;a.USU_PASSWORD=d.USU_PASSWORD_CRYPTO;c={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),Type:localStorage.getItem("Type"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),
DATA_INSERT:a};__Reques_ajax(getJSON(DeveloperType).ApiRecursosHumanos.url+"Insert_Usuario","POST",JSON.stringify(c),getJSON(DeveloperType).ApiRecursosHumanos.token).then(g=>{1==g.success?(e.hide(),DevExpress.ui.notify({message:"Empleado insertado correctamente",minWidth:150,type:"success",displayTime:5E3},{position:"bottom right",direction:"up-push"}),$btn_Alta_Usuario.option("visible",!0),$btn_Modificar_Usuario.option("visible",!0),$btn_Salvar_Alta_Usuario.option("visible",!1),$btn_Salvar_Modifica_Usuario.option("visible",
!1),$btn_Cancelar_Alta_Usuario.option("visible",!1),$btn_Cancelar_Modificar_Usuario.option("visible",!1),b.__Frm_Usuario_Psw.option("readOnly",!0),b.ValidaUsuario({EMPLEADO_CSC_EMPLEADO:b.IdEmpleado})):e.hide()}).catch(function(g){e.hide();DevExpress.ui.notify({message:"Error en comunicaci\u00f3n con servidores",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"})})}else e.hide(),DevExpress.ui.notify({message:"Llene los campos en rojo",minWidth:150,type:"error",
displayTime:5E3},{position:"bottom right",direction:"up-push"})};b.ActualizaDatosUsuario=function(){var c=JSON.stringify(b.DatosUsuariosPsw);b.DatosUsuariosPsw=JSON.parse(c);c=b.__Frm_Usuario_Psw.option("formData");var a=GetUpdateData(b.DatosUsuariosPsw,c),d=0===Object.keys(a).length,f=moment().tz(b.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss");1==b.__Frm_Usuario_Psw.validate().isValid?1==d?DevExpress.ui.notify({message:"No se detecto ningun cambio",minWidth:150,type:"info",displayTime:5E3},{position:"bottom right",
direction:"up-push"}):(a.USU_FECHA_EXPIRA&&(a.USU_FECHA_EXPIRA=moment(a.USU_FECHA_EXPIRA).add(CalculaTimeposInsertUpdate(),"hours").format("YYYY-MM-DD HH:mm:ss")),a.AUDITORIA_FEC_ULT_MOD=f,a.AUDITORIA_USU_ULT_MOD=b.obj_DatosEmpleado.EMPLEADO_CSC_EMPLEADO,delete a.USU_PASSWORD,delete a.USU_PASSWORD_CONFIRMA,delete a.USU_PASSWORD_CRYPTO,a.USU_PASSWORD=c.USU_PASSWORD_CRYPTO,c={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),Type:localStorage.getItem("Type"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),
DATA_UPDATE:a,DATA_WHERE:{EMPLEADO_CSC_EMPLEADO:b.DatosUsuariosPsw.EMPLEADO_CSC_EMPLEADO,NEWID:b.DatosUsuariosPsw.NEWID,USU_CSC_USUARIO:b.DatosUsuariosPsw.USU_CSC_USUARIO,EMP_CSC_EMPRESA_HOST:b.DatosUsuariosPsw.EMP_CSC_EMPRESA_HOST}},console.log(c),__Reques_ajax(getJSON(DeveloperType).ApiRecursosHumanos.url+"Update_Usuario","POST",JSON.stringify(c),getJSON(DeveloperType).ApiRecursosHumanos.token).then(g=>{1==g.success?(e.hide(),DevExpress.ui.notify({message:"Usuario actualizado correctamente",minWidth:150,
type:"success",displayTime:5E3},{position:"bottom right",direction:"up-push"}),$btn_Alta_Usuario.option("visible",!0),$btn_Modificar_Usuario.option("visible",!0),$btn_Salvar_Alta_Usuario.option("visible",!1),$btn_Salvar_Modifica_Usuario.option("visible",!1),$btn_Cancelar_Alta_Usuario.option("visible",!1),$btn_Cancelar_Modificar_Usuario.option("visible",!1),b.__Frm_Usuario_Psw.option("readOnly",!0),b.ValidaUsuario({EMPLEADO_CSC_EMPLEADO:b.IdEmpleado})):e.hide()}).catch(function(g){e.hide();DevExpress.ui.notify({message:"Error en comunicaci\u00f3n con servidores",
minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"})})):DevExpress.ui.notify({message:"Llene los campos en rojo",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"})}};setTimeout(()=>{SalesDashboard.currentModel=new SalesDashboard.dashboardModel;SalesDashboard.currentModel.init()},1E3);
