SalesDashboard.dashboardModel=function(){var a=this,c=$("#loadPanel").dxLoadPanel({hideOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.6)",showIndicator:!0,showPane:!0,shading:!0,visible:!1}).dxLoadPanel("instance");a.IdEmpleado=null;a.TpoUsuario=null;a.IdUsuario=null;a.TimeZoneServidor=localStorage.getItem("tmzServidor");a.TimeZoneEmpleado=localStorage.getItem("tmzEmpleado");a.TiempoUTCEmpleado=DiferencieTimeZones();a.Empleado_Permisos_App=null;a.init=async function(){$("#splashscreen").fadeOut(1E3);
Globalize.loadMessages(dictionary);var d=function(){var b=sessionStorage.getItem("locale");return null!=b?b:"es"}();Globalize.locale(d);DevExpress.localization.locale(d);d=decrypt(localStorage.getItem("DatosEncriptados"));a.obj_DatosEmpleado=JSON.parse(d);a.IdEmpleado=getUrlParam("idemp");a.TpoUsuario=getUrlParam("TpoUsuario");a.IdUsuario=getUrlParam("idusu");$("#__Form_Edita_Permisos_App").dxForm({readOnly:!1,showColonAfterLabel:!0,showValidationSummary:!1,validationGroup:"__Form_Edita_Permisos_App_Validate",
labelMode:"outside",width:"100%",colCount:1,items:[{dataField:"EMPLEADO_DIA_LUNES",editorType:"dxCheckBox",label:{location:"left",alignment:"left",text:"Lunes",width:400},editorOptions:{onOptionChanged:function(b){c.show();a.If_Insert_Or_Update(b.component.option("name"),b.value)}}},{dataField:"EMPLEADO_DIA_MARTES",editorType:"dxCheckBox",label:{location:"left",alignment:"left",text:"Martes"},editorOptions:{onOptionChanged:function(b){c.show();a.If_Insert_Or_Update(b.component.option("name"),b.value)}}},
{dataField:"EMPLEADO_DIA_MIERCOLES",editorType:"dxCheckBox",label:{location:"left",alignment:"left",text:"Miercoles"},editorOptions:{onOptionChanged:function(b){c.show();a.If_Insert_Or_Update(b.component.option("name"),b.value)}}},{dataField:"EMPLEADO_DIA_JUEVES",editorType:"dxCheckBox",label:{location:"left",alignment:"left",text:"Jueves"},editorOptions:{onOptionChanged:function(b){c.show();a.If_Insert_Or_Update(b.component.option("name"),b.value)}}},{dataField:"EMPLEADO_DIA_VIERNES",editorType:"dxCheckBox",
label:{location:"left",alignment:"left",text:"Viernes"},editorOptions:{onOptionChanged:function(b){c.show();a.If_Insert_Or_Update(b.component.option("name"),b.value)}}},{dataField:"EMPLEADO_DIA_SABADO",editorType:"dxCheckBox",label:{location:"left",alignment:"left",text:"Sabado"},editorOptions:{onOptionChanged:function(b){c.show();a.If_Insert_Or_Update(b.component.option("name"),b.value)}}},{dataField:"EMPLEADO_DIA_DOMINGO",editorType:"dxCheckBox",label:{location:"left",alignment:"left",text:"Domingo"},
editorOptions:{onOptionChanged:function(b){c.show();a.If_Insert_Or_Update(b.component.option("name"),b.value)}}}],onInitialized:async function(b){c.show();await a.Refresh_Form();c.hide()}})};a.Refresh_Form=async function(){return await (new Promise((d,b)=>{var f={Type:localStorage.getItem("Type"),EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),EMPLEADO_CSC_EMPLEADO:a.IdEmpleado,EMPLEADO_DIA_ACTIVO:1};__Reques_ajax(getJSON(DeveloperType).ApiRecursosHumanos.url+
"Get_Empleado_Horario_App","GET",f,getJSON(DeveloperType).ApiRecursosHumanos.token).then(async function(e){1==e.success&&(a.Empleado_Permisos_App=e.JsonData[0],$("#__Form_Edita_Permisos_App").dxForm("instance").option("formData",Object.assign({},a.Empleado_Permisos_App)));d("resolve")}).catch(function(e){console.log(e);b(e)})})).catch(function(d){console.log(d);reject(d)})};a.If_Insert_Or_Update=function(d,b){b=b?1:0;if(null==a.Empleado_Permisos_App){var f={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),
Type:localStorage.getItem("Type"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),DATA_INSERT:{EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),EMPLEADO_CSC_EMPLEADO:a.IdEmpleado,EMPLEADO_DIA_DOMINGO:0,EMPLEADO_DIA_LUNES:0,EMPLEADO_DIA_MARTES:0,EMPLEADO_DIA_MIERCOLES:0,EMPLEADO_DIA_JUEVES:0,EMPLEADO_DIA_VIERNES:0,EMPLEADO_DIA_SABADO:0,EMPLEADO_DIA_ACTIVO:1,AUDITORIA_USU_ALTA:a.obj_DatosEmpleado.EMPLEADO_CSC_EMPLEADO,AUDITORIA_USU_ULT_MOD:a.obj_DatosEmpleado.EMPLEADO_CSC_EMPLEADO,
AUDITORIA_FEC_ALTA:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),AUDITORIA_FEC_ULT_MOD:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss")}};f.DATA_INSERT[d]=b;__Reques_ajax(getJSON(DeveloperType).ApiRecursosHumanos.url+"Insert_Empleado_Horario_App","POST",JSON.stringify(f),getJSON(DeveloperType).ApiRecursosHumanos.token).then(async function(e){1==e.success?console.log("Registro Insertado"):console.log("Registro no Insertado");await a.Refresh_Form();c.hide()}).catch(async function(e){console.log(e);
console.log("Registro no Insertado por error de servidor");await a.Refresh_Form();c.hide()})}else a.Empleado_Permisos_App[d]==b?c.hide():(f={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),Type:localStorage.getItem("Type"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),DATA_UPDATE:{AUDITORIA_USU_ULT_MOD:a.obj_DatosEmpleado.EMPLEADO_CSC_EMPLEADO,AUDITORIA_FEC_ULT_MOD:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss")},DATA_WHERE:{EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),
EMPLEADO_CSC_EMPLEADO:a.IdEmpleado,EMPLEADO_DIA_ACTIVO:1}},f.DATA_UPDATE[d]=b,__Reques_ajax(getJSON(DeveloperType).ApiRecursosHumanos.url+"Update_Empleado_Horario_App","POST",JSON.stringify(f),getJSON(DeveloperType).ApiRecursosHumanos.token).then(async function(e){1==e.success?console.log("Registro Actualizado"):console.log("Registro no Actualizado");await a.Refresh_Form();c.hide()}).catch(async function(e){console.log(e);console.log("Registro no Actualizado por error de servidor");await a.Refresh_Form();
c.hide()}))}};setTimeout(()=>{SalesDashboard.currentModel=new SalesDashboard.dashboardModel;SalesDashboard.currentModel.init()},1E3);
