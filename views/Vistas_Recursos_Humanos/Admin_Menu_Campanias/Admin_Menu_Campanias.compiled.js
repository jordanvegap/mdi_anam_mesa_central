SalesDashboard.dashboardModel=function(){var c=this,d=$("#loadPanel").dxLoadPanel({hideOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.6)",showIndicator:!0,showPane:!0,shading:!0,visible:!1}).dxLoadPanel("instance");c.IdEmpleado=null;c.TpoUsuario=null;c.IdUsuario=null;c.TimeZoneServidor=localStorage.getItem("tmzServidor");c.TimeZoneEmpleado=localStorage.getItem("tmzEmpleado");c.TiempoUTCEmpleado=DiferencieTimeZones();c.Campanias_Acceso=[];c.init=async function(){$("#splashscreen").fadeOut(1E3);Globalize.loadMessages(dictionary);
var m=function(){var a=sessionStorage.getItem("locale");return null!=a?a:"es"}();Globalize.locale(m);DevExpress.localization.locale(m);m=decrypt(localStorage.getItem("DatosEncriptados"));c.obj_DatosEmpleado=JSON.parse(m);c.IdEmpleado=getUrlParam("idemp");c.TpoUsuario=getUrlParam("TpoUsuario");c.IdUsuario=getUrlParam("idusu");await (new Promise((a,b)=>{var e={Type:localStorage.getItem("Type"),EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),
EMPLEADO_CSC_EMPLEADO:c.obj_DatosEmpleado.EMPLEADO_CSC_EMPLEADO,SERVICIO_ACTIVO:1};__Reques_ajax(getJSON(DeveloperType).ApiRecursosHumanos.url+"Get_Cam_Servicios_Empleado","GET",e,getJSON(DeveloperType).ApiRecursosHumanos.token).then(async function(f){c.Campanias_Acceso=1==f.success?f.JsonData:[];a("resolve")}).catch(function(f){c.Campanias_Acceso=[];console.log(f);b(f)})})).catch(function(a){d.hide();console.log(a);reject(a)});$("#__Pop_Camapania_Edit").dxPopup({hideOnOutsideClick:!1,showCloseButton:!0,
title:"Edita Campania",height:240,width:550,position:{my:"center",at:"center",of:window},onShowing:function(a){},onHiding:function(a){$("#__Form_Edita_Campanias").dxForm("instance").option("formData",{})},contentTemplate:function(a){a.attr({style:"display: flex; flex-direction: column;"});a.append($("<div />").attr({id:"__Form_Edita_Campanias",style:"border: solid red 0px; padding: 5px; margin-bottom: 5px;"}).dxForm({readOnly:!1,showColonAfterLabel:!0,showValidationSummary:!1,validationGroup:"__Form_Edita_Campanias_Validate",
labelMode:"static",labelLocation:"top",width:"100%",colCount:4,items:[{colSpan:4,colCount:4,itemType:"group",items:[{colSpan:2,dataField:"CAM_CSC_SERVICIO",editorType:"dxSelectBox",label:{text:"Campa\u00f1a"},validationRules:[{type:"required",message:"requerida"}],editorOptions:{readOnly:!0,valueExpr:"CAM_CSC_SERVICIO",displayExpr:"CAM_SERVICIO_NOMBRE",dataSource:new DevExpress.data.DataSource({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+
"Get_Cat_Full","GET",{Tbl:"SAMT_CAM_SERVICIO"},getJSON(DeveloperType).ApiGeneral.token).then(b=>{if(1==b.success)return b.JsonData;console.log(b.message)})}catch(b){console.log(b)}}})}},{colSpan:1,editorType:"dxDateBox",dataField:"SERVICIO_FECHA_INICIO",label:{text:"Fecha Inicio"},editorOptions:{readOnly:!0,width:"100%",type:"date",placeholder:"DD/MM/AAAA",useMaskBehavior:!0,displayFormat:"dd/MM/yyyy",dateSerializationFormat:"yyyy-MM-dd"},validationRules:[{type:"required",message:"Requerido"}]},{colSpan:1,
editorType:"dxDateBox",dataField:"SERVICIO_FECHA_FIN",label:{text:"Fecha Fin"},editorOptions:{readOnly:!1,width:"100%",type:"date",placeholder:"DD/MM/AAAA",useMaskBehavior:!0,displayFormat:"dd/MM/yyyy",dateSerializationFormat:"yyyy-MM-dd"},validationRules:[{type:"required",message:"Requerido"}]}]},{colSpan:4,colCount:4,itemType:"group",items:[{dataField:"SERVICIO_ACTIVO",editorType:"dxCheckBox",label:{location:"left",alignment:"right",text:"Activo"}},{dataField:"TEL",editorType:"dxCheckBox",label:{location:"left",
alignment:"right",text:"TEL"}},{dataField:"CHAT",editorType:"dxCheckBox",label:{location:"left",alignment:"right",text:"CHAT"}},{dataField:"REDES_SOCIALES",editorType:"dxCheckBox",label:{location:"left",alignment:"right",text:"SOCIAL"}},{dataField:"MAIL",editorType:"dxCheckBox",label:{location:"left",alignment:"right",text:"MAIL"}},{dataField:"DNA",editorType:"dxCheckBox",label:{location:"left",alignment:"right",text:"DNA"}},{dataField:"TEL_OUT",editorType:"dxCheckBox",label:{location:"left",alignment:"right",
text:"TEL OUT"}},{dataField:"SMS",editorType:"dxCheckBox",label:{location:"left",alignment:"right",text:"SMS"}},{dataField:"VIDEO_CONFERENCIA",editorType:"dxCheckBox",label:{location:"left",alignment:"right",text:"VIDEO"}},{dataField:"NOTIFICACIONES",editorType:"dxCheckBox",label:{location:"left",alignment:"right",text:"NOTIFICACIONES"}},{dataField:"ACD",editorType:"dxCheckBox",label:{location:"left",alignment:"right",text:"ACD"}},{dataField:"ACTIVO_BARCONTACT",editorType:"dxCheckBox",label:{location:"left",
alignment:"right",text:"BARCONTACT"}}]},{colSpan:4,colCount:1,itemType:"group",items:[{itemType:"button",location:"before",locateInMenu:"auto",buttonOptions:{stylingMode:"contained",type:"default",width:"100%",icon:"fa fa-check",text:"Guardar",onInitialized:function(b){$Btn_Guardar_Campania=b.component},onClick:function(){d.show();var b=$("#__Form_Edita_Campanias").dxForm("instance").option("formData");b=GetUpdateData(c.Respaldo_Servicio_Edit,b);b.AUDITORIA_USU_ULT_MOD=c.obj_DatosEmpleado.EMPLEADO_CSC_EMPLEADO;
b.AUDITORIA_FEC_ULT_MOD=moment().tz(c.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss");b={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),Type:localStorage.getItem("Type"),DATA_UPDATE:b,DATA_WHERE:{EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),SERVICIOS_EMP_UNIQUE:c.Respaldo_Servicio_Edit.SERVICIOS_EMP_UNIQUE,CAM_CSC_SERVICIO:c.Respaldo_Servicio_Edit.CAM_CSC_SERVICIO,EMPLEADO_CSC_EMPLEADO:c.Respaldo_Servicio_Edit.EMPLEADO_CSC_EMPLEADO}};__Reques_ajax(getJSON(DeveloperType).ApiRecursosHumanos.url+
"Update_Cam_Servicio_Empleados","POST",JSON.stringify(b),getJSON(DeveloperType).ApiRecursosHumanos.token).then(async e=>{1==e.success?($("#__Pop_Camapania_Edit").dxPopup("hide"),$("#dxDataGridCampanias").dxDataGrid("instance").refresh().done(function(){d.hide()}).fail(function(f){d.hide();console.log(f)})):(d.hide(),DevExpress.ui.notify("NO SE ACTUALIZO INFORMACION VALIDA E INTENTE NUEVAMENTE","error",5E3))}).catch(function(e){console.log(e);d.hide();DevExpress.ui.notify("ERROR AL ACTUALIZAR VALIDE LA INFORMACION E INTENTE NUEVAMENTE",
"error",5E3)})}}}]}]}))}});$("#dxTreeMenuCampanias").dxTreeList({keyExpr:"ID_ITEM",parentIdExpr:"ID_ITEM_PARENT",showRowLines:!0,showBorders:!0,columnAutoWidth:!0,autoExpandAll:!0,selection:{mode:"multiple",recursive:!0},height:"100%",columns:[{caption:"Servicio",dataField:"DESCRIPCION_ITEM",alignment:"left"}],onSelectionChanged:async function(a){d.show();const b=a.component.getSelectedRowsData("leavesOnly");await new Promise((e,f)=>{var k=$("#dxDataGridCampanias").dxDataGrid("instance").option("dataSource").items();
console.log(k);b.forEach(async function(h){var g=jslinq(k).where(function(l){return l.CAM_CSC_SERVICIO==h.ID_ITEM}).toList();console.log(g);0==g.length?(console.log("Campania No Existe"),await (new Promise((l,p)=>{var q={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),Type:localStorage.getItem("Type"),DATA_INSERT:{EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),EMPLEADO_CSC_EMPLEADO:c.IdEmpleado,CAM_CSC_SERVICIO:h.ID_ITEM,
SERVICIOS_EMP_UNIQUE:createUUID(36),TEL:0,CHAT:0,REDES_SOCIALES:0,MAIL:0,DNA:0,TEL_OUT:0,SMS:0,VIDEO_CONFERENCIA:0,NOTIFICACIONES:0,ACD:0,ACTIVO_BARCONTACT:0,SERVICIO_PRINCIPAL:0,SERVICIO_ACTIVO:1,SERVICIO_FECHA_INICIO:moment().tz(c.TimeZoneServidor).format("YYYY-MM-DD"),SERVICIO_FECHA_FIN:moment().add(1,"years").tz(c.TimeZoneServidor).format("YYYY-MM-DD"),AUDITORIA_USU_ALTA:c.obj_DatosEmpleado.EMPLEADO_CSC_EMPLEADO,AUDITORIA_USU_ULT_MOD:c.obj_DatosEmpleado.EMPLEADO_CSC_EMPLEADO,AUDITORIA_FEC_ALTA:moment().tz(c.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),
AUDITORIA_FEC_ULT_MOD:moment().tz(c.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss")}};__Reques_ajax(getJSON(DeveloperType).ApiRecursosHumanos.url+"Insert_Cam_Servicio_Empleados","POST",JSON.stringify(q),getJSON(DeveloperType).ApiRecursosHumanos.token).then(async function(n){1==n.success?(console.log("Registro Insertado"),l("resolve")):(console.log("Registro no Insertado"),p("reject"))}).catch(function(n){console.log(n);console.log("Registro no Insertado por error de servidor");p(n)})})).catch(function(l){f(l)})):
console.log("Campania Existe")});$("#dxDataGridCampanias").dxDataGrid("instance").refresh().done(function(){d.hide()}).fail(function(h){d.hide();console.log(h)});e("resolve")})},onInitialized:async function(a){d.show();(new Promise((b,e)=>{if("ADMIN"==c.TpoUsuario)var f="Get_Campania_Llega",k={Type:localStorage.getItem("Type"),EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST")};else{f="Get_Campanias_Tree_Select";var h=[];c.Campanias_Acceso.map(function(g){h.push(g.CAM_CSC_SERVICIO)});
k=0==h.length?"-1":h.join(",");k={Type:localStorage.getItem("Type"),EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),CAM_CSC_SERVICIO_SELECT:k}}__Reques_ajax(getJSON(DeveloperType).ApiRecursosHumanos.url+f,"GET",k,getJSON(DeveloperType).ApiRecursosHumanos.token).then(async function(g){1==g.success?a.component.option("dataSource",g.JsonData):a.component.option("dataSource",[]);d.hide();b("resolve")}).catch(function(g){d.hide();
console.log(g);e(g)})})).catch(function(b){d.hide();console.log(b);reject(b)})}});$("#dxDataGridCampanias").dxDataGrid({selection:{mode:"none"},height:"100%",scrolling:{mode:"virtual"},hoverStateEnabled:!0,showBorders:!0,showRowLines:!0,showColumnLines:!0,rowAlternationEnabled:!0,columnAutoWidth:!1,columnWidth:100,dataSource:new DevExpress.data.DataSource({loadMode:"raw",load:async function(){try{var a={Type:localStorage.getItem("Type"),EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),
EMPLEADO_CSC_EMPLEADO:c.IdEmpleado};return __Reques_ajax(getJSON(DeveloperType).ApiRecursosHumanos.url+"Get_Cam_Servicios_Empleado","GET",a,getJSON(DeveloperType).ApiRecursosHumanos.token).then(function(b){if(1==b.success)return b.JsonData;console.log(b.message);return[]})}catch(b){console.log(b)}}}),onContentReady:function(a){var b=[];a.component.option("dataSource").items().map(function(e){b.push(e.CAM_CSC_SERVICIO)});console.log([].concat(b));$("#dxTreeMenuCampanias").dxTreeList("instance").option("selectedRowKeys",
b)},columns:[{width:110,fixed:!0,type:"buttons",buttons:[{text:"Eliminar",onClick(a){d.show();a=a.row.data;a={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:Number(localStorage.getItem("EMP_CSC_EMPRESA_HOST")),Type:localStorage.getItem("Type"),SERVICIOS_EMP_UNIQUE:a.SERVICIOS_EMP_UNIQUE,EMPLEADO_CSC_EMPLEADO:a.EMPLEADO_CSC_EMPLEADO,CAM_CSC_SERVICIO:a.CAM_CSC_SERVICIO};__Reques_ajax(getJSON(DeveloperType).ApiRecursosHumanos.url+"Delete_Cam_Servicio_Empleados","POST",JSON.stringify(a),
getJSON(DeveloperType).ApiRecursosHumanos.token).then(b=>{1==b.success&&($("#dxDataGridCampanias").dxDataGrid("instance").refresh().done(function(){d.hide()}).fail(function(e){d.hide();console.log(e)}),DevExpress.ui.notify({message:"Campa\u00f1a retirado correctamente",minWidth:150,type:"success",displayTime:5E3},{position:"bottom right",direction:"up-push"}))}).catch(function(b){DevExpress.ui.notify({message:"Error en comunicaci\u00f3n con servidores",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",
direction:"up-push"})})}},{text:"Configurar",onClick(a){var b=Object.assign({},a.row.data);c.Respaldo_Servicio_Edit=Object.assign({},a.row.data);$("#__Pop_Camapania_Edit").dxPopup("show");$("#__Form_Edita_Campanias").dxForm("instance").option("formData",b)}}]},{width:60,caption:"Activo",dataType:"boolean",dataField:"SERVICIO_ACTIVO",calculateCellValue(a){return!!a.SERVICIO_ACTIVO}},{width:250,caption:"Servicio",dataField:"CAM_CSC_SERVICIO",alignment:"left",lookup:{valueExpr:"CAM_CSC_SERVICIO",displayExpr:"CAM_SERVICIO_NOMBRE",
dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_CAM_SERVICIO"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return a.JsonData;console.log(a.message);return[]})}catch(a){console.log(a)}}})}}},{caption:"Fecha Inicio",dataField:"SERVICIO_FECHA_INICIO",alignment:"center"},{caption:"Fecha Fin",dataField:"SERVICIO_FECHA_FIN",alignment:"center"},
{width:60,caption:"TEL",dataType:"boolean",dataField:"TEL",calculateCellValue(a){return!!a.TEL}},{width:60,caption:"CHAT",dataType:"boolean",dataField:"CHAT",calculateCellValue(a){return!!a.CHAT}},{width:150,caption:"REDES SOCIALES",dataType:"boolean",dataField:"REDES_SOCIALES",calculateCellValue(a){return!!a.REDES_SOCIALES}},{width:60,caption:"MAIL",dataType:"boolean",dataField:"MAIL",calculateCellValue(a){return!!a.MAIL}},{width:60,caption:"DNA",dataType:"boolean",dataField:"DNA",calculateCellValue(a){return!!a.DNA}},
{width:60,caption:"TEL OUT",dataType:"boolean",dataField:"TEL_OUT",calculateCellValue(a){return!!a.TEL_OUT}},{width:60,caption:"SMS",dataType:"boolean",dataField:"SMS",calculateCellValue(a){return!!a.SMS}},{width:60,caption:"VIDEO",dataType:"boolean",dataField:"VIDEO_CONFERENCIA",calculateCellValue(a){return!!a.VIDEO_CONFERENCIA}},{width:150,caption:"NOTIFICACIONES",dataType:"boolean",dataField:"NOTIFICACIONES",calculateCellValue(a){return!!a.NOTIFICACIONES}},{width:60,caption:"ACD",dataType:"boolean",
dataField:"ACD",calculateCellValue(a){return!!a.ACD}},{width:100,caption:"BARCONTACT",dataType:"boolean",dataField:"ACTIVO_BARCONTACT",calculateCellValue(a){return!!a.ACTIVO_BARCONTACT}}]})}};setTimeout(()=>{SalesDashboard.currentModel=new SalesDashboard.dashboardModel;SalesDashboard.currentModel.init()},1E3);
