SalesDashboard.dashboardModel=function(){var a=this,f=$("#loadPanel").dxLoadPanel({hideOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",showIndicator:!0,showPane:!0,shading:!0,visible:!0}).dxLoadPanel("instance");a.patname=window.location.pathname;a.TimeZoneServidor=localStorage.getItem("tmzServidor");a.TimeZoneEmpleado=localStorage.getItem("tmzEmpleado");a.TiempoUTCEmpleado=DiferencieTimeZones();a.IdEmpleado=null;a.TpoUsuario=null;a.IdUsuario=null;a.DatosUsuariosPsw=null;a.obj_DatosEmpleado=null;
a.dxTreeMenuGeneral=null;a.init=function(){$("#splashscreen").fadeOut(1E3);Globalize.loadMessages(dictionary);var c=function(){var b=sessionStorage.getItem("locale");return null!=b?b:"es"}();Globalize.locale(c);DevExpress.localization.locale(c);c=decrypt(localStorage.getItem("DatosEncriptados"));a.obj_DatosEmpleado=JSON.parse(c);f.hide();a.IdEmpleado=getUrlParam("idemp");a.TpoUsuario=getUrlParam("TpoUsuario");a.IdUsuario=getUrlParam("idusu");$("#btn_asignar").dxButton({text:"Asignar",width:"100%",
icon:"add",type:"default",onClick:function(){const b=a.dxTreeMenuGeneral.getSelectedRowsData("leavesOnly");var d=null;null!=a.dxDataGridMenuGeneral.getDataSource()&&(d=a.dxDataGridMenuGeneral.getDataSource().items());var k=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss");b.forEach(function(g){if(null==d||!d.find(h=>h.MNU_CSC_MENU===g.MNU_CSC_MENU)){var e={};e.AUDITORIA_USU_ALTA=a.obj_DatosEmpleado.EMPLEADO_CSC_EMPLEADO;e.AUDITORIA_USU_ULT_MOD=a.obj_DatosEmpleado.EMPLEADO_CSC_EMPLEADO;
e.EMP_CSC_EMPRESA_HOST=localStorage.getItem("EMP_CSC_EMPRESA_HOST");e.AUDITORIA_FEC_ALTA=k;e.AUDITORIA_FEC_ULT_MOD=k;e.USU_CSC_USUARIO=a.IdUsuario;e.MNU_CSC_MENU=g.MNU_CSC_MENU;e={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),Type:localStorage.getItem("Type"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),DATA_INSERT:e};__Reques_ajax(getJSON(DeveloperType).ApiGeneral.url+"Insert_Mnu_Sis_Emp","POST",JSON.stringify(e),getJSON(DeveloperType).ApiGeneral.token).then(h=>{f.show();
1==h.success&&DevExpress.ui.notify({message:"Menu asignado correctamente",minWidth:150,type:"success",displayTime:5E3},{position:"bottom right",direction:"up-push"})}).catch(function(h){DevExpress.ui.notify({message:"Error en comunicaci\u00f3n con servidores",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"})})}});setTimeout(()=>{var g={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),Type:localStorage.getItem("Type"),
USU_CODESQUEMASEG:"SEGMENU",USU_CSC_USUARIO:a.IdUsuario};a.GetMenuWebUsuario(g)},3E3)}});a.dxTreeMenuGeneral=$("#dxTreeMenuGeneral").dxTreeList({keyExpr:"MNU_CSC_MENU",parentIdExpr:"MNU_CSC_MENU_PADRE",showRowLines:!0,showBorders:!0,columnAutoWidth:!0,selection:{mode:"multiple",recursive:!0},height:400,columns:[{caption:"Servicio",dataField:"MNU_DESCRIPCION1",alignment:"left"}],onSelectionChanged(){a.dxTreeMenuGeneral.getSelectedRowsData("leavesOnly")}}).dxTreeList("instance");a.dxDataGridMenuGeneral=
$("#dxDataGridMenuGeneral").dxDataGrid({keyExpr:"MNU_CSC_MENU",selection:{mode:"single"},height:432,scrolling:{useNative:!1,scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always"},hoverStateEnabled:!0,showBorders:!0,showRowLines:!0,showColumnLines:!0,rowAlternationEnabled:!0,columnAutoWidth:!1,columns:[{caption:"Id",dataField:"MNU_CSC_MENU",alignment:"left",width:50},{caption:"Men\u00fa",dataField:"MNU_DESCRIPCION1",alignment:"left"},{type:"buttons",width:110,buttons:[{text:"Eliminar",onClick(b){b=
{EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:Number(localStorage.getItem("EMP_CSC_EMPRESA_HOST")),Type:localStorage.getItem("Type"),USU_CSC_USUARIO:Number(a.IdUsuario),MNU_CSC_MENU:Number(b.row.data.MNU_CSC_MENU)};__Reques_ajax(getJSON(DeveloperType).ApiGeneral.url+"Del_Mnu_Sis_Emp","POST",JSON.stringify(b),getJSON(DeveloperType).ApiGeneral.token).then(d=>{f.show();1==d.success&&(d={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),
Type:localStorage.getItem("Type"),USU_CODESQUEMASEG:"SEGMENU",USU_CSC_USUARIO:a.IdUsuario},a.GetMenuWebUsuario(d),DevExpress.ui.notify({message:"Men\u00fa retirado correctamente",minWidth:150,type:"success",displayTime:5E3},{position:"bottom right",direction:"up-push"}))}).catch(function(d){DevExpress.ui.notify({message:"Error en comunicaci\u00f3n con servidores",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"})})}}]}]}).dxDataGrid("instance");c={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),
EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),Type:localStorage.getItem("Type"),MNU_ACTIVO_WEB:1};a.GetMnuSistema(c);c={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),Type:localStorage.getItem("Type"),USU_CODESQUEMASEG:"SEGMENU",USU_CSC_USUARIO:a.IdUsuario};a.GetMenuWebUsuario(c)};a.GetMnuSistema=function(c){__Reques_ajax(getJSON(DeveloperType).ApiGeneral.url+"GetMnuSistema","GET",c,getJSON(DeveloperType).ApiGeneral.token).then(b=>
{f.show();1==b.success?a.dxTreeMenuGeneral.option("dataSource",b.JsonData):console.log("Sin Servicios Asignados");f.hide()})};a.GetMenuWebUsuario=function(c){__Reques_ajax(getJSON(DeveloperType).ApiGeneral.url+"GetMenuWebUsuario","GET",c,getJSON(DeveloperType).ApiGeneral.token).then(b=>{f.show();1==b.success?(b=b.JsonData,a.dxDataGridMenuGeneral.option("dataSource",b),b=jslinq(b).select(function(d){return d.MNU_CSC_MENU}).toList(),a.dxTreeMenuGeneral.option("selectedRowKeys",b)):console.log("Sin Servicios Asignados");
f.hide()})}};setTimeout(()=>{SalesDashboard.currentModel=new SalesDashboard.dashboardModel;SalesDashboard.currentModel.init()},1E3);
