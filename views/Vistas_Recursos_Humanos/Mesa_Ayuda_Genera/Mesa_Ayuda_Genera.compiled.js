SalesDashboard.dashboardModel=function(){var a=this,f=$("#loadPanel").dxLoadPanel({hideOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",showIndicator:!0,showPane:!0,shading:!0,visible:!0}).dxLoadPanel("instance");a.patname=window.location.pathname;a.TimeZoneServidor=localStorage.getItem("tmzServidor");a.TimeZoneEmpleado=localStorage.getItem("tmzEmpleado");a.TiempoUTCEmpleado=DiferencieTimeZones();a.IdEmpleado=null;a.TpoUsuario="GENERA";a.DatosUsuariosPsw=null;a.obj_DatosEmpleado=null;a.init=function(){$("#splashscreen").fadeOut(1E3);
Globalize.loadMessages(dictionary);var d=function(){var b=sessionStorage.getItem("locale");return null!=b?b:"es"}();Globalize.locale(d);DevExpress.localization.locale(d);d=decrypt(localStorage.getItem("DatosEncriptados"));a.obj_DatosEmpleado=JSON.parse(d);$("#TagMesas").dxTagBox({showSelectionControls:!0,applyValueMode:"useButtons",displayExpr:"CAM_MESA_IDIOMA1",valueExpr:"CAM_MESA_CSC",dataSource:new DevExpress.data.DataSource({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+
"Get_Cat","GET",{Tbl:"SAMT_CAM_MESA_DE_AYUDA",NACTIVE:"CAM_MESA_ACTIVO"},getJSON(DeveloperType).ApiGeneral.token).then(b=>{if(1==b.success)return b.JsonData;console.log(b.message)})}catch(b){console.log(b)}}}),onValueChanged:function(b){b=b.value;var e=$("#DataGridMesasAyuda").dxDataGrid("instance"),k=null;null!=e.getDataSource()&&(k=e.getDataSource().items());var l=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),m=a.IdEmpleado;b.forEach(function(g){if(void 0==(null==k?void 0:k.find(h=>
h.CAM_MESA_CSC===g))){var c={};c.AUDITORIA_USU_ALTA=a.obj_DatosEmpleado.EMPLEADO_CSC_EMPLEADO;c.AUDITORIA_USU_ULT_MOD=a.obj_DatosEmpleado.EMPLEADO_CSC_EMPLEADO;c.EMP_CSC_EMPRESA_HOST=localStorage.getItem("EMP_CSC_EMPRESA_HOST");c.AUDITORIA_FEC_ALTA=l;c.AUDITORIA_FEC_ULT_MOD=l;c.EMPLEADO_CSC_EMPLEADO=m;c.CAM_MESA_CSC=g;c={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),Type:localStorage.getItem("Type"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),DATA_INSERT:c};__Reques_ajax(getJSON(DeveloperType).ApiRecursosHumanos.url+
"Insert_Mesa_Empleado_Genera","POST",JSON.stringify(c),getJSON(DeveloperType).ApiRecursosHumanos.token).then(h=>{f.show();1==h.success&&DevExpress.ui.notify({message:"Servicio asignado correctamente",minWidth:150,type:"success",displayTime:5E3},{position:"bottom right",direction:"up-push"})}).catch(function(h){DevExpress.ui.notify({message:"Error en comunicaci\u00f3n con servidores",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"})})}});setTimeout(()=>{var g=
{EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),Type:localStorage.getItem("Type"),EMPLEADO_CSC_EMPLEADO:a.IdEmpleado,TPO_USUARIO:a.TpoUsuario};a.Get_Mesa_Empleado(g);f.hide()},3E3)}});f.hide();a.IdEmpleado=getUrlParam("idemp");$("#DataGridMesasAyuda").dxDataGrid({keyExpr:"CAM_MESA_CSC",selection:{mode:"single"},height:300,scrolling:{useNative:!1,scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always"},hoverStateEnabled:!0,
showBorders:!0,showRowLines:!0,showColumnLines:!0,rowAlternationEnabled:!0,columnAutoWidth:!1,columns:[{caption:"Servicio",dataField:"CAM_MESA_IDIOMA1",alignment:"left"},{type:"buttons",width:110,buttons:[{text:"Quitar Servicio",onClick(b){b={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:Number(localStorage.getItem("EMP_CSC_EMPRESA_HOST")),Type:localStorage.getItem("Type"),EMPLEADO_CSC_EMPLEADO:Number(a.IdEmpleado),CAM_MESA_CSC:Number(b.row.data.CAM_MESA_CSC)};console.log(b);
__Reques_ajax(getJSON(DeveloperType).ApiRecursosHumanos.url+"Del_Mesa_Empleado_Genera","POST",JSON.stringify(b),getJSON(DeveloperType).ApiRecursosHumanos.token).then(e=>{f.show();1==e.success&&(e={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),Type:localStorage.getItem("Type"),EMPLEADO_CSC_EMPLEADO:a.IdEmpleado,TPO_USUARIO:a.TpoUsuario},a.Get_Mesa_Empleado(e),DevExpress.ui.notify({message:"Men\u00fa retirado correctamente",
minWidth:150,type:"success",displayTime:5E3},{position:"bottom right",direction:"up-push"}))}).catch(function(e){DevExpress.ui.notify({message:"Error en comunicaci\u00f3n con servidores",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"})})}}]}]});d={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),Type:localStorage.getItem("Type"),EMPLEADO_CSC_EMPLEADO:a.IdEmpleado,TPO_USUARIO:a.TpoUsuario};
a.Get_Mesa_Empleado(d)};a.Get_Mesa_Empleado=function(d){__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Get_Mesa_Empleado","GET",d,getJSON(DeveloperType).ApiTickets_v2.token).then(b=>{f.show();1==b.success?(b=b.JsonData,$("#DataGridMesasAyuda").dxDataGrid("instance").option("dataSource",b)):console.log("Sin Servicios Asignados");f.hide()})}};setTimeout(()=>{SalesDashboard.currentModel=new SalesDashboard.dashboardModel;SalesDashboard.currentModel.init()},1E3);
