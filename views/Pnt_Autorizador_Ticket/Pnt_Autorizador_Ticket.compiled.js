SalesDashboard.dashboardModel=function(){function m(a,c,d){e.show();var f={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),Type:localStorage.getItem("Type"),CAM_MESA_CSC:c};__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Get_Ensamble_Mesa_Ayuda","GET",f,getJSON(DeveloperType).ApiTickets_v2.token).then(h=>{if(1==h.success){var k=h.JsonData[0];null==k.CAM_MESA_IFRAMEWEB?DevExpress.ui.notify("Error no se identifico mesa de ayuda",
"error",3E3):setTimeout(()=>{var l="TIPO="+a+"&CSC_MESA="+c+"&TK_ID="+d;l="/"+b.patname.split("/")[1]+"/views/Vistas_Mesas_Ayuda/"+k.CAM_MESA_IFRAMEWEB+"/"+k.CAM_MESA_IFRAMEWEB+".html?"+l;document.getElementById("Mod_Embebed_Ticket_Autoriza").src=l;e.hide()},3E3)}else DevExpress.ui.notify("Error no se identifico mesa de ayuda","error",3E3)}).catch(function(h){DevExpress.ui.notify("Error mesa de ayuda no localizada intente nuevamnete","error",3E3)})}var b=this,g,e=$("#loadPanel").dxLoadPanel({hideOnOutsideClick:!1,
shadingColor:"rgba(0,0,0,0.4)",showIndicator:!0,showPane:!0,shading:!0,visible:!0}).dxLoadPanel("instance");b.TimeZoneServidor=localStorage.getItem("tmzServidor");b.TimeZoneEmpleado=localStorage.getItem("tmzEmpleado");b.TiempoUTCEmpleado=DiferencieTimeZones();b.init=function(){g=JSON.parse(localStorage.getItem("obj_DatosEmpleado"));$("#splashscreen").fadeOut(1E3);Globalize.loadMessages(dictionary);var a=function(){var c=sessionStorage.getItem("locale");return null!=c?c:"es-mx"}();Globalize.locale(a);
DevExpress.localization.locale(a);b.patname=window.location.pathname;console.log(getUrlParam("toktik"));b.__cmp_DG_Autorizaciones=$("#DG_Autorizaciones").dxDataGrid({deferRendering:!0,allowColumnResizing:!0,headerFilter:{visible:!1},keyExpr:"SAMT_TICKET_AUTORIZACIONES_CSC",remoteOperations:!1,height:"100%",searchPanel:{visible:!1,highlightCaseSensitive:!0},selection:{mode:"single"},scrolling:{mode:"virtual",showScrollbar:"always",useNative:!0},groupPanel:{visible:!1},grouping:{autoExpandAll:!0},paging:{enabled:!1,
pageIndex:0,pageSize:20},showBorders:!0,showRowLines:!0,showColumnLines:!0,rowAlternationEnabled:!0,columnAutoWidth:!1,columns:[{caption:"ID",dataField:"SAMT_TICKET_AUTORIZACIONES_CSC"},{caption:"ESTATUS",dataField:"SAMT_TIPO_RESPUESTA_AUTORIZA_CSC",lookup:{displayExpr:"TIPO_RESPUESTA_AUTORIZA_IDIOMA1",valueExpr:"SAMT_TIPO_RESPUESTA_AUTORIZA_CSC",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+
"Get_Cat_Full","GET",{Tbl:"SAMT_TIPO_RESPUESTA_AUTORIZA"},getJSON(DeveloperType).ApiGeneral.token).then(c=>{if(1==c.success)return c.JsonData;console.log(c.message)})}catch(c){console.log(c)}}})}}},{caption:"RESPONSABLE",dataField:"NOMBRE"},{caption:"EMPLEADO ALTA",dataField:"NOMBRE_SOLICITANTE"},{caption:"FECHA ALTA",dataField:"AUDITORIA_FEC_ALTA",alignment:"center",dataType:"date",calculateCellValue:function(c){return moment(c.AUDITORIA_FEC_ALTA).add(b.TiempoUTCEmpleado,"hours").format("DD/MM/YYYY HH:mm:ss")}},
{caption:"COMENTARIOS",dataField:"AUTORIZADO_COMENTARIOS"}],onRowDblClick:function(c){b.Frm__Editar_Autorizacion_Resp_Instance.resetValues();var d=JSON.stringify(c.data);b.__DataAutorizacionLoad=JSON.parse(d);m("LECTURA",c.data.CAM_MESA_CSC,c.data.AUTORIZACIONES_TIC_NEWID);b.Frm__Editar_Autorizacion_Resp_Instance.updateData(b.__DataAutorizacionLoad);0==b.__DataAutorizacionLoad.AUTORIZADO_ACTIVO?(b.Frm__Editar_Autorizacion_Resp_Instance.option("readOnly",!0),$btn_Actualizar_Respuesta_Autoriza.option("visible",
!1)):($btn_Actualizar_Respuesta_Autoriza.option("visible",!0),b.Frm__Editar_Autorizacion_Resp_Instance.option("readOnly",!1))}}).dxDataGrid("instance");b.__cmp_DG_Autorizaciones_Finalizadas=$("#DG_Autorizaciones_Finalizadas").dxDataGrid({deferRendering:!0,allowColumnResizing:!0,headerFilter:{visible:!1},keyExpr:"SAMT_TICKET_AUTORIZACIONES_CSC",remoteOperations:!1,height:"100%",searchPanel:{visible:!1,highlightCaseSensitive:!0},selection:{mode:"single"},scrolling:{mode:"virtual",showScrollbar:"always",
useNative:!0},groupPanel:{visible:!1},grouping:{autoExpandAll:!0},paging:{enabled:!1,pageIndex:0,pageSize:20},showBorders:!0,showRowLines:!0,showColumnLines:!0,rowAlternationEnabled:!0,columnAutoWidth:!1,columns:[{caption:"ID",dataField:"SAMT_TICKET_AUTORIZACIONES_CSC"},{caption:"ESTATUS",dataField:"SAMT_TIPO_RESPUESTA_AUTORIZA_CSC",lookup:{displayExpr:"TIPO_RESPUESTA_AUTORIZA_IDIOMA1",valueExpr:"SAMT_TIPO_RESPUESTA_AUTORIZA_CSC",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",paginate:!1,
load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_TIPO_RESPUESTA_AUTORIZA"},getJSON(DeveloperType).ApiGeneral.token).then(c=>{if(1==c.success)return c.JsonData;console.log(c.message)})}catch(c){console.log(c)}}})}}},{caption:"RESPONSABLE",dataField:"NOMBRE"},{caption:"EMPLEADO ALTA",dataField:"NOMBRE_SOLICITANTE"},{caption:"FECHA ALTA",dataField:"AUDITORIA_FEC_ALTA",alignment:"center",dataType:"date",calculateCellValue:function(c){return moment(c.AUDITORIA_FEC_ALTA).add(b.TiempoUTCEmpleado,
"hours").format("DD/MM/YYYY HH:mm:ss")}},{caption:"COMENTARIOS",dataField:"AUTORIZADO_COMENTARIOS"},{caption:"FECHA MODIFICACION",dataField:"AUDITORIA_FEC_ULT_MOD",alignment:"center",dataType:"date",calculateCellValue:function(c){return moment(c.AUDITORIA_FEC_ULT_MOD).add(b.TiempoUTCEmpleado,"hours").format("DD/MM/YYYY HH:mm:ss")}}],onRowDblClick:function(c){b.Frm__Editar_Autorizacion_Resp_Instance.resetValues();var d=JSON.stringify(c.data);b.__DataAutorizacionLoad=JSON.parse(d);m("LECTURA",c.data.CAM_MESA_CSC,
c.data.AUTORIZACIONES_TIC_NEWID);b.Frm__Editar_Autorizacion_Resp_Instance.updateData(b.__DataAutorizacionLoad);0==b.__DataAutorizacionLoad.AUTORIZADO_ACTIVO?(b.Frm__Editar_Autorizacion_Resp_Instance.option("readOnly",!0),$btn_Actualizar_Respuesta_Autoriza.option("visible",!1)):($btn_Actualizar_Respuesta_Autoriza.option("visible",!0),b.Frm__Editar_Autorizacion_Resp_Instance.option("readOnly",!1))}}).dxDataGrid("instance");setTimeout(()=>{b.Get_Autorizaciones_Ticket({EMPLEADO_CSC_EMPLEADO:g.EMPLEADO_CSC_EMPLEADO,
AUTORIZADO_ACTIVO:1},"__cmp_DG_Autorizaciones");var c=new Date,d=dateResta(c,"month",6);b.Get_Autorizaciones_Ticket({EMPLEADO_CSC_EMPLEADO:g.EMPLEADO_CSC_EMPLEADO,AUTORIZADO_ACTIVO:0,AUT_FECHA_INICIAL:ConvertToDateSting(ConvertDatetimeToStringBD(d),"yyyymmmddd"),AUT_FECHA_FINAL:ConvertToDateSting(ConvertDatetimeToStringBD(c),"yyyymmmddd")},"__cmp_DG_Autorizaciones_Finalizadas")},2E3)};b.Frm_Actualizar_Datos_Instance=$("#Form_Actualizar_Datos").dxForm({readOnly:!1,showColonAfterLabel:!0,showValidationSummary:!1,
validationGroup:"__Validate_Form_Actualizar_Datos",labelMode:"static",labelLocation:"top",colCount:4,screenByWidth(a){return 700>a?"sm":"lg"},items:[{colSpan:4,itemType:"button",location:"before",locateInMenu:"auto",buttonOptions:{text:"Actualizar",icon:"refresh",type:"default",width:"50%",visible:!0,onInitialized:function(a){$btn_Actualziar_Busqueda=a.component},onClick(){b.Get_Autorizaciones_Ticket({EMPLEADO_CSC_EMPLEADO:g.EMPLEADO_CSC_EMPLEADO,AUTORIZADO_ACTIVO:1},"__cmp_DG_Autorizaciones");var a=
new Date,c=dateResta(a,"month",6);b.Get_Autorizaciones_Ticket({EMPLEADO_CSC_EMPLEADO:g.EMPLEADO_CSC_EMPLEADO,AUTORIZADO_ACTIVO:0,AUT_FECHA_INICIAL:ConvertToDateSting(ConvertDatetimeToStringBD(c),"yyyymmmddd"),AUT_FECHA_FINAL:ConvertToDateSting(ConvertDatetimeToStringBD(a),"yyyymmmddd")},"__cmp_DG_Autorizaciones_Finalizadas")}}}]}).dxForm("instance");b.Frm__Editar_Autorizacion_Resp_Instance=$("#Form_Editar_Autorizacion_Resp").dxForm({readOnly:!1,showColonAfterLabel:!0,showValidationSummary:!1,validationGroup:"__Validate_Form_Editar_Autorizacion_Resp",
labelMode:"static",labelLocation:"top",colCount:4,screenByWidth(a){return 700>a?"sm":"lg"},items:[{colSpan:2,dataField:"AUTORIZACIONES_NEWID",cssClass:"hidden_box",label:{text:"UUID"},editorOptions:{readOnly:!0,disabled:!1}},{colSpan:2,dataField:"AUTORIZACIONES_TIC_NEWID",cssClass:"hidden_box",label:{text:"UUID ticket"},editorOptions:{readOnly:!0,disabled:!1}},{colSpan:4,dataField:"SAMT_TIPO_RESPUESTA_AUTORIZA_CSC",editorType:"dxSelectBox",label:{text:"Estatus"},editorOptions:{searchEnabled:!0,displayExpr:"TIPO_RESPUESTA_AUTORIZA_IDIOMA1",
valueExpr:"SAMT_TIPO_RESPUESTA_AUTORIZA_CSC",dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.CustomStore({key:"SAMT_TIPO_RESPUESTA_AUTORIZA_CSC",loadMode:"raw",paginate:!1,load:async function(){return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat","GET",{Tbl:"SAMT_TIPO_RESPUESTA_AUTORIZA",NACTIVE:"TIPO_RESPUESTA_AUTORIZA_ACTIVO"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return a.JsonData;console.log(a.message)})}})}),onValueChanged:function(a){a=
a.component.option("selectedItem");null!=a&&("AUTO"==a.TIPO_RESPUESTA_AUTORIZA_CLAVE||"NOAUT"==a.TIPO_RESPUESTA_AUTORIZA_CLAVE?b.Frm__Editar_Autorizacion_Resp_Instance.itemOption("AUTORIZADO_COMENTARIOS",{isRequired:!0}):("NOAP"==a.TIPO_RESPUESTA_AUTORIZA_CLAVE||"PEND"==a.TIPO_RESPUESTA_AUTORIZA_CLAVE)&&b.Frm__Editar_Autorizacion_Resp_Instance.itemOption("AUTORIZADO_COMENTARIOS",{isRequired:!1}))}},validationRules:[{type:"required",message:"requerido"}]},{dataField:"AUTORIZADO_COMENTARIOS",editorType:"dxTextArea",
colSpan:4,label:{text:"Comentarios"},editorOptions:{height:40,valueChangeEvent:"keyup",onValueChanged:function(a){null!=a.value&&""!=a.value&&a.component.option("value",a.value.toUpperCase())}}},{colSpan:4,itemType:"button",location:"before",locateInMenu:"auto",buttonOptions:{text:"Actualizar",icon:"refresh",type:"default",width:"50%",visible:!0,onInitialized:function(a){$btn_Actualizar_Respuesta_Autoriza=a.component},onClick(){e.show();if(!0===b.Frm__Editar_Autorizacion_Resp_Instance.validate().isValid){var a=
GetUpdateData(b.__DataAutorizacionLoad,b.Frm__Editar_Autorizacion_Resp_Instance.option("formData"));if(0===Object.keys(a).length==1)e.hide();else{var c=moment().tz(b.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),d=b.Frm__Editar_Autorizacion_Resp_Instance.getEditor("SAMT_TIPO_RESPUESTA_AUTORIZA_CSC").option("selectedItem");a.AUDITORIA_USU_ULT_MOD=g.EMPLEADO_CSC_EMPLEADO;a.AUDITORIA_FEC_ULT_MOD=c;a.EMP_CSC_EMPRESA_HOST=localStorage.getItem("EMP_CSC_EMPRESA_HOST");a.AUTORIZADO_VIA_WEB=1;a.AUTORIZADO_ACTIVO=
"PEND"==d.TIPO_RESPUESTA_AUTORIZA_CLAVE?1:0;a={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),Type:localStorage.getItem("Type"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),DATA_UPDATE:a,DATA_WHERE:{AUTORIZACIONES_NEWID:b.__DataAutorizacionLoad.AUTORIZACIONES_NEWID,AUTORIZACIONES_TIC_NEWID:b.__DataAutorizacionLoad.AUTORIZACIONES_TIC_NEWID,EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST")}};console.log(a);__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+
"Update_Autoriza_Ticket","POST",JSON.stringify(a),getJSON(DeveloperType).ApiTickets_v2.token).then(f=>{if(1==f.success){DevExpress.ui.notify("Autorizaci\u00f3n actualizada correctamente","success",4E3);e.hide();b.Get_Autorizaciones_Ticket({EMPLEADO_CSC_EMPLEADO:g.EMPLEADO_CSC_EMPLEADO,AUTORIZADO_ACTIVO:1},"__cmp_DG_Autorizaciones");var h=new Date,k=dateResta(h,"month",6);b.Get_Autorizaciones_Ticket({EMPLEADO_CSC_EMPLEADO:g.EMPLEADO_CSC_EMPLEADO,AUTORIZADO_ACTIVO:0,AUT_FECHA_INICIAL:ConvertToDateSting(ConvertDatetimeToStringBD(k),
"yyyymmmddd"),AUT_FECHA_FINAL:ConvertToDateSting(ConvertDatetimeToStringBD(h),"yyyymmmddd")},"__cmp_DG_Autorizaciones_Finalizadas")}else DevExpress.ui.notify("Error al actualizar autorizaci\u00f3n intentelo nuevamente","error",1E4),e.hide();return f}).catch(function(f){console.log(f);e.hide();DevExpress.ui.notify("Error al actualizar autorizaci\u00f3n intentelo nuevamente","error",1E4)})}}else e.hide()}}}]}).dxForm("instance");b.Get_Autorizaciones_Ticket=function(a,c){b.Frm__Editar_Autorizacion_Resp_Instance.resetValues();
document.getElementById("Mod_Embebed_Ticket_Autoriza").src="";e.show();var d={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),Type:localStorage.getItem("Type")};a=Object.assign(d,a);__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Get_Autoriza_Ticket","GET",a,getJSON(DeveloperType).ApiTickets_v2.token).then(f=>{1==f.success?b[c].option("dataSource",f.JsonData):b[c].option("dataSource",[]);e.hide()}).catch(function(f){DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE",
"error",3E3);b[c].option("dataSource",[]);e.hide()})}};setTimeout(()=>{SalesDashboard.currentModel=new SalesDashboard.dashboardModel;SalesDashboard.currentModel.init()},1E3);
