SalesDashboard.dashboardModel=function(){var a=this;a.subdomain=window.location.host.split(".")[1]?window.location.host.split(".")[0]:!1;var n;let w;var v;a.DataTicketOpen=null;a.setDefaultValues=!1;a.Ids_TipoUso_Requi=9;a.CalificadoRechazado=!1;a.FileCorreoRespuesta=null;a.TipificacionesFull=null;a.CatalogosPantalla=[];a.Previous_TxtParentParent=null;a.Previous_TxtParent=null;a.Previous_TxtTipifica=null;a.Previous_TxtEstatus=null;a.Flag_Fila=!1;var t=$("#LoadEnvioCorreo").dxLoadPanel({hideOnOutsideClick:!1,
shadingColor:"rgba(0,0,0,0.4)",showIndicator:!0,showPane:!0,shading:!0,visible:!0}).dxLoadPanel("instance"),p=$("#loadPanel").dxLoadPanel({hideOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",showIndicator:!0,showPane:!0,shading:!0,visible:!0}).dxLoadPanel("instance");a.UrlEnvioCorreos="http://localhost:3003";a.LoadCatFull=!0;a.Arr_ReglaNegocio=null;a.Arr_UniqueRN=null;a.Dts_LoadCrm=null;a.TimeZoneServidor=localStorage.getItem("tmzServidor");a.TimeZoneEmpleado=localStorage.getItem("tmzEmpleado");
a.TiempoUTCEmpleado=DiferencieTimeZones();a.TipoOrigenCreacion=0;a.TimeDefault=86400;a._Obj_Agrega_Emp_Ticket=new DevExpress.data.ArrayStore({data:[]});a._Obj_Autorizaciones_Grid=new DevExpress.data.ArrayStore({data:[]});a._Obj_Ot_Ticket_Grid=new DevExpress.data.ArrayStore({data:[]});a._Obj_Empleados_Grid=new DevExpress.data.ArrayStore({data:[]});a._MarkUpeditorText=null;a.ArchivosPermitidos=".jpg .jpeg .png .pdf .doc .docx .xlsx .xls".split(" ");a.extensionesDocumentos=".pdf .doc .docx .ppt .pptx .xls .xlsx .txt .rtf .csv .odt .ods .odp .odg .odf".split(" ");
a.extensionesImagenes=".jpg .jpeg .png .gif .bmp .webp .svg".split(" ");a.CamposVisiblesDG=!0;a.BotonesDisponibles=!1;a.jsonTiposParticipanes=null;a._Obj_Ticket_Participantes_Grid=new DevExpress.data.ArrayStore({data:[]});a.editandoForma=!1;a._CMB_SAMT_TIPO_REQ_USO_OBJDATA=new DevExpress.data.ArrayStore({data:[]});a._CMB_SAMT_TIPO_TICKET_PARTICIPANTE_OBJDATA=new DevExpress.data.ArrayStore({data:[]});a._CMB_SAMT_CAT_EMPLEADO_AREA_OBJDATA=new DevExpress.data.ArrayStore({data:[]});a._CMB_SAMT_CAT_EMPLEADO_DEPARTAMENTO_OBJDATA=
new DevExpress.data.ArrayStore({data:[]});a._CMB_SAMT_CAM_MESA_DE_AYUDA_OBJDATA=new DevExpress.data.ArrayStore({data:[]});a._CMB_SAMT_ESTATUS_TICKET_OBJDATA=new DevExpress.data.ArrayStore({data:[]});a._CMB_SAMT_TIPO_PRIORIDAD_TICKET_OBJDATA=new DevExpress.data.ArrayStore({data:[]});a._CMB_SAMT_TIPO_TICKET_OBJDATA=new DevExpress.data.ArrayStore({data:[]});a._CMB_SAMT_CAM_TIPO_SERVICIO_OBJDATA=new DevExpress.data.ArrayStore({data:[]});a._CMB_SAMT_TIPO_SEVERIDAD_OBJDATA=new DevExpress.data.ArrayStore({data:[]});
a._CMB_SAMT_CLIENTES_OBJDATA=new DevExpress.data.ArrayStore({data:[]});a._CMB_SAMT_PROYECTOS_OBJDATA=new DevExpress.data.ArrayStore({data:[]});a._CMB_SAMT_CAM_SERVICIO_OBJDATA=new DevExpress.data.ArrayStore({data:[]});a._CMB_SAMT_REQUISICIONES_OBJDATA=new DevExpress.data.ArrayStore({data:[]});a._CMB_SAMT_TIPO_CALIFICACION_OBJDATA=new DevExpress.data.ArrayStore({data:[]});a._CMB_SAMT_TIPO_PUESTO_EMPLEADO_OBJDATA=new DevExpress.data.ArrayStore({data:[]});a._CMB_SAMT_TIPO_RESPUESTA_AUTORIZA_OBJDATA=
new DevExpress.data.ArrayStore({data:[]});a._CMB_SAMT_ESTATUS_ORDEN_TRABAJO_OBJDATA=new DevExpress.data.ArrayStore({data:[]});a._CMB_SAMT_CAM_TIPIFICACIONES_OBJDATA=new DevExpress.data.ArrayStore({data:[]});a.pauseTicket=!1;a.cierraTicket=!1;a.init=function(){function e(b,c,d){b=void 0==d?"TIPO="+b+"&OT_ID="+c:"TIPO="+b+"&OT_ID="+c+"&TICKET_ID="+d;$("#Pop_Open_Ot_desde_ticket").dxPopup("show");b="/"+a.patname.split("/")[1]+"/views/Vistas_Ordenes_Trabajo/frm_ots/frm_ots.html?"+b;document.getElementById("Mod_Embebed_Ot_desde_ticket").src=
b}function g(b){let c=[];var d=b.option("formData");Object.entries(d).forEach(([f])=>{var h=b.itemOption(f);if(void 0!=h){var l=h.editorType;h=h.label.text;"dxSelectBox"==l?(l=b.getEditor(f),c.push({[f]:l.option("text"),Label:h})):"dxTextBox"==l||"dxNumberBox"==l||"dxTextArea"==l||"dxDateBox"==l?(l=b.getEditor(f),c.push({[f]:l.option("text"),Label:h})):"dxHtmlEditor"==l&&(l=b.getEditor(f),c.push({[f]:l.option("value"),Label:h}))}else if(h=b.itemOption("__Detalle_Edificio."+f),void 0!=h)if(l=h.editorType,
h=h.label.text,"dxSelectBox"==l)l=b.getEditor(f),c.push({[f]:l.option("text"),Label:h});else if("dxTextBox"==l||"dxNumberBox"==l||"dxTextArea"==l||"dxDateBox"==l)l=b.getEditor(f),c.push({[f]:l.option("text"),Label:h})});d=m(a._SelectBox_OriginalDts,c,b);console.log(d)}function m(b,c,d){d=d.option("formData");for(const h in b){var f=Object.keys(b[h])[0];c[h]&&c[h][f]!==b[h][f]&&(f={EMP_CSC_EMPRESA_HOST:ReturnDefaultData_Init().EMP_CSC_EMPRESA_HOST,AUDITORIA_USU_ALTA:JSON.parse(localStorage.getItem("obj_DatosEmpleado")).EMPLEADO_CSC_EMPLEADO,
AUDITORIA_USU_ULT_MOD:JSON.parse(localStorage.getItem("obj_DatosEmpleado")).EMPLEADO_CSC_EMPLEADO,AUDITORIA_FEC_ALTA:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),AUDITORIA_FEC_ULT_MOD:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),TIC_CSCTICKET:d.TIC_CSCTICKET,ESTATUS_TICKET_CSC:d.ESTATUS_TICKET_CSC,TIB_NOMBRE:n.EMPLEADO_NOMBREEMPLEADO+" "+n.EMPLEADO_APATERNOEMPLEADO+" "+n.EMPLEADO_AMATERNOEMPLEADO,TIB_FECHAHORA:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),
SAMT_TICKET_TIPO_BITACORA_CSC:1,SAMT_TICKET_SUBTIPO_BITACORA_CSC:3,TIB_DESCRIPCION:`${b[h].Label}: Cambio de '${b[h][f]}' a '${c[h][f]}'`,EMPLEADO_CSC_EMPLEADO:JSON.parse(localStorage.getItem("obj_DatosEmpleado")).EMPLEADO_CSC_EMPLEADO},f={...ReturnDefaultData_Init(),DATA_INSERT:f},a.TestBitacoraInsert(f))}return{}}n=JSON.parse(localStorage.getItem("obj_DatosEmpleado"));w=JSON.parse(localStorage.getItem("obj_SessionInfo"));p.hide();t.hide();Globalize.loadMessages(dictionary);var k=function(){var b=
sessionStorage.getItem("locale");return null!=b?b:"es-mx"}();Globalize.locale(k);DevExpress.localization.locale(k);(function(){var b=document.getElementById("lista-archivos-permitidos"),c=Math.ceil(a.extensionesDocumentos.length/3),d=document.createElement("div");d.classList.add("column-container");for(var f=0;3>f;f++){var h=document.createElement("div");h.classList.add("column");for(var l=document.createElement("ul"),q=Math.min((f+1)*c,a.extensionesDocumentos.length),r=f*c;r<q;r++){var u=a.extensionesDocumentos[r],
x=document.createElement("li");x.textContent=u;l.appendChild(x)}h.appendChild(l);d.appendChild(h)}b.innerHTML="";b.appendChild(d)})();a.patname=window.location.pathname;__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat","GET",{Tbl:"SAMT_TIPO_REQ_USO",NACTIVE:"TIPO_USO_DE_REQ_ACTIVO"},getJSON(DeveloperType).ApiGeneral.token).then(b=>{1==b.success?(jslinq(b.JsonData).where(function(c){return"CA"==c.TIPO_USO_DE_REQ_CLAVE.trim()}).toList(),b=jslinq(b.JsonData).select(function(c){return c.TIPO_USO_DE_REQ_CSC}).toList(),
a.Ids_TipoUso_Requi=b.join(",")):__cmb_component.option("dataSource",[])});__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_TIPO_TICKET_PARTICIPANTE"},getJSON(DeveloperType).ApiGeneral.token).then(b=>{a.jsonTiposParticipanes=1==b.success?b.JsonData:null});a.TipoOrigenCreacion="GENERA"==getUrlParam("TPO_USUARIO")?1:2;$("#___Tb_Tickets").dxToolbar({onContentReady:function(){$Btn_Alta_Ticket.option("visible",!1);$btn_Modificar_Ticket.option("visible",!0);$btn_Salvar_Alta_Ticket.option("visible",
!1);$btn_Salvar_Modifica_Ticket.option("visible",!1);$btn_Cancelar_Alta_Ticket.option("visible",!1);$btn_Cancelar_Modificar_Ticket.option("visible",!1);$btnCalificaAtencion.option("visible",!1)},items:[{location:"after",widget:"dxButton",locateInMenu:"auto",options:{icon:"check",text:"Calificar ticket",type:"default",onInitialized:function(b){$btnCalificaAtencion=b.component},onClick(){if(1==a.DataTicketOpen.TIC_CERRADO)a.notificaPantalla("Acci\u00f3n no permitida",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),
"El ticket ya se enuentra cerrado.");else{var b=a.Frm_Ticket_Servicio_Instance.getEditor("ESTATUS_TICKET_CSC").option("selectedItem");"RESUELTO"==b.ESTATUS_TICKET_CLAVE||"CANCELADO"==b.ESTATUS_TICKET_CLAVE?$("#Pop_Califica_Ticket_Solicitante").dxPopup("show"):a.notificaPantalla("Acci\u00f3n no permitida",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),`El ticket a\u00fan esta en "${b.ESTATUS_TICKET_IDIOMA1}", no es posible calificar.`)}}}},{location:"before",widget:"dxButton",locateInMenu:"auto",
options:{icon:"plus",text:"Alta",type:"default",onInitialized:function(b){$Btn_Alta_Ticket=b.component},onClick(){a.ClickAlta()}}},{location:"before",widget:"dxButton",locateInMenu:"auto",options:{icon:"save",text:"Salvar Alta",type:"success",onInitialized:function(b){$btn_Salvar_Alta_Ticket=b.component},onClick(){p.show();1==a.Frm_Ticket_Servicio_Instance.validate().isValid?a.Generar_Alta_Ticket():(p.hide(),DevExpress.ui.notify("LLENE LOS CAMPOS EN ROJO"))}}},{location:"after",widget:"dxButton",
locateInMenu:"auto",options:{icon:"clear",text:"Cancelar Alta",type:"danger",onInitialized:function(b){$btn_Cancelar_Alta_Ticket=b.component},onClick(){$Btn_Alta_Ticket.option("visible",!0);$btn_Modificar_Ticket.option("visible",!0);$btn_Cancelar_Alta_Ticket.option("visible",!1);$btn_Salvar_Alta_Ticket.option("visible",!1);a.Frm_Ticket_Servicio_Instance.resetValues();a.Frm_Ticket_Servicio_Instance.option("readOnly",!0)}}},{location:"after",widget:"dxButton",locateInMenu:"auto",options:{icon:"edit",
text:"Modificar",type:"normal",onInitialized:function(b){$btn_Modificar_Ticket=b.component},onClick(){if(""==a.Frm_Ticket_Servicio_Instance.getEditor("TIC_NEWID").option("value"))DevExpress.ui.notify({message:"No hay elemento a modificar",minWidth:150,type:"info",displayTime:5E3},{position:"bottom right",direction:"up-push"});else{var b=a.Frm_Ticket_Servicio_Instance.getEditor("ESTATUS_TICKET_CSC").option("selectedItem");if("RESUELTO"==b.ESTATUS_TICKET_CLAVE||"CANCELADO"==b.ESTATUS_TICKET_CLAVE)a.notificaPantalla("Alerta",
moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),`El ticket se encuentra en estatus de: ${b.ESTATUS_TICKET_IDIOMA1}, se espera calificaci\u00f3n del solicitante.`,300,120);else if(1==a.DataTicketOpen.TIC_CERRADO)a.notificaPantalla("Alerta",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),"El ticket ya se encuentra cerrado.");else switch(getUrlParam("TPO_USUARIO")){case "GENERA":DevExpress.ui.notify("EL TICKET YA SE ENCUENTRA EN PROCESO DE ATENCI\u00d3N.");a.Frm_Ticket_Servicio_Instance.getEditor("TIC_DESCRIPCION_SOLUCION").option("readOnly",
!0);a.Frm_Ticket_Servicio_Instance.getEditor("ESTATUS_TICKET_CSC").option("readOnly",!0);a.Frm_Ticket_Servicio_Instance.getEditor("REQ_CSCREQUISICION").option("readOnly",!1);a.Frm_Ticket_Servicio_Instance.getEditor("EMPLEADO_CSC_SOLICITA").option("readOnly",!0);a.Frm_Ticket_Servicio_Instance.getEditor("TIC_ATIENDE").option("readOnly",!0);a.Frm_Ticket_Servicio_Instance.getEditor("TIC_SOLICITA").option("readOnly",!0);a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("readOnly",
!0);a.Frm_Ticket_Servicio_Instance.getEditor("TIC_AUXS2").option("readOnly",!0);break;default:a.setDefaultValues=!1,a.LoadCatFull=!1,a.editandoForma=!0,$btn_Modificar_Ticket.option("visible",!1),$Btn_Alta_Ticket.option("visible",!1),$btn_Salvar_Modifica_Ticket.option("visible",!0),$btn_Cancelar_Modificar_Ticket.option("visible",!0),a.Frm_Ticket_Servicio_Instance.option("readOnly",!1),a.Frm_Ticket_Servicio_Instance.getEditor("TIC_DESCRIPCION").option("readOnly",!0),a.Frm_Ticket_Servicio_Instance.getEditor("REQ_CSCREQUISICION").option("readOnly",
!1),a.Frm_Ticket_Servicio_Instance.getEditor("EMPLEADO_CSC_SOLICITA").option("readOnly",!0),a.Frm_Ticket_Servicio_Instance.getEditor("TIC_ATIENDE").option("readOnly",!1),a.Frm_Ticket_Servicio_Instance.getEditor("TIC_SOLICITA").option("readOnly",!0),a.Frm_Ticket_Servicio_Instance.getEditor("TIC_AUXS2").option("readOnly",!1)}}}}},{location:"before",widget:"dxButton",locateInMenu:"auto",options:{icon:"save",text:"Salvar Modifica",type:"success",onInitialized:function(b){$btn_Salvar_Modifica_Ticket=b.component},
onClick(){var b=JSON.stringify(a.DataTicketOpen);a.DataTicketOpen=JSON.parse(b);var c=a.Frm_Ticket_Servicio_Instance.option("formData"),d=GetUpdateData(a.DataTicketOpen,c);b=0===Object.keys(d).length;var f=a.Frm_Ticket_Servicio_Instance.getEditor("ESTATUS_TICKET_CSC").option("selectedItem");1==a.Frm_Ticket_Servicio_Instance.validate().isValid?1==b?DevExpress.ui.notify({message:"No se detecto ningun cambio",minWidth:150,type:"info",displayTime:5E3},{position:"bottom right",direction:"up-push"}):(p.show(),
1==a.pauseTicket?("open"==c.TIC_ESTATUS_SLA_ENUM||""==c.TIC_ESTATUS_SLA_ENUM)&&__Reques_ajax("https://apimc.anam.gob.mx:3007/pauseTicket/7","POST",JSON.stringify({newIdTicket:a.DataTicketOpen.TIC_NEWID,idEmpresa:1,idEmpleadoProvider:254}),"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwcm92aWRlcl9kYXRhIjp7InByb3ZpZGVyX2lkIjo3LCJwcm92aWRlcl9uYW1lIjoiTUVTQSBERSBBWVVEQSBDT1NFTVNFQyIsInByb3ZpZGVyX2lkX2VtcCI6MjM2LCJwcm92aWRlcl9lbXBob3N0IjoxLCJwcm92aWRlcl9zZXJ2aWNpbyI6NywiY29udGV4dCI6eyJjbGllbnRUeXBlIjoiYXBpIn19LCJpYXQiOjE3MjM1ODkxMjV9.YKuNATRKIO58ko1KQ2tYhXusFzRqwCMd0xI_EzoAvgA").then(h=>
{1==h.success&&DevExpress.ui.notify({message:"Ticket pausado",minWidth:150,type:"success",displayTime:5E3},{position:"bottom right",direction:"up-push"});return h}).catch(function(h){p.hide();console.log(h);p.hide();DevExpress.ui.notify({message:"ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"})}):"pause"==c.TIC_ESTATUS_SLA_ENUM&&__Reques_ajax("https://apimc.anam.gob.mx:3007/resumeTicket/7","POST",JSON.stringify({newIdTicket:a.DataTicketOpen.TIC_NEWID,
idEmpresa:1,idEmpleadoProvider:254}),"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwcm92aWRlcl9kYXRhIjp7InByb3ZpZGVyX2lkIjo3LCJwcm92aWRlcl9uYW1lIjoiTUVTQSBERSBBWVVEQSBDT1NFTVNFQyIsInByb3ZpZGVyX2lkX2VtcCI6MjM2LCJwcm92aWRlcl9lbXBob3N0IjoxLCJwcm92aWRlcl9zZXJ2aWNpbyI6NywiY29udGV4dCI6eyJjbGllbnRUeXBlIjoiYXBpIn19LCJpYXQiOjE3MjM1ODkxMjV9.YKuNATRKIO58ko1KQ2tYhXusFzRqwCMd0xI_EzoAvgA").then(h=>{1==h.success&&DevExpress.ui.notify({message:"Ticket reactivado",minWidth:150,type:"success",displayTime:5E3},{position:"bottom right",
direction:"up-push"});return h}).catch(function(h){p.hide();console.log(h);p.hide();DevExpress.ui.notify({message:"ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"})}),setTimeout(function(){1==a.CalificadoRechazado&&a.InsertaBitacoraManual(c,"Cliente rechazo la soluci\u00f3n",!0,1,1);g(a.Frm_Ticket_Servicio_Instance);d.AUDITORIA_USU_ULT_MOD=n.EMPLEADO_CSC_EMPLEADO;d.AUDITORIA_FEC_ULT_MOD=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss");
d.EMP_CSC_EMPRESA_HOST=localStorage.getItem("EMP_CSC_EMPRESA_HOST");d.TIC_FECHA_ALTA&&(d.TIC_FECHA_ALTA=moment(d.TIC_FECHA_ALTA).add(CalculaTimeposInsertUpdate(),"hours").format("YYYY-MM-DD HH:mm:ss"));d.TIC_FECHA_SOLICITA&&(d.TIC_FECHA_SOLICITA=moment(d.TIC_FECHA_SOLICITA).add(CalculaTimeposInsertUpdate(),"hours").format("YYYY-MM-DD HH:mm:ss"));d.TIC_FECHA_PROMESA&&(d.TIC_FECHA_PROMESA=moment(d.TIC_FECHA_PROMESA).add(CalculaTimeposInsertUpdate(),"hours").format("YYYY-MM-DD HH:mm:ss"));if("RESUELTO"==
f.ESTATUS_TICKET_CLAVE||"CANCELADO"==f.ESTATUS_TICKET_CLAVE){d.TIC_FECHA_CIERRE=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss");d.TIC_FECHA_CIERRE_SOLA=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss");d.TIC_FECHA_CIERRE_HORA_COMPLETA=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss");d.TIC_FECHA_CIERRE_SISTEMA=moment().tz(a.TimeZoneServidor).add(24,"hours").format("YYYY-MM-DD HH:mm:ss");d.TIC_CERRADO_POR_SISTEMA=1;if(0==a.DataTicketOpen.TIC_DURACION_EJECUCION){var h=
moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),l=a.DataTicketOpen.TIC_FECHA_ALTA,q=moment(h);l=moment(l);q=q.diff(l,"seconds");d.TIC_DURACION_EJECUCION=q}h={...ReturnDefaultData_Init(),TIC_NEWID:a.DataTicketOpen.TIC_NEWID};__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"UpdateLogSla","POST",JSON.stringify(h),getJSON(DeveloperType).ApiTickets_v2.token).then(r=>{console.log(r)})}"AUTORIZA"==f.ESTATUS_TICKET_CLAVE&&1==f.ESTATUS_TICKET_CERRAR&&(d.TIC_FECHA_CIERRE=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),
d.TIC_FECHA_CIERRE_SOLA=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),d.TIC_FECHA_CIERRE_HORA_COMPLETA=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),d.TIC_FECHA_CIERRE_SISTEMA=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),d.TIC_CERRADO_POR_SISTEMA=1,0==a.DataTicketOpen.TIC_DURACION_EJECUCION&&(h=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),l=a.DataTicketOpen.TIC_FECHA_ALTA,q=moment(h),l=moment(l),q=q.diff(l,"seconds"),d.TIC_DURACION_EJECUCION=
q),h={...ReturnDefaultData_Init(),TIC_NEWID:a.DataTicketOpen.TIC_NEWID},__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"UpdateLogSla","POST",JSON.stringify(h),getJSON(DeveloperType).ApiTickets_v2.token).then(r=>{console.log(r)}));"AUTORIZA"==f.ESTATUS_TICKET_CLAVE&&0==f.ESTATUS_TICKET_CERRAR&&(d.TIC_REQ_AUTORIZACION=0);0==a.DataTicketOpen.TIC_DURACION_RECEPCION&&null==a.DataTicketOpen.TIC_FECHA_RECEPCION&&"AUTORIZA"!=f.ESTATUS_TICKET_CLAVE&&(h=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),
l=a.DataTicketOpen.AUDITORIA_FEC_ALTA,q=moment(h),l=moment(l),q=q.diff(l,"seconds"),d.TIC_DURACION_RECEPCION=q,d.TIC_FECHA_RECEPCION=h);h={...ReturnDefaultData_Init(),DATA_UPDATE:d,DATA_WHERE:{TIC_CSCTICKET:a.DataTicketOpen.TIC_CSCTICKET,TIC_NEWID:a.DataTicketOpen.TIC_NEWID,EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST")}};p.show();__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Update_Ticket_Servicio","POST",JSON.stringify(h),getJSON(DeveloperType).ApiTickets_v2.token).then(r=>
{if(1==r.success){var u={...ReturnDefaultData_Init(),TIC_NEWID:a.DataTicketOpen.TIC_NEWID};a.Get_Tickets(u,!1,null);DevExpress.ui.notify({message:"Ticket actualizado correctamente",minWidth:150,type:"success",displayTime:5E3},{position:"bottom right",direction:"up-push"});a.Flag_Fila=!1;$btn_Modificar_Ticket.option("visible",!0);$Btn_Alta_Ticket.option("visible",!1);$btn_Salvar_Modifica_Ticket.option("visible",!1);$btn_Cancelar_Modificar_Ticket.option("visible",!1);a.Frm_Ticket_Servicio_Instance.option("readOnly",
!0);a.pauseTicket=!1;u=createUUID(36);a.EnviaRespuesta("Ticket actualizado.",a.DataTicketOpen.TIC_NEWID,`<b>Actualizaci\u00f3n de ticket:</b> <br><br> <b>Estatus:</b> ${f.ESTATUS_TICKET_IDIOMA1} <br><br> <b>Descripci\u00f3n/Observaciones:</b> <br> ${d.TIC_DESCRIPCION_SOLUCION}`,u)}else p.hide();return r}).catch(function(r){console.log(r);p.hide();DevExpress.ui.notify({message:"Error al actualizar ticket intentelo nuevamente",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"})})},
2E3)):(p.hide(),DevExpress.ui.notify({message:"Llene los campos en rojo",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"}))}}},{location:"after",widget:"dxButton",locateInMenu:"auto",options:{icon:"clear",text:"Cancelar Modificar",type:"danger",onInitialized:function(b){$btn_Cancelar_Modificar_Ticket=b.component},onClick(){a.editandoForma=!1;a.pauseTicket=!1;$btn_Modificar_Ticket.option("visible",!0);$Btn_Alta_Ticket.option("visible",!1);$btn_Salvar_Modifica_Ticket.option("visible",
!1);$btn_Cancelar_Modificar_Ticket.option("visible",!1);a.Frm_Ticket_Servicio_Instance.option("readOnly",!0);var b=JSON.stringify(a.DataTicketOpen);a.DataTicketOpen=JSON.parse(b);a.Frm_Ticket_Servicio_Instance.updateData(a.DataTicketOpen)}}}]}).dxToolbar("instance");v=JSON.parse(sessionStorage.getItem("cat_origen_foto"));v=jslinq(v).where(function(b){return"TKT"==b.TIPO_ORIGEN_CLAVE}).toList();$("#Pop_Notificacion_Success").dxPopup({width:20,height:20,visible:!1,showTitle:!1,title:"Information",hideOnOutsideClick:!1,
onHiding:function(b){b.component.content().empty()},toolbarItems:[{widget:"dxButton",toolbar:"bottom",options:{text:"Cerrar",onClick(){$("#Pop_Notificacion_Success").dxPopup("hide")}}}]}).dxPopup("instance");$("#Pop_Upload_Foto_Ticket").dxPopup({width:20,height:20,visible:!1,showTitle:!0,title:"-",hideOnOutsideClick:!1,onHiding:function(b){b.component.content().empty()},toolbarItems:[{widget:"dxButton",toolbar:"bottom",options:{text:"Cerrar",onClick(){$("#Pop_Upload_Foto_Ticket").dxPopup("hide");
a.Get_Ticket_Foto();a.Get_Ticket_Documentos(!1)}}}]}).dxPopup("instance");$("#Pop_CrearVerRespuesta").dxPopup({width:"80%",height:400,visible:!1,showTitle:!1,shading:!1,title:"Respuesta/Mensaje",hideOnOutsideClick:!1,contentTemplate:function(b){var c=$("<div id='Frm_MensajeRespuesta'>");c.dxForm({readOnly:!1,showColonAfterLabel:!0,showValidationSummary:!1,validationGroup:"Validacion_Frm_MensajeRespuesta",labelMode:"static",labelLocation:"top",colCount:1,screenByWidth(h){return 700>h?"sm":"lg"},items:[{colSpan:2,
dataField:"RESPUESTA_ASUNTO",editorType:"dxTextBox",label:{text:"Asunto"},editorOptions:{readOnly:!1,valueChangeEvent:"keyup",onValueChanged:function(h){null!=h.value&&""!=h.value&&h.component.option("value",h.value.toUpperCase())}},validationRules:[{type:"required",message:"requerido"}]},{dataField:"RESPUESTA_DESCRIPCION",label:{text:"Descripci\u00f3n/Observaci\u00f3n"},editorType:"dxHtmlEditor",editorOptions:{height:130,toolbar:{items:["undo","redo","separator",{name:"size",acceptedValues:"8pt 10pt 12pt 14pt 18pt 24pt 36pt".split(" ")},
{name:"font",acceptedValues:"Arial;Courier New;Georgia;Impact;Lucida Console;Tahoma;Times New Roman;Verdana".split(";")},"separator","bold","italic","strike","underline","separator","alignLeft","alignCenter","alignRight","alignJustify","separator","color","background"]}},validationRules:[{type:"required",message:"requerido"}]}]}).dxForm("instance");let d=$("<div id='FileCorreoRespuesta'>");d.dxFileUploader({multiple:!0,allowedFileExtensions:a.ArchivosPermitidos,uploadMode:"useButtons",visible:!0,
disabled:!1,onValueChanged:function(h){var l=h.component.option("values");$.each(l,function(q,r){h.element.find(".dx-fileuploader-upload-button").hide()});h.element.find(".dx-fileuploader-upload-button").hide()}}).dxFileUploader("instance");let f=JSON.stringify(a.ArchivosPermitidos);b.append(function(h){return $('<div style="height:100%;">').append(c,'<div class="heading_InnerFrm" style="margin-bottom:5px;"><h2>Archivos permitidos: '+f+"</h2></div>",d)})},toolbarItems:[{widget:"dxButton",toolbar:"bottom",
options:{icon:"save",type:"success",text:"Enviar respuesta",onClick(){p.show();var b=$("#Frm_MensajeRespuesta").dxForm("instance").option("formData");let c=a.Frm_Ticket_Servicio_Instance.option("formData");if(!1===$("#Frm_MensajeRespuesta").dxForm("instance").validate().isValid)DevExpress.ui.notify({message:"Llene los campos en rojo",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"}),p.hide();else{var d=$("#FileCorreoRespuesta").dxFileUploader("instance")._files;
if(0<d.length)for(let h=0;h<d.length;h++)if(0==d[h].isValid()){p.hide();DevExpress.ui.notify({message:"Un archivo no cumple con las reglas",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"});return}var f=createUUID(36);d=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss");b.EMP_CSC_EMPRESA_HOST=localStorage.getItem("EMP_CSC_EMPRESA_HOST");b.TIC_CSCTICKET=c.TIC_CSCTICKET;b.SAMT_ESTATUS_RESPUESTA_CSC=1;b.RESPUESTA_FECHAHORA_ALTA=d;b.AUDITORIA_USU_ALTA=
n.EMPLEADO_CSC_EMPLEADO;b.AUDITORIA_USU_ULT_MOD=n.EMPLEADO_CSC_EMPLEADO;b.AUDITORIA_FEC_ALTA=d;b.AUDITORIA_FEC_ULT_MOD=d;b.RESPUESTA_NOMBRE=n.EMPLEADO_NOMBREEMPLEADO+" "+n.EMPLEADO_APATERNOEMPLEADO;b.TICKET_MENSAJE_NEWID=f;"GENERA"==getUrlParam("TPO_USUARIO")?(b.RESPUESTA_LEIDO_CLIENTE=!0,b.RESPUESTA_FEC_LEIDO_CLIENTE=d,b.RESPUESTA_CLAVE="CLIENTE"):(b.RESPUESTA_LEIDO_OPERADOR=!0,b.RESPUESTA_FEC_LEIDO_OPERADOR=d,b.RESPUESTA_CLAVE="OPERADOR");d={...ReturnDefaultData_Init(),DATA_INSERT:b};a.attachDocToMessageTicket(f);
__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Insert_Respuesta_Mensaje","POST",JSON.stringify(d),getJSON(DeveloperType).ApiTickets_v2.token).then(h=>{1==h.success?(DevExpress.ui.notify({message:"Mensaje creado correctamente",minWidth:150,type:"success",displayTime:5E3},{position:"bottom right",direction:"up-push"}),p.hide(),"GENERA"!=getUrlParam("TPO_USUARIO")&&(a.EnviaRespuesta("Respuesta",c.TIC_NEWID,b.RESPUESTA_DESCRIPCION,f),$("#Pop_CrearVerRespuesta").dxPopup("hide")),a.Get_Respuesta_Mensaje(a.Frm_Ticket_Servicio_Instance.option("formData").TIC_CSCTICKET)):
p.hide();return h}).catch(function(h){console.log(h);p.hide();DevExpress.ui.notify({message:"ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"})})}}}},{widget:"dxButton",toolbar:"bottom",options:{text:"Cerrar",onClick(){$("#Pop_CrearVerRespuesta").dxPopup("hide")}}}],onHiding:function(b){$("#Frm_MensajeRespuesta").dxForm("instance").resetValues();$("#FileCorreoRespuesta").dxFileUploader("instance").reset()}}).dxPopup("instance");
a.attachDocToMessageTicket=function(b){let c=$("#FileCorreoRespuesta").dxFileUploader("instance"),d=c.option("value");var f=c._files;if(0!=d.length){if(0<f.length)for(let h=0;h<f.length;h++)if(0==f[h].isValid()){a.notificaPantalla("Alerta",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),"Un archivo no cumple con las reglas",400,130);return}f=new FormData;b={ClaveEmp:localStorage.getItem("EMP_CLV_EMPRESA"),EmpresaHost:parseInt(localStorage.getItem("EMP_CSC_EMPRESA_HOST")),TypeCon:localStorage.getItem("Type"),
ClaveDoc:"TICKET_MENSAJE",IdEmpleado:n.EMPLEADO_CSC_EMPLEADO,cscEmpleado:n.EMPLEADO_CSC_EMPLEADO,NewIdEquipo:a.Frm_Ticket_Servicio_Instance.getEditor("TIC_NEWID").option("value"),OrigenCrea:a.TipoOrigenCreacion,NewIdMessage:b};console.log(b);f.append("extra",JSON.stringify(b));if(0<d.length)for(b=0;b<d.length;b++)f.append("fileToUpload",d[b]);$.ajax({xhr:function(){let h=new window.XMLHttpRequest;h.upload.addEventListener("progress",function(l){l.lengthComputable&&(l=l.loaded/l.total,l=parseInt(100*
l),console.log(l))},!1);return h},type:"POST",url:`${getJSON(DeveloperType).Bot_Internal_Storage_Anam.url}uploadAttachmentMessageToTicket`,data:f,dataType:"json",cache:!1,contentType:!1,processData:!1,headers:{}}).done(function(h){1==h.success&&(c.reset(),DevExpress.ui.notify({message:"Archivo(s) cargado(s) correctamente",minWidth:150,type:"success",displayTime:5E3},{position:"bottom right",direction:"up-push"}),a.Get_Ticket_Documentos(!1))}).fail(function(h){console.log(h);DevExpress.ui.notify({message:"Error de comunicaci\u00f3n con servidor",
minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"})})}};$("#Pop_Califica_Ticket_Solicitante").dxPopup({width:400,height:300,visible:!1,showTitle:!0,title:"Su opinion es muy importante, por favor califique el servicio.",hideOnOutsideClick:!1,contentTemplate:function(b){var c=$("<div id='frmCalificaTicket'>");c.dxForm({readOnly:!1,showColonAfterLabel:!0,showValidationSummary:!1,validationGroup:"Validacion_frmCalificaTicket",labelMode:"static",labelLocation:"top",
colCount:1,screenByWidth(d){return 700>d?"sm":"lg"},items:[{colSpan:1,dataField:"TIPO_CALIFICACION_CSC",editorType:"dxSelectBox",label:{text:"Calificaci\u00f3n"},editorOptions:{searchEnabled:!0,displayExpr:"TIPO_CALIFICACION_IDIOMA1",valueExpr:"TIPO_CALIFICACION_CSC",deferRendering:!1,dataSource:new DevExpress.data.DataSource({loadMode:"raw",paginate:!1,load:async function(){try{var d={Tbl:"SAMT_TIPO_CALIFICACION",WHR:"EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")+" AND TIPO_CALIFICACION_ACTIVO = 1 "};
return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr","GET",d,getJSON(DeveloperType).ApiGeneral.token).then(f=>{if(1==f.success)return jslinq(f.JsonData).where(function(h){return"NA"!=h.TIPO_CALIFICACION_CLAVE}).toList();console.log(f.message)})}catch(f){console.log(f)}}}),onOpened:function(d){d.component.getDataSource().load().done(function(f){a.TIPO_CALIFICACION_CSC=f;f=jslinq(f).where(function(h){return 1==h.TIPO_CALIFICACION_ACTIVO}).toList();d.component.option("dataSource",
f)})},onClosed:function(d){d.component.getDataSource().items()!==a.TIPO_CALIFICACION_CSC&&d.component.option("dataSource",a.TIPO_CALIFICACION_CSC)},onValueChanged:function(d){d=d.component.option("selectedItem");null!=d&&("CCC"==d.TIPO_CALIFICACION_CLAVE?$("#frmCalificaTicket").dxForm("instance").itemOption("TIC_CALIFICACION_COMENTARIO","isRequired",!0):$("#frmCalificaTicket").dxForm("instance").itemOption("TIC_CALIFICACION_COMENTARIO","isRequired",!1))}},validationRules:[{type:"required",message:"requerido"}]},
{dataField:"TIC_CALIFICACION_COMENTARIO",editorType:"dxTextArea",colSpan:1,label:{text:"Descripci\u00f3n/Observaci\u00f3n"},editorOptions:{height:150,valueChangeEvent:"keyup",onValueChanged:function(d){},buttons:[{name:"ObtenPortapapel",location:"after",options:{stylingMode:"Contained",icon:"pasteplaintext",type:"normal",onClick(d){a.ObtenClipboard("Frm_MensajeRespuesta","RESPUESTA_DESCRIPCION")}}}]}}]}).dxForm("instance");b.append(c)},toolbarItems:[{widget:"dxButton",toolbar:"bottom",options:{icon:"save",
type:"success",text:"Calificar",onClick(){var b=$("#frmCalificaTicket").dxForm("instance").option("formData");!0===$("#frmCalificaTicket").dxForm("instance").validate().isValid?(b.AUDITORIA_USU_ULT_MOD=n.EMPLEADO_CSC_EMPLEADO,b.AUDITORIA_FEC_ULT_MOD=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),b.TIC_CERRADO=!0,b.TIC_CERRADO_POR_SISTEMA=0,b.TIC_CALIFICADO=1,b.TIC_CALIFICACION_FECHA=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),b={...ReturnDefaultData_Init(),DATA_UPDATE:b,
DATA_WHERE:{TIC_CSCTICKET:a.DataTicketOpen.TIC_CSCTICKET,TIC_NEWID:a.DataTicketOpen.TIC_NEWID,EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST")}},__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Update_Ticket_Servicio","POST",JSON.stringify(b),getJSON(DeveloperType).ApiTickets_v2.token).then(c=>{1==c.success&&(c={...ReturnDefaultData_Init(),TIC_NEWID:a.DataTicketOpen.TIC_NEWID},a.Get_Tickets(c,!1,null),$("#Pop_Califica_Ticket_Solicitante").dxPopup("hide"))}).catch(function(c){DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE",
"error",3E3)})):a.notificaPantalla("Alerta",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),"Llene los campos en rojo.",400,130)}}},{widget:"dxButton",toolbar:"bottom",options:{text:"Cerrar",onClick(){$("#Pop_Califica_Ticket_Solicitante").dxPopup("hide")}}}],onHiding:function(b){$("#frmCalificaTicket").dxForm("instance").resetValues()}}).dxPopup("instance");$("#Pop_Insertar_BitacoraManual").dxPopup({width:400,height:300,visible:!1,showTitle:!1,title:"Ingrese bitacora",hideOnOutsideClick:!1,
contentTemplate:function(b){var c=$("<div id='Frm_BitacoraManual'>");c.dxForm({readOnly:!1,showColonAfterLabel:!0,showValidationSummary:!1,validationGroup:"Validacion_Frm_BitacoraManual",labelMode:"static",labelLocation:"top",colCount:1,screenByWidth(d){return 700>d?"sm":"lg"},items:[{dataField:"INFO_BITACORA",editorType:"dxTextArea",colSpan:6,label:{text:"Descripci\u00f3n/Observaci\u00f3n"},editorOptions:{height:150,valueChangeEvent:"keyup",onValueChanged:function(d){},buttons:[{name:"ObtenPortapapel",
location:"after",options:{stylingMode:"Contained",icon:"pasteplaintext",type:"normal",onClick(d){a.ObtenClipboard("Frm_MensajeRespuesta","RESPUESTA_DESCRIPCION")}}}]},validationRules:[{type:"required",message:"requerido"}]}]}).dxForm("instance");b.append(c)},toolbarItems:[{widget:"dxButton",toolbar:"bottom",options:{icon:"save",type:"success",text:"Salvar",onClick(){var b=$("#Frm_BitacoraManual").dxForm("instance").option("formData"),c={};c.TIC_CSCTICKET=a.DataTicketOpen.TIC_CSCTICKET;c.ESTATUS_TICKET_CSC=
a.DataTicketOpen.ESTATUS_TICKET_CSC;a.InsertaBitacoraManual(c,b.INFO_BITACORA,!1,1,1)}}},{widget:"dxButton",toolbar:"bottom",options:{text:"Cerrar",onClick(){$("#Pop_Insertar_BitacoraManual").dxPopup("hide");a.Get_Bitacora_tickets(a.DataTicketOpen.TIC_CSCTICKET)}}}],onHiding:function(b){a.Get_Bitacora_tickets(a.DataTicketOpen.TIC_CSCTICKET);$("#Frm_BitacoraManual").dxForm("instance").resetValues()}}).dxPopup("instance");$("#Pop_Open_Ot_desde_ticket").dxPopup({hideOnOutsideClick:!1,title:"Orden de trabajo",
height:"100%",width:"100%",position:{my:"center",at:"center",of:window},onHiding:function(b){a.Get_Linkeo_ticket_ot(a.DataTicketOpen.TIC_CSCTICKET);a.Get_Autorizaciones_Ticket(a.DataTicketOpen.TIC_NEWID);document.getElementById("Mod_Embebed_Ot_desde_ticket").src=""},onShowing:function(b){},onShown:function(b){}});a.TabPanel_Ticket_Detalle=$("#Tab_Panel_Ticket_Detalle").dxTabPanel({onContentReady:function(){a.imageUploadToTicket=$("#fUploadImageToTicket").dxFileUploader({selectButtonText:"Seleccione archivo(s)",
multiple:!0,maxFileSize:20971520,accept:"image/*, video/mp4",uploadMode:"useButtons",visible:!0,disabled:!1,onValueChanged:function(b){var c=b.component.option("values");$.each(c,function(d,f){b.element.find(".dx-fileuploader-upload-button").hide()});b.element.find(".dx-fileuploader-upload-button").hide()}}).dxFileUploader("instance");a.documentsUploadToTicket=$("#documentsUploadToTicket").dxFileUploader({selectButtonText:"Seleccione archivo(s)",multiple:!0,maxFileSize:20971520,allowedFileExtensions:a.extensionesDocumentos,
uploadMode:"useButtons",visible:!0,disabled:!1,onValueChanged:function(b){var c=b.component.option("values");$.each(c,function(d,f){b.element.find(".dx-fileuploader-upload-button").hide()});b.element.find(".dx-fileuploader-upload-button").hide()}}).dxFileUploader("instance")},animationEnabled:!1,deferRendering:!1,repaintChangesOnly:!1,elementAttr:{id:"Tab-TicketDetalle"},dataSource:[],selectedIndex:0,showNavButtons:!0,scrollByContent:!0,scrollingEnabled:!0,itemTitleTemplate:function(b,c,d){d.append($('<img src="'+
b.icon+'" class="navIcon" alt="Icon Menu"/>')).append($("<span>").text(b.title))},onSelectionChanged:function(b){b=b.addedItems[0];if("ALTA"==getUrlParam("TIPO"))1==a.setDefaultValues&&($_Btn_Cargar_Imagen_Sistema.option("visible",!1),$_Btn_Agregar_Documento.option("visible",!1));else switch(b.template){case "tab_frmticketservicio":a.Get_Ticket_Documentos(!1);break;case "tab_add_empleados":a.Get_Emp_Ticket(a.DataTicketOpen.TIC_NEWID);break;case "tab_RepFotograf":a.Get_Ticket_Foto();break;case "tab_DocumentosTk":a.Get_Ticket_Documentos(!1);
break;case "tab_respuestas_rapidas":a.Get_Respuesta_Mensaje(a.DataTicketOpen.TIC_CSCTICKET);break;case "tab_bitacoras":a.Get_Bitacora_tickets(a.DataTicketOpen.TIC_CSCTICKET);break;case "tab_participantes":a.Get_Ticket_Participantes(a.DataTicketOpen.TIC_NEWID);break;case "tab_Empleado_Solicita":null!=a.DatosEmpleadosGet&&void 0!=a.DatosEmpleadosGet||a.Get_Datos_Empleado_Solicita(a.DataTicketOpen.EMPLEADO_CSC_SOLICITA)}}}).dxTabPanel("instance");a.VistaSegunCondicion=()=>{switch(a.TipoOrigenCreacion){case 1:a.TabPanel_Ticket_Detalle.option("dataSource",
[{icon:"../../../images/Icons/surveys128.png",title:Globalize.formatMessage("tabGeneralTitleTicket"),template:"tab_frmticketservicio"},{icon:"../../../images/Icons/Card-file-icon64.png",title:Globalize.formatMessage("tabGeneralTitleRepFoto"),template:"tab_RepFotograf"},{icon:"../../../images/Icons/Card-file-icon64.png",title:Globalize.formatMessage("tabGeneralTitleDocumentos"),template:"tab_DocumentosTk"},{icon:"../../../images/Icons/Content-tree-icon48.png",title:Globalize.formatMessage("tabGeneralTitleMensajeRespuesta"),
template:"tab_respuestas_rapidas"},{icon:"../../../images/Icons/Actions-document-edit-icon64.png",title:Globalize.formatMessage("tabGeneralTitleBitacoras"),template:"tab_bitacoras"}]);a.CamposVisiblesDG=!0;a.BotonesDisponibles=!1;break;case 2:a.TabPanel_Ticket_Detalle.option("dataSource",[{icon:"../../../images/Icons/surveys128.png",title:Globalize.formatMessage("tabGeneralTitleTicket"),template:"tab_frmticketservicio"},{icon:"../../../images/Icons/Card-file-icon64.png",title:Globalize.formatMessage("tabGeneralTitleRepFoto"),
template:"tab_RepFotograf"},{icon:"../../../images/Icons/Card-file-icon64.png",title:Globalize.formatMessage("tabGeneralTitleDocumentos"),template:"tab_DocumentosTk"},{icon:"../../../images/Icons/Content-tree-icon48.png",title:Globalize.formatMessage("tabGeneralTitleMensajeRespuesta"),template:"tab_respuestas_rapidas"},{icon:"../../../images/Icons/Actions-document-edit-icon64.png",title:Globalize.formatMessage("tabGeneralTitleBitacoras"),template:"tab_bitacoras"}]),a.CamposVisiblesDG=!0,a.BotonesDisponibles=
!0}};a.VistaSegunCondicion();$("#Frm_Btn_AgregarBitacora").dxForm({showColonAfterLabel:!0,showValidationSummary:!1,labelMode:"static",labelLocation:"top",screenByWidth(b){return 700>b?"sm":"lg"},items:[{itemType:"group",colSpan:1,colCount:1,items:[{colSpan:1,itemType:"button",location:"before",locateInMenu:"auto",buttonOptions:{text:"Agregar Bitacora",icon:"add",type:"success",width:"100%",visible:!0,disabled:!1,onInitialized:function(b){$_Btn_Agregar_Bitacora=b.component},onClick(){1==a.DataTicketOpen.TIC_CERRADO?
DevExpress.ui.notify({message:"LA SOLICITUD YA SE ENCUENTRA CERRADO.",minWidth:150,type:"info",displayTime:5E3},{position:"bottom right",direction:"up-push"}):$("#Pop_Insertar_BitacoraManual").dxPopup("show")}}},{colSpan:9,template:" "}]}]});$("#Form_Btn_Cargar_Imagen_Sistema").dxForm({showColonAfterLabel:!0,showValidationSummary:!1,labelMode:"static",labelLocation:"top",screenByWidth(b){return 700>b?"sm":"lg"},items:[{itemType:"group",colSpan:1,colCount:1,items:[{colSpan:1,itemType:"button",location:"before",
locateInMenu:"auto",buttonOptions:{text:Globalize.formatMessage("Add_Document"),icon:"upload",type:"success",width:"100%",visible:!0,disabled:!1,onInitialized:function(b){$_Btn_Cargar_Imagen_Sistema=b.component},onClick(){1==a.DataTicketOpen?.TIC_CERRADO?DevExpress.ui.notify({message:`${Globalize.formatMessage("infoTicketClosed")}`,minWidth:150,type:"info",displayTime:5E3},{position:"bottom right",direction:"up-push"}):(1==a.setDefaultValues&&a.notificaPantalla("Alerta",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),
"Las im\u00e1genes se dar\u00e1n de alta autom\u00e1ticamente cuando salve el ticket.",400,130),a.uploadImageToTicket(!0))}}},{colSpan:9,template:" "}]}]});a.uploadImageToTicket=function(b=!1){if(null==a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("value"))a.notificaPantalla("Alerta",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),"Selecciona el proveedor en el detalle de solicitud",400,130);else{var c=a.imageUploadToTicket.option("value"),d=a.imageUploadToTicket._files;
if(0!=c.length)if(1==b&&0==c.length)a.notificaPantalla("Alerta",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),"Debe seleccionar al menos 1 imagen",400,130);else{if(0<d.length)for(b=0;b<d.length;b++)if(0==d[b].isValid()){a.notificaPantalla("Alerta",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),"Un archivo no cumple con las reglas",400,130);return}d=new FormData;b={ClaveEmp:localStorage.getItem("EMP_CLV_EMPRESA"),idEmpleadoProvider:n.EMPLEADO_CSC_EMPLEADO,newIdTicket:a.Frm_Ticket_Servicio_Instance.getEditor("TIC_NEWID").option("value")};
d.append("extra",JSON.stringify(b));if(0<c.length)for(b=0;b<c.length;b++)d.append("fileToUpload",c[b]);$.ajax({xhr:function(){let f=new window.XMLHttpRequest;f.upload.addEventListener("progress",function(h){h.lengthComputable&&(h=h.loaded/h.total,h=parseInt(100*h),console.log(h))},!1);return f},type:"POST",url:`${getJSON(DeveloperType).Bot_Internal_Storage_Anam.url}uploadImagesToTicket/${a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("value")}`,data:d,dataType:"json",
cache:!1,contentType:!1,processData:!1,headers:{}}).done(function(f){1==f.success&&(a.imageUploadToTicket.reset(),DevExpress.ui.notify({message:"Imagen(es) cargada(s) correctamente",minWidth:150,type:"success",displayTime:5E3},{position:"bottom right",direction:"up-push"}),a.Get_Ticket_Foto())}).fail(function(f){console.log(f);DevExpress.ui.notify({message:"Error de comunicaci\u00f3n con servidor",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"})})}}};$("#Form_Btn_Agregar_Documento").dxForm({showColonAfterLabel:!0,
showValidationSummary:!1,labelMode:"static",labelLocation:"top",screenByWidth(b){return 700>b?"sm":"lg"},items:[{itemType:"group",colSpan:1,colCount:1,items:[{colSpan:1,itemType:"button",location:"before",locateInMenu:"auto",buttonOptions:{text:Globalize.formatMessage("Add_Document"),icon:"upload",type:"success",width:"100%",visible:!0,disabled:!1,onInitialized:function(b){$_Btn_Agregar_Documento=b.component},onClick(){1==a.DataTicketOpen?.TIC_CERRADO?DevExpress.ui.notify({message:`${Globalize.formatMessage("infoTicketClosed")}`,
minWidth:150,type:"info",displayTime:5E3},{position:"bottom right",direction:"up-push"}):a.uploadFileToTicket(!0)}}},{colSpan:9,template:" "}]}]});a.uploadFileToTicket=function(b=!1){if(null==a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("value"))a.notificaPantalla("Alerta",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),"Selecciona el proveedor en el detalle de solicitud",400,130);else{var c=a.documentsUploadToTicket.option("value"),d=a.documentsUploadToTicket._files;
if(0!=c.length)if(1==b&&0==c.length)a.notificaPantalla("Alerta",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),"Debe seleccionar al menos 1 archivo",400,130);else{if(0<d.length)for(b=0;b<d.length;b++)if(0==d[b].isValid()){a.notificaPantalla("Alerta",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),"Un archivo no cumple con las reglas",400,130);return}d=new FormData;b={ClaveEmp:localStorage.getItem("EMP_CLV_EMPRESA"),idEmpleadoProvider:n.EMPLEADO_CSC_EMPLEADO,newIdTicket:a.Frm_Ticket_Servicio_Instance.getEditor("TIC_NEWID").option("value")};
d.append("extra",JSON.stringify(b));if(0<c.length)for(b=0;b<c.length;b++)d.append("fileToUpload",c[b]);$.ajax({xhr:function(){let f=new window.XMLHttpRequest;f.upload.addEventListener("progress",function(h){h.lengthComputable&&(h=h.loaded/h.total,h=parseInt(100*h),console.log(h))},!1);return f},type:"POST",url:`${getJSON(DeveloperType).Bot_Internal_Storage_Anam.url}uploadDocumentToTicket/${a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("value")}`,data:d,dataType:"json",
cache:!1,contentType:!1,processData:!1,headers:{}}).done(function(f){1==f.success&&(a.documentsUploadToTicket.reset(),DevExpress.ui.notify({message:"Archivo(s) cargado(s) correctamente",minWidth:150,type:"success",displayTime:5E3},{position:"bottom right",direction:"up-push"}),a.Get_Ticket_Documentos(!1))}).fail(function(f){console.log(f);DevExpress.ui.notify({message:"Error de comunicaci\u00f3n con servidor",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"})})}}};
$("#Form_Btn_Agregar_Mensaje").dxForm({showColonAfterLabel:!0,showValidationSummary:!1,labelMode:"static",labelLocation:"top",screenByWidth(b){return 700>b?"sm":"lg"},items:[{itemType:"group",colSpan:1,colCount:1,items:[{colSpan:1,itemType:"button",location:"before",locateInMenu:"auto",buttonOptions:{text:"Agregar Respuesta",icon:"add",type:"success",width:"100%",visible:!0,disabled:!1,onInitialized:function(b){$_Btn_Agregar_Respuesta=b.component},onClick(){1==a.DataTicketOpen.TIC_CERRADO?DevExpress.ui.notify({message:"LA SOLICITUD YA SE ENCUENTRA CERRADO.",
minWidth:150,type:"info",displayTime:5E3},{position:"bottom right",direction:"up-push"}):$("#Pop_CrearVerRespuesta").dxPopup("show")}}},{colSpan:9,template:" "}]}]});$("#Form_Btn_Alta_Ticket_Ot").dxForm({readOnly:!1,showColonAfterLabel:!0,showValidationSummary:!1,labelMode:"static",labelLocation:"top",colCount:1,screenByWidth(b){return 700>b?"sm":"lg"},items:[{itemType:"group",colSpan:1,colCount:1,items:[{colSpan:1,itemType:"button",location:"before",locateInMenu:"auto",buttonOptions:{text:"Agregar Orden de trabajo",
icon:"add",type:"success",width:"100%",visible:!0,onInitialized:function(b){$_btn_Alta_Ticket_Ot=b.component},onClick(){1==a.DataTicketOpen.TIC_CERRADO?DevExpress.ui.notify({message:"LA SOLICITUD YA SE ENCUENTRA CERRADO.",minWidth:150,type:"info",displayTime:5E3},{position:"bottom right",direction:"up-push"}):e("ALTA",null,a.DataTicketOpen.TIC_CSCTICKET)}}},{colSpan:9,template:" "}]}]});a.Frm_Autoriza_Instance=$("#Form_Btn_Alta_Autorizacion").dxForm({readOnly:!1,showColonAfterLabel:!0,showValidationSummary:!1,
validationGroup:"Form_Btn_Alta_Autorizacion",labelMode:"static",labelLocation:"top",colCount:4,screenByWidth(b){return 700>b?"sm":"lg"},items:[{itemType:"group",colSpan:4,colCount:4,items:[{colSpan:4,dataField:"TIPO_AREA_CSC_RESPONSABLE",editorType:"dxSelectBox",label:{text:"Area"},editorOptions:{searchEnabled:!0,displayExpr:"TIPO_AREA_IDIOMA1",valueExpr:"TIPO_AREA_CSC",dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.CustomStore({key:"TIPO_AREA_CSC",loadMode:"raw",paginate:!1,
load:async function(){return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_CAT_EMPLEADO_AREA"},getJSON(DeveloperType).ApiGeneral.token).then(b=>{if(1==b.success)return jslinq(b.JsonData).where(function(c){return c.CAM_CSC_MESA==n.CAM_CSC_MESA}).orderBy(function(c){return c.TIPO_AREA_IDIOMA1}).toList();console.log(b.message)})}})}),onOpened:function(b){b.component.getDataSource().load().done(function(c){a.TIPO_AREA_CSC=c;c=jslinq(c).where(function(d){return 1==
d.TIPO_AREA_ACTIVO}).toList();b.component.option("dataSource",c)})},onClosed:function(b){b.component.getDataSource().items()!==a.TIPO_AREA_CSC&&b.component.option("dataSource",a.TIPO_AREA_CSC)},onValueChanged:function(b){b=b.value;var c=a.Frm_Autoriza_Instance.getEditor("CAT_DEPTO_CSC_RESPONSABLE");c.option("value",null);b={Tbl:"SAMT_CAT_EMPLEADO_DEPARTAMENTO",WHR:"EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")+" AND TIPO_AREA_CSC = "+b};__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+
"Get_Cat_Whr","GET",b,getJSON(DeveloperType).ApiGeneral.token).then(d=>{1==d.success?c.option("dataSource",d.JsonData):c.option("dataSource",[])})}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:4,dataField:"CAT_DEPTO_CSC_RESPONSABLE",editorType:"dxSelectBox",label:{text:"Departamento"},editorOptions:{searchEnabled:!0,displayExpr:"SAMT_TIPO_DEPARTAMENTO_IDIOMA1",valueExpr:"EMPLEADO_DEPARTAMENTO_CSC",onValueChanged:function(b){b=b.value;var c=a.Frm_Autoriza_Instance.getEditor("EMPLEADO_CSC_EMPLEADO");
b={...ReturnDefaultData_Init(),...ReturnProcSubProcEstatus(),TIPO_CONSULTA:"AVANZADO",INFO:"ALLEMP",CAT_DEPARTAMENTO_CSC:b};__Reques_ajax(getJSON(DeveloperType).ApiRecursosHumanos.url+"GetEmpleado","GET",b,getJSON(DeveloperType).ApiRecursosHumanos.token).then(d=>{1==d.success&&c.option("dataSource",d.JsonData);p.hide()}).catch(function(d){DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE","error",3E3);p.hide()})}},validationRules:[{type:"required",message:"requerido"}]},
{colSpan:4,dataField:"EMPLEADO_CSC_EMPLEADO",editorType:"dxSelectBox",label:{text:"Empleado Asignado"},editorOptions:{searchEnabled:!0,displayExpr:"NOMBRE",valueExpr:"EMPLEADO_CSC_EMPLEADO",deferRendering:!1,onValueChanged:function(b){}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:4,itemType:"button",location:"before",locateInMenu:"auto",buttonOptions:{text:"Solicitar autorizaci\u00f3n",icon:"add",type:"success",width:"100%",visible:!0,onInitialized:function(b){$btn_Alta_Ticket_Autorizacion=
b.component},onClick(){if(1==a.DataTicketOpen.TIC_CERRADO)DevExpress.ui.notify({message:"LA SOLICITUD YA SE ENCUENTRA CERRADO.",minWidth:150,type:"info",displayTime:5E3},{position:"bottom right",direction:"up-push"});else if(!0===a.Frm_Autoriza_Instance.validate().isValid){p.show();var b=a.Frm_Ticket_Servicio_Instance.option("formData"),c=GetInsertData(a.Frm_Autoriza_Instance.option("formData"),a.Frm_Autoriza_Instance);c.AUDITORIA_USU_ALTA=n.EMPLEADO_CSC_EMPLEADO;c.AUDITORIA_USU_ULT_MOD=n.EMPLEADO_CSC_EMPLEADO;
c.AUDITORIA_FEC_ALTA=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss");c.AUDITORIA_FEC_ULT_MOD=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss");c.EMP_CSC_EMPRESA_HOST=localStorage.getItem("EMP_CSC_EMPRESA_HOST");c.AUTORIZACIONES_TIC_NEWID=b.TIC_NEWID;c.CAM_MESA_CSC=b.CAM_MESA_CSC;c.SAMT_TIPO_RESPUESTA_AUTORIZA_CSC=2;c.AUTORIZACIONES_NEWID=createUUID(36);c.AUTORIZADO_ACTIVO=1;delete c.CAT_DEPTO_CSC_RESPONSABLE;delete c.TIPO_AREA_CSC_RESPONSABLE;c={...ReturnDefaultData_Init(),
DATA_INSERT:c};__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Insert_Autoriza_Ticket","POST",JSON.stringify(c),getJSON(DeveloperType).ApiTickets_v2.token).then(d=>{1==d.success&&(a.Frm_Autoriza_Instance.resetValues(),DevExpress.ui.notify({message:"Solicitud de autorizaci\u00f3n agregada correctamente",minWidth:150,type:"success",displayTime:5E3},{position:"bottom right",direction:"up-push"}),a.Get_Autorizaciones_Ticket(b.TIC_NEWID),b.TIC_FECHA_ALTA&&ConvertDatetimeToStringBD(b.TIC_FECHA_ALTA),
b.TIC_FECHA_PROMESA&&ConvertDatetimeToStringBD(b.TIC_FECHA_PROMESA),b.TIC_FECHA_SOLICITA&&ConvertDatetimeToStringBD(b.TIC_FECHA_SOLICITA));p.hide();return d}).catch(function(d){console.log(d);p.hide();DevExpress.ui.notify({message:"ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"})})}}}},{colSpan:9,template:" "}]}]}).dxForm("instance");a.Frm_Ticket_Servicio_Instance=$("#__Frm_Ticket_Servicio").dxForm({onContentReady:function(){setTimeout(()=>
{if("EDITAR"==getUrlParam("TIPO")){var b={...ReturnDefaultData_Init(),TIC_NEWID:getUrlParam("TK_ID"),CAM_CSC_SERVICIO:parseInt(getUrlParam("CSC_MESA"))};a.Get_Tickets(b,!1,null)}else if("ALTA"==getUrlParam("TIPO")){try{a.ClickAlta()}catch(c){console.log(c)}$("#__Frm_Ticket_Servicio").dxForm("instance").getEditor("CAM_MESA_CSC").option("value",getUrlParam("CSC_MESA"))}else"LECTURA"==getUrlParam("TIPO")&&(b={...ReturnDefaultData_Init(),TIC_NEWID:getUrlParam("TK_ID"),CAM_CSC_SERVICIO:parseInt(getUrlParam("CSC_MESA"))},
a.Get_Tickets(b,!1,null),$("#___Tb_Tickets").dxToolbar("instance").option("visible",!1));$("#splashscreen").fadeOut(1E3)},1E3)},readOnly:!0,height:"100%",showColonAfterLabel:!0,showValidationSummary:!1,validationGroup:"__Frm_Ticket_Servicio_Validation",labelMode:"outside",labelLocation:"top",screenByWidth(b){return 700>b?"sm":"lg"},items:[{itemType:"group",cssClass:"hidden_box",colCount:6,items:[{colSpan:6,dataField:"TIC_TIEMPO_RECEPCION",label:{text:"TRECEPCION"},editorOptions:{readOnly:!0,disabled:!1}},
{colSpan:6,dataField:"TIC_TIEMPO_EJECUCION",label:{text:"TEJECUTA"},editorOptions:{readOnly:!0,disabled:!1}},{colSpan:6,dataField:"TIC_TIEMPO_CONFIRMACION",label:{text:"TCONFIRMA"},editorOptions:{readOnly:!0,disabled:!1}},{colSpan:6,dataField:"TIC_NEWID",label:{text:"UUID"},editorOptions:{readOnly:!0,disabled:!1}}]},{itemType:"group",colCount:6,items:[{colSpan:2,dataField:"TIC_FECHA_ALTA",editorType:"dxDateBox",label:{text:"Fecha de alta"},editorOptions:{type:"datetime",readOnly:!0,width:"100%",placeholder:"DD/MM/AAAA HH:mm:ss",
useMaskBehavior:!0,displayFormat:"dd/MM/yyyy HH:mm:ss",dateSerializationFormat:"yyyy-MM-ddTHH:mm:ss",onValueChanged:function(b){}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:2,dataField:"TIC_CSCTICKET",label:{text:`${Globalize.formatMessage("ticketNumber")}`},editorOptions:{readOnly:!0,disabled:!1}},{colSpan:2,dataField:"TIC_CERRADO",editorType:"dxSwitch",label:{text:"Abierto/Cerrado"},editorOptions:{readOnly:!0,switchedOffText:"Abierto",switchedOnText:"Cerrado",width:"100%",
onValueChanged:function(b){}}},{colSpan:2,dataField:"CAM_MESA_CSC",editorType:"dxSelectBox",label:{text:`${Globalize.formatMessage("lblMesaCsc")}`},editorOptions:{searchEnabled:!0,displayExpr:"CAM_MESA_IDIOMA1",valueExpr:"CAM_MESA_CSC",dataSource:a._CMB_SAMT_CAM_MESA_DE_AYUDA_OBJDATA,readOnly:!0,onOpened:function(b){b.component.getDataSource().load().done(function(c){a.CAM_MESA_CSC=c;c=jslinq(c).where(function(d){return 1==d.CAM_MESA_ACTIVO}).toList();b.component.option("dataSource",c)})},onClosed:function(b){b.component.getDataSource().items()!==
a.CAM_MESA_CSC&&b.component.option("dataSource",a.CAM_MESA_CSC)},onValueChanged:function(b){}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:2,dataField:"CLIENTE_CSC_SOLICITA",editorType:"dxSelectBox",label:{text:Globalize.formatMessage(`Etiquetas_${localStorage.getItem("EMP_CLV_EMPRESA")}_ticketCliente`)},editorOptions:{readOnly:!0,searchEnabled:!0,displayExpr:"CLIENTE_NOMBRE",valueExpr:"CLIENTE_CSC",deferRendering:!1,dataSource:a._CMB_SAMT_CLIENTES_OBJDATA,onOpened:function(b){b.component.getDataSource().load().done(function(c){a.CLIENTE_CSC=
c;c=jslinq(c).where(function(d){return 1==d.TIPO_ESTATUS_CLIENTE_CSC}).toList();b.component.option("dataSource",c)})},onClosed:function(b){b.component.getDataSource().items()!==a.CLIENTE_CSC&&b.component.option("dataSource",a.CLIENTE_CSC)},onValueChanged:function(b){a.Frm_Ticket_Servicio_Instance.getEditor("PM_CSC_PROYECTO_SOLICITA").option("value",null)}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:2,dataField:"PM_CSC_PROYECTO_SOLICITA",editorType:"dxSelectBox",label:{text:Globalize.formatMessage(`Etiquetas_${localStorage.getItem("EMP_CLV_EMPRESA")}_ticketCampania`)},
editorOptions:{searchEnabled:!0,displayExpr:"PM_NOMBRE",valueExpr:"PM_CSC_PROYECTO",dataSource:a._CMB_SAMT_PROYECTOS_OBJDATA,onOpened:function(b){b.component.getDataSource().load().done(function(c){a.PM_CSC_PROYECTO_SOLICITA=c;let d={};d=4==a.Frm_Ticket_Servicio_Instance.getEditor("CAM_MESA_CSC").option("value")?jslinq(c).where(function(f){return 1==f.TIPO_ESTATUS_PROYECTO_CSC&&7==f.PM_CSC_PROYECTO}).toList():jslinq(c).where(function(f){return 1==f.TIPO_ESTATUS_PROYECTO_CSC&&f.CLIENTE_CSC==a.Frm_Ticket_Servicio_Instance.getEditor("CLIENTE_CSC_SOLICITA").option("value")&&
9!=f.PM_CSC_PROYECTO}).toList();b.component.option("dataSource",d)})},onClosed:function(b){b.component.getDataSource().items()!==a.PM_CSC_PROYECTO_SOLICITA&&b.component.option("dataSource",a.PM_CSC_PROYECTO_SOLICITA)},onValueChanged:function(b){let c=b.value;null!=b.component.option("selectedItem")&&(b=jslinq(a._CMB_SAMT_CAM_SERVICIO_OBJDATA._array).where(function(d){return d.CAM_CSC_SERVICIO==c}).toList(),a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("value",b[0].CAM_CSC_SERVICIO))}},
validationRules:[{type:"required",message:"requerido"}]},{colSpan:2,dataField:"CAM_CSC_SERVICIO_SOLICITA",editorType:"dxSelectBox",label:{text:Globalize.formatMessage(`Etiquetas_${localStorage.getItem("EMP_CLV_EMPRESA")}_ticketSubCampania`)},editorOptions:{searchEnabled:!0,displayExpr:"CAM_SERVICIO_NOMBRE",valueExpr:"CAM_CSC_SERVICIO",dataSource:a._CMB_SAMT_CAM_SERVICIO_OBJDATA,onOpened:function(b){b.component.getDataSource().load().done(function(c){a.CAM_CSC_SERVICIO_SOLICITA=c;c=jslinq(c).where(function(d){return 1==
d.TIPO_ESTATUS_CAM_CSC&&d.PM_CSC_PROYECTO==a.Frm_Ticket_Servicio_Instance.getEditor("PM_CSC_PROYECTO_SOLICITA").option("value")}).toList();b.component.option("dataSource",c)})},onClosed:function(b){b.component.getDataSource().items()!==a.CAM_CSC_SERVICIO_SOLICITA&&b.component.option("dataSource",a.CAM_CSC_SERVICIO_SOLICITA)},onValueChanged:function(b){var c=b.value;1==a.setDefaultValues&&(b=jslinq(a._CMB_SAMT_ESTATUS_TICKET_OBJDATA._array).where(function(d){return d.CAM_CSC_SERVICIO==c&&"DEFAULT"==
d.ESTATUS_TICKET_CLAVE}).toList(),a.Frm_Ticket_Servicio_Instance.getEditor("ESTATUS_TICKET_CSC").option("value",b[0].ESTATUS_TICKET_CSC),b=jslinq(a._CMB_SAMT_TIPO_TICKET_OBJDATA._array).where(function(d){return d.CAM_CSC_SERVICIO==c&&1==d.TIPO_TICKET_DEFAULT}).toList(),a.Frm_Ticket_Servicio_Instance.getEditor("TIPO_TICKET_CSC").option("value",b[0].TIPO_TICKET_CSC),b=jslinq(a._CMB_SAMT_TIPO_PRIORIDAD_TICKET_OBJDATA._array).where(function(d){return d.CAM_CSC_SERVICIO==c&&1==d.TIPO_PRIORIDAD_DEFAULT}).toList(),
a.Frm_Ticket_Servicio_Instance.getEditor("TIPO_PRIORIDAD_CSC").option("value",b[0].TIPO_PRIORIDAD_CSC),b=jslinq(a._CMB_SAMT_TIPO_SEVERIDAD_OBJDATA._array).where(function(d){return d.CAM_CSC_SERVICIO==c&&1==d.TIPO_SEVERIDAD_TICKET_DEFAULT}).toList(),a.Frm_Ticket_Servicio_Instance.getEditor("TIPO_SEVERIDAD_CSC").option("value",b[0].TIPO_SEVERIDAD_CSC),b=jslinq(a._CMB_SAMT_CAM_TIPO_SERVICIO_OBJDATA._array).where(function(d){return 1==d.TIPO_SERVICIO_DEFAULT}).toList(),a.Frm_Ticket_Servicio_Instance.getEditor("SAMT_CAM_TIPO_SERVICIO_CSC").option("value",
b[0].SAMT_CAM_TIPO_SERVICIO_CSC));b={Tbl:"SAMT_REQUISICION_PROVEEDORES",WHR:"EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")+" AND CAM_CSC_SERVICIO = "+c};__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr","GET",b,getJSON(DeveloperType).ApiGeneral.token).then(d=>{!0===d.success&&(jslinq(d.JsonData).toList().forEach(function(f){a._CMB_SAMT_REQUISICIONES_OBJDATA.insert(f)}),a.Frm_Ticket_Servicio_Instance.getEditor("REQ_CSCREQUISICION").option("dataSource",d.JsonData))})}}},
{colSpan:2,dataField:"ESTATUS_TICKET_CSC",editorType:"dxSelectBox",label:{text:"Estado"},editorOptions:{searchEnabled:!0,displayExpr:"ESTATUS_TICKET_IDIOMA1",valueExpr:"ESTATUS_TICKET_CSC",dataSource:a._CMB_SAMT_ESTATUS_TICKET_OBJDATA,onOpened:function(b){b.component.getDataSource().load().done(function(c){b.component.option("selectedItem");a.ESTATUS_TICKET_CSC=c;let d={};d="true"==getUrlParam("AUTORIZADOR")?jslinq(c).where(function(f){return"AUTORIZA"==f.ESTATUS_TICKET_CLAVE&&1==f.ESTATUS_TICKET_ACTIVO&&
f.CAM_CSC_SERVICIO==a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("value")}).toList():147==a.DataTicketOpen.ESTATUS_TICKET_CSC?jslinq(c).where(function(f){return"Abierto"==f.ESTATUS_TICKET_IDIOMA1&&1==f.ESTATUS_TICKET_ACTIVO&&f.CAM_CSC_SERVICIO==a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("value")}).toList():jslinq(c).where(function(f){return"AUTORIZA"!=f.ESTATUS_TICKET_CLAVE&&1==f.ESTATUS_TICKET_ACTIVO&&f.CAM_CSC_SERVICIO==a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("value")}).toList();
b.component.option("dataSource",d)})},onClosed:function(b){b.component.getDataSource().items()!==a.ESTATUS_TICKET_CSC&&b.component.option("dataSource",a.ESTATUS_TICKET_CSC)},onValueChanged:function(b){var c=b.component.option("selectedItem");if(null!=c){console.log(c);1==a.editandoForma&&1==c.ESTATUS_TICKET_PAUSAR&&(a.pauseTicket=!0);if("AUTORIZA"==c.ESTATUS_TICKET_CLAVE&&1==c.ESTATUS_TICKET_CERRAR)if(void 0==a._Datagrid_Ot_Ticket||void 0==a._DataGrid_Autorizacion){b=a.Frm_Ticket_Servicio_Instance.getEditor("TIPO_CALIFICACION_CSC");
var d=b.option("dataSource");d=jslinq(d.items()).where(function(l){return"NA"==l.TIPO_CALIFICACION_CLAVE}).toList();b.option("value",d[0].TIPO_CALIFICACION_CSC);a.Frm_Ticket_Servicio_Instance.getEditor("TIC_CERRADO").option("value",!0);a.Frm_Ticket_Servicio_Instance.itemOption("TIC_DESCRIPCION_SOLUCION","isRequired",!0)}else{if(null!=a._DataGrid_Autorizacion.getDataSource()&&null!=a._Datagrid_Ot_Ticket.getDataSource()){d=a._DataGrid_Autorizacion.getVisibleRows();var f=[];$.each(d,function(l,q){l=
a._DataGrid_Autorizacion.columnOption("SAMT_TIPO_RESPUESTA_AUTORIZA_CSC","lookup.dataSource");l=jslinq(l.store.__rawData).where(function(r){return r.SAMT_TIPO_RESPUESTA_AUTORIZA_CSC==q.data.SAMT_TIPO_RESPUESTA_AUTORIZA_CSC}).toList();f.push("PEND"===l[0].TIPO_RESPUESTA_AUTORIZA_CLAVE?!0:!1)});d=f.some(function(l){return!0===l});var h=a._Datagrid_Ot_Ticket.getDataSource().items();if(1<=jslinq(h).where(function(l){return 0==l.OTR_CERRADA}).toList().length||1==d){DevExpress.ui.notify({message:"AUN HAY OTS ABIERTAS O AUTORIZACIONES PENDIENTES, NO ES POSIBLE REALIZAR MODIFICACION",
minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"});b.component.option("value",b.previousValue);return}b=a.Frm_Ticket_Servicio_Instance.getEditor("TIPO_CALIFICACION_CSC");d=b.option("dataSource");d=jslinq(d.items()).where(function(l){return"NA"==l.TIPO_CALIFICACION_CLAVE}).toList();b.option("value",d[0].TIPO_CALIFICACION_CSC)}}else 1==c.ESTATUS_TICKET_CERRAR?a.Frm_Ticket_Servicio_Instance.itemOption("TIC_DESCRIPCION_SOLUCION","isRequired",!0):(a.Frm_Ticket_Servicio_Instance.getEditor("TIC_CERRADO").option("value",
!1),a.Frm_Ticket_Servicio_Instance.itemOption("TIC_DESCRIPCION_SOLUCION","isRequired",!1));"NUEVO"!=c.ESTATUS_TICKET_CLAVE?null==a.Frm_Ticket_Servicio_Instance.option("formData").EMPLEADO_CSC_ATIENDE?(console.log("SE BUSCA QUE NO ESTE ASIGNADO Y SE ASIGNA AL QUE MODIFICA"),"GENERA"!=getUrlParam("TPO_USUARIO")&&"AUTORIZA"!=c.ESTATUS_TICKET_CLAVE&&(a.Frm_Ticket_Servicio_Instance.getEditor("EMPLEADO_CSC_ATIENDE").option("value",n.EMPLEADO_CSC_EMPLEADO),a.Frm_Ticket_Servicio_Instance.getEditor("TIC_ATIENDE").option("value",
n.EMPLEADO_NOMBREEMPLEADO+" "+n.EMPLEADO_APATERNOEMPLEADO+" "+n.EMPLEADO_AMATERNOEMPLEADO))):console.log("YA ESTA ASIGNADO"):console.log("NO SE BUSCA A NADIE")}}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:2,dataField:"TIPO_TICKET_CSC",editorType:"dxSelectBox",label:{text:`${Globalize.formatMessage("lblTipoCsc")}`},editorOptions:{searchEnabled:!0,displayExpr:"TIPO_TICKET_IDIOMA1",valueExpr:"TIPO_TICKET_CSC",dataSource:a._CMB_SAMT_TIPO_TICKET_OBJDATA,onOpened:function(b){b.component.getDataSource().load().done(function(c){a.TIPO_TICKET_CSC=
c;c=jslinq(c).where(function(d){return 1==d.TIPO_TICKET_ACTIVO&&d.CAM_CSC_SERVICIO==a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("value")}).toList();b.component.option("dataSource",c)})},onClosed:function(b){b.component.getDataSource().items()!==a.TIPO_TICKET_CSC&&b.component.option("dataSource",a.TIPO_TICKET_CSC)},onValueChanged:function(b){}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:2,dataField:"TIPO_PRIORIDAD_CSC",editorType:"dxSelectBox",
label:{text:"Prioridad"},editorOptions:{searchEnabled:!0,displayExpr:"TIPO_PRIORIDAD_IDIOMA1",valueExpr:"TIPO_PRIORIDAD_CSC",dataSource:a._CMB_SAMT_TIPO_PRIORIDAD_TICKET_OBJDATA,onOpened:function(b){b.component.getDataSource().load().done(function(c){a.TIPO_PRIORIDAD_CSC=c;c=jslinq(c).where(function(d){return 1==d.TIPO_PRIORIDAD_ACTIVO&&d.CAM_CSC_SERVICIO==a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("value")}).toList();b.component.option("dataSource",c)})},onClosed:function(b){b.component.getDataSource().items()!==
a.TIPO_PRIORIDAD_CSC&&b.component.option("dataSource",a.TIPO_PRIORIDAD_CSC)},onValueChanged:function(b){}}},{colSpan:2,dataField:"SAMT_CAM_TIPO_SERVICIO_CSC",editorType:"dxSelectBox",label:{text:"Canal"},editorOptions:{searchEnabled:!0,displayExpr:"TIPO_SERVICIO_IDIOMA1",valueExpr:"SAMT_CAM_TIPO_SERVICIO_CSC",dataSource:a._CMB_SAMT_CAM_TIPO_SERVICIO_OBJDATA,onOpened:function(b){b.component.getDataSource().load().done(function(c){a.SAMT_CAM_TIPO_SERVICIO_CSC=c;c=jslinq(c).where(function(d){return 1==
d.TIPO_SERVICIO_ACTIVO}).toList();b.component.option("dataSource",c)})},onClosed:function(b){b.component.getDataSource().items()!==a.SAMT_CAM_TIPO_SERVICIO_CSC&&b.component.option("dataSource",a.SAMT_CAM_TIPO_SERVICIO_CSC)},onValueChanged:function(b){}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:2,dataField:"TIPO_SEVERIDAD_CSC",editorType:"dxSelectBox",label:{text:"Severidad"},editorOptions:{searchEnabled:!0,displayExpr:"TIPO_SEVERIDAD_TICKET_IDIOMA1",valueExpr:"TIPO_SEVERIDAD_CSC",
dataSource:a._CMB_SAMT_TIPO_SEVERIDAD_OBJDATA,onOpened:function(b){b.component.getDataSource().load().done(function(c){a.TIPO_SEVERIDAD_CSC=c;c=jslinq(c).where(function(d){return 1==d.TIPO_SEVERIDAD_TICKET_ACTIVO&&d.CAM_CSC_SERVICIO==a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("value")}).toList();b.component.option("dataSource",c)})},onClosed:function(b){b.component.getDataSource().items()!==a.TIPO_SEVERIDAD_CSC&&b.component.option("dataSource",a.TIPO_SEVERIDAD_CSC)},
onValueChanged:function(b){}}},{colSpan:6,template:"<div class='heading_InnerFrm'><h2>Solicitante</h2></div>"},{colSpan:2,dataField:"EMPLEADO_CSC_SOLICITA",editorType:"dxTextBox",label:{text:"Id Solicitante"},editorOptions:{readOnly:!0}},{colSpan:2,dataField:"TIC_SOLICITA",editorType:"dxTextBox",label:{text:"Nombre Solicitante"},editorOptions:{buttons:[{name:"btn_BuscarEmpleado",location:"after",options:{stylingMode:"Contained",icon:"search",type:"normal",onClick(b){a.BusquedaEmpleado("Solicita",
"single")}}}]}},{colSpan:2,dataField:"TIC_EMAIL_SOLICITANTE",editorType:"dxTextBox",label:{text:"Correo electr\u00f3nico"},editorOptions:{mode:"email",valueChangeEvent:"keyup",onValueChanged:function(b){null!=b.value&&""!=b.value&&b.component.option("value",b.value.toLowerCase())}},validationRules:[{type:"required",message:"requerido"},{type:"email",message:"Formato de correo incorrecto."}]},{colSpan:2,dataField:"TIC_TELEFONO_SOLICITANTE",editorType:"dxTextBox",label:{text:"Tel\u00e9fono"},editorOptions:{},
validationRules:[{type:"required",message:"requerido"},{type:"stringLength",max:10,message:"Maximo 10 caractres"},{type:"stringLength",min:10,message:"Minimo 10 caractres"}]},{colSpan:2,dataField:"REQ_CSCREQUISICION",editorType:"dxSelectBox",label:{text:"Ubicaci\u00f3n/Aduana/Almacen"},editorOptions:{searchEnabled:!0,displayExpr:"REQUISICION_PROVEEDORES_NOMBRE",valueExpr:"SAMT_REQUISICION_PROVEEDORES_CSC",dataSource:a._CMB_SAMT_REQUISICIONES_OBJDATA,itemTemplate(b){return`${b.REQUISICION_PROVEEDORES_ID_EXTERNO} - ${b.REQUISICION_PROVEEDORES_NOMBRE}`},
onOpened:function(b){b.component.getDataSource().load().done(function(c){a.REQ_CSCREQUISICION=c;null==a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("selectedItem")?(a.notificaPantalla("Informaci\u00f3n",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),"Debes seleccionar el servicio",400,130),b.component.option("dataSource",[])):(c=jslinq(c).where(function(d){return 1==d.REQUISICION_PROVEEDORES_ACTIVO&&d.CAM_CSC_SERVICIO==a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("value")}).toList(),
b.component.option("dataSource",c))})},onClosed:function(b){b.component.getDataSource().items()!==a.REQ_CSCREQUISICION&&b.component.option("dataSource",a.REQ_CSCREQUISICION)},onValueChanged:function(b){}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:2,dataField:"TIC_SEGMENTACION_INM_DES",editorType:"dxTextBox",label:{text:"Ubicaci\u00f3n/Punto tactico"},editorOptions:{valueChangeEvent:"keyup",onValueChanged:function(b){null!=b.value&&""!=b.value&&b.component.option("value",b.value.toUpperCase())}}}]},
{colSpan:6,template:"<div class='heading_InnerFrm'><h2>Detalle de solicitud</h2></div>"},{itemType:"group",colCount:6,items:[{itemType:"group",colSpan:2,colCount:2,items:[{colSpan:2,template:"<div class='heading_InnerFrm'><h2>Categorizaci\u00f3n</h2></div>"},{colSpan:2,dataField:"TIPIFICA_CSC_PARENT_PARENT",editorType:"dxSelectBox",label:{text:"Categor\u00eda"},validationRules:[{type:"required",message:"Tipificaci\u00f3n requerida"}],editorOptions:{searchEnabled:!0,displayExpr:"TIPIFICA_IDIOMA1",
valueExpr:"TIPIFICA_CSC",dataSource:a._CMB_SAMT_CAM_TIPIFICACIONES_OBJDATA,onOpened:function(b){b.component.getDataSource().load().done(function(c){a.TIPIFICA_CSC_PARENT_PARENT=c;null==a.Frm_Ticket_Servicio_Instance.getEditor("REQ_CSCREQUISICION").option("selectedItem")?(a.notificaPantalla("Informaci\u00f3n",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),"Debes seleccionar Ubicaci\u00f3n/Aduana/Almacen",400,130),b.component.option("dataSource",[])):(c=jslinq(c).where(function(d){let f=
a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("selectedItem");return 1==d.TIPIFCA_ACTIVO&&null==d.TIPIFICA_PARENT&&d.CAT_TIPO_TIPIFICA_CSC==f.TIPIFICA_CSC}).toList(),b.component.option("dataSource",c))})},onClosed:function(b){b.component.getDataSource().items()!==a.TIPIFICA_CSC_PARENT_PARENT&&b.component.option("dataSource",a.TIPIFICA_CSC_PARENT_PARENT)},onValueChanged:function(b){}}},{colSpan:2,dataField:"TIPIFICA_CSC_PARENT",editorType:"dxSelectBox",label:{text:"Categor\u00eda nivel 2"},
validationRules:[{type:"required",message:"Tipificaci\u00f3n requerida"}],editorOptions:{searchEnabled:!0,displayExpr:"TIPIFICA_IDIOMA1",valueExpr:"TIPIFICA_CSC",dataSource:a._CMB_SAMT_CAM_TIPIFICACIONES_OBJDATA,onOpened:function(b){b.component.getDataSource().load().done(function(c){a.TIPIFICA_CSC_PARENT=c;if(null==a.Frm_Ticket_Servicio_Instance.getEditor("TIPIFICA_CSC_PARENT_PARENT").option("selectedItem"))a.notificaPantalla("Informaci\u00f3n",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),
"Debes seleccionar la primer categoria",400,130),b.component.option("dataSource",[]);else{var d=a.Frm_Ticket_Servicio_Instance.getEditor("REQ_CSCREQUISICION").option("selectedItem");null==d?(a.notificaPantalla("Informaci\u00f3n",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),"Debes seleccionar la primer categoria",400,130),b.component.option("dataSource",[])):(c=jslinq(c).where(function(f){let h=a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("selectedItem");
return 1==f.TIPIFCA_ACTIVO&&f.TIPIFICA_PARENT==a.Frm_Ticket_Servicio_Instance.getEditor("TIPIFICA_CSC_PARENT_PARENT").option("value")&&f.CAT_TIPO_TIPIFICA_CSC==h.TIPIFICA_CSC&&f.TIPIFICA_REGISTRO_CLAVE==d.REQUISICION_PROVEEDORES_UBIC_SLA}).toList(),b.component.option("dataSource",c))}})},onClosed:function(b){b.component.getDataSource().items()!==a.TIPIFICA_CSC_PARENT&&b.component.option("dataSource",a.TIPIFICA_CSC_PARENT)},onValueChanged:function(b){}}},{colSpan:2,dataField:"TIPIFICA_CSC",editorType:"dxSelectBox",
label:{text:"Categor\u00eda nivel 3"},validationRules:[{type:"required",message:"Tipificaci\u00f3n requerida"}],editorOptions:{searchEnabled:!0,displayExpr:"TIPIFICA_IDIOMA1",valueExpr:"TIPIFICA_CSC",dataSource:a._CMB_SAMT_CAM_TIPIFICACIONES_OBJDATA,onOpened:function(b){b.component.getDataSource().load().done(function(c){a.TIPIFICA_CSC=c;if(null==a.Frm_Ticket_Servicio_Instance.getEditor("TIPIFICA_CSC_PARENT").option("selectedItem"))a.notificaPantalla("Informaci\u00f3n",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),
"Debes seleccionar la categor\u00eda de nivel 2",400,130),b.component.option("dataSource",[]);else{var d=a.Frm_Ticket_Servicio_Instance.getEditor("REQ_CSCREQUISICION").option("selectedItem");null==d?(a.notificaPantalla("Informaci\u00f3n",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),"Debes seleccionar la primer categoria",400,130),b.component.option("dataSource",[])):(c=jslinq(c).where(function(f){let h=a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("selectedItem");
return 1==f.TIPIFCA_ACTIVO&&f.TIPIFICA_PARENT==a.Frm_Ticket_Servicio_Instance.getEditor("TIPIFICA_CSC_PARENT").option("value")&&f.CAT_TIPO_TIPIFICA_CSC==h.TIPIFICA_CSC&&f.TIPIFICA_REGISTRO_CLAVE==d.REQUISICION_PROVEEDORES_UBIC_SLA}).toList(),b.component.option("dataSource",c))}})},onClosed:function(b){b.component.getDataSource().items()!==a.TIPIFICA_CSC&&b.component.option("dataSource",a.TIPIFICA_CSC);b=b.component.option("selectedItem");if(null!=b){var c=a.Frm_Ticket_Servicio_Instance.getEditor("TIC_TIEMPO_EJECUCION"),
d=a.Frm_Ticket_Servicio_Instance.getEditor("TIC_TIEMPO_RECEPCION"),f=a.Frm_Ticket_Servicio_Instance.getEditor("TIC_TIEMPO_CONFIRMACION");c.option("value",0==b.TIPIFICA_TIEMPO_EJECUCION?a.TimeDefault:b.TIPIFICA_TIEMPO_EJECUCION);d.option("value",b.TIPIFICA_TIEMPO_RECEPCION);f.option("value",b.TIPIFICA_TIEMPO_CONFIRMACION)}},onValueChanged:function(b){"INSTALACI\u00d3N DE SO Y PUESTA EN MARCHA"==b.component.option("selectedItem").TIPIFICA_CLAVE_EXTERNA?a.Frm_Ticket_Servicio_Instance.itemOption("TAG_COMPONENTE",
"isRequired",!1):a.Frm_Ticket_Servicio_Instance.itemOption("TAG_COMPONENTE","isRequired",!0)}}},{colSpan:2,dataField:"TAG_COMPONENTE",editorType:"dxTextBox",label:{text:"NO. DE SERIE"},validationRules:[{type:"stringLength",max:8,message:"Maximo 8 caractres"}]}]},{dataField:"TIC_DESCRIPCION",editorType:"dxTextArea",colSpan:4,label:{text:"Descripci\u00f3n/Observaciones"},editorOptions:{readOnly:!0,height:205,valueChangeEvent:"keyup",onValueChanged:function(b){}},validationRules:[{type:"required",message:"requerido"}]},
{colSpan:6,template:"<div class='heading_InnerFrm'><h2>Detalle de atenci\u00f3n</h2></div>"},{itemType:"group",colSpan:2,colCount:2,items:[{colSpan:2,dataField:"TIC_ATIENDE",editorType:"dxTextBox",label:{text:"Empleado Atiende"},editorOptions:{buttons:[{name:"btn_BuscarEmpleado",location:"after",options:{stylingMode:"Contained",icon:"search",type:"normal",onClick(b){a.BusquedaEmpleado("Atiende","single")}}}]}},{colSpan:2,dataField:"TIC_AUXS2",editorType:"dxTextBox",label:{text:"T\u00e9cnico asignado"},
validationRules:[{type:"stringLength",max:50,message:"Maximo 50 caractres"}]},{colSpan:2,template:"<div class='heading_InnerFrm'><h2>Calendario</h2></div>"},{colSpan:2,dataField:"TIC_FECHA_CIERRE",label:{text:"Fecha Cierre"},editorType:"dxDateBox",editorOptions:{readOnly:!0,type:"datetime",disabled:!1,width:"100%",placeholder:"DD/MM/AAAA HH:mm:ss",useMaskBehavior:!0,displayFormat:"dd/MM/yyyy HH:mm:ss",dateSerializationFormat:"yyyy-MM-ddTHH:mm:ss",onValueChanged:function(b){}}},{colSpan:2,dataField:"TIPO_CALIFICACION_CSC",
editorType:"dxSelectBox",label:{text:"Calificaci\u00f3n"},editorOptions:{searchEnabled:!0,readOnly:!0,displayExpr:"TIPO_CALIFICACION_IDIOMA1",valueExpr:"TIPO_CALIFICACION_CSC",deferRendering:!1,dataSource:new DevExpress.data.DataSource({loadMode:"raw",paginate:!1,load:async function(){try{var b={Tbl:"SAMT_TIPO_CALIFICACION",WHR:"EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")+" AND TIPO_CALIFICACION_ACTIVO = 1 "};return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr",
"GET",b,getJSON(DeveloperType).ApiGeneral.token).then(c=>{if(1==c.success)return c.JsonData;console.log(c.message)})}catch(c){console.log(c)}}}),onOpened:function(b){b.component.getDataSource().load().done(function(c){a.TIPO_CALIFICACION_CSC=c;c=jslinq(c).where(function(d){return 1==d.TIPO_CALIFICACION_ACTIVO}).toList();b.component.option("dataSource",c)})},onClosed:function(b){b.component.getDataSource().items()!==a.TIPO_CALIFICACION_CSC&&b.component.option("dataSource",a.TIPO_CALIFICACION_CSC)},
onValueChanged:function(b){b.component.option("selectedItem")}}},{colSpan:2,cssClass:"hidden_box",dataField:"EMPLEADO_CSC_ATIENDE",editorType:"dxTextBox",label:{text:"Id Empleado Atiende"},editorOptions:{readOnly:!0}}]},{itemType:"group",colSpan:4,colCount:1,items:[{dataField:"TIC_DESCRIPCION_SOLUCION",editorType:"dxTextArea",label:{text:"Detalle de soluci\u00f3n"},editorOptions:{height:205,valueChangeEvent:"keyup",onValueChanged:function(b){},buttons:[{name:"ObtenPortapapel",location:"after",options:{stylingMode:"Contained",
icon:"pasteplaintext",type:"normal",onClick(b){a.ObtenClipboard("__Frm_Ticket_Servicio","TIC_DESCRIPCION_SOLUCION")}}}]}}]}]}]}).dxForm("instance");a.Frm_Ticket_Empleado_Solita_Instance=$("#__Frm_Ticket_Empleado_Solicita").dxForm({readOnly:!0,height:"100%",showColonAfterLabel:!0,showValidationSummary:!1,validationGroup:"__Frm_Ticket_Empleado_Solicita_Validation",labelMode:"outside",labelLocation:"top",screenByWidth(b){return 700>b?"sm":"lg"},items:[{colSpan:6,template:"<div class='heading_InnerFrm'><h2>Informacion General del Empleado que Solicita</h2></div>"},
{itemType:"group",colCount:6,items:[{colSpan:2,dataField:"EMPLEADO_CSC_EMPLEADO",label:{text:"Id Empleado"},editorOptions:{readOnly:!0,disabled:!1}},{colSpan:2,dataField:"EMPLEADO_ID_EXTERNO",label:{text:"No. Empleado"},editorOptions:{readOnly:!0,disabled:!1}},{colSpan:2,dataField:"REQ_CSCREQUISICION",editorType:"dxSelectBox",label:{text:"Site Labora"},editorOptions:{searchEnabled:!0,displayExpr:"REQ_NOMBREAREA",valueExpr:"REQ_CSCREQUISICION",dataSource:new DevExpress.data.DataSource({loadMode:"raw",
paginate:!1,load:async function(b){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_REQUISICIONES"},getJSON(DeveloperType).ApiGeneral.token).then(c=>{if(1==c.success)return c.JsonData;console.log(c.message)})}catch(c){console.log(c)}},onError:async function(b){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_REQUISICIONES"},getJSON(DeveloperType).ApiGeneral.token).then(c=>{if(1==c.success)return c.JsonData;
console.log(c.message)})}catch(c){console.log(c)}}})}},{colSpan:2,dataField:"EMPLEADO_NOMBREEMPLEADO",label:{text:"Nombre"},editorOptions:{readOnly:!0,disabled:!1}},{colSpan:2,dataField:"EMPLEADO_APATERNOEMPLEADO",label:{text:"Apellido Paterno"},editorOptions:{readOnly:!0,disabled:!1}},{colSpan:2,dataField:"EMPLEADO_AMATERNOEMPLEADO",label:{text:"Apellido Materno"},editorOptions:{readOnly:!0,disabled:!1}},{colSpan:2,dataField:"EMPLEADO_TELEFONO1",label:{text:"Telefono Casa"},editorOptions:{readOnly:!0,
disabled:!1}},{colSpan:2,dataField:"EMPLEADO_CELULAR",label:{text:"Telefono Celular"},editorOptions:{readOnly:!0,disabled:!1}},{colSpan:2,dataField:"EMPLEADO_EMAILLABORAL",label:{text:"Correo Laboral"},editorOptions:{readOnly:!0,disabled:!1}},{colSpan:2,dataField:"CAT_PUESTO_CSCEMPLEADO",editorType:"dxSelectBox",label:{text:"Puesto"},editorOptions:{searchEnabled:!0,displayExpr:"TIPO_PUESTO_IDIOMA1",valueExpr:"TIPO_PUESTO_CSCEMPLEADO",dataSource:new DevExpress.data.DataSource({loadMode:"raw",paginate:!1,
load:async function(b){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_TIPO_PUESTO_EMPLEADO"},getJSON(DeveloperType).ApiGeneral.token).then(c=>{if(1==c.success)return c.JsonData;console.log(c.message)})}catch(c){console.log(c)}},onError:async function(b){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_TIPO_PUESTO_EMPLEADO"},getJSON(DeveloperType).ApiGeneral.token).then(c=>{if(1==c.success)return c.JsonData;
console.log(c.message)})}catch(c){console.log(c)}}})}},{colSpan:2,dataField:"CAT_AREA_CSC",editorType:"dxSelectBox",label:{text:"Area"},editorOptions:{searchEnabled:!0,displayExpr:"TIPO_AREA_IDIOMA1",valueExpr:"TIPO_AREA_CSC",dataSource:new DevExpress.data.DataSource({loadMode:"raw",paginate:!1,load:async function(b){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_CAT_EMPLEADO_AREA"},getJSON(DeveloperType).ApiGeneral.token).then(c=>{if(1==c.success)return c.JsonData;
console.log(c.message)})}catch(c){console.log(c)}},onError:async function(b){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_CAT_EMPLEADO_AREA"},getJSON(DeveloperType).ApiGeneral.token).then(c=>{if(1==c.success)return c.JsonData;console.log(c.message)})}catch(c){console.log(c)}}})}},{colSpan:2,dataField:"CAT_DEPARTAMENTO_CSC",editorType:"dxSelectBox",label:{text:"Departamento"},editorOptions:{searchEnabled:!0,displayExpr:"SAMT_TIPO_DEPARTAMENTO_IDIOMA1",
valueExpr:"EMPLEADO_DEPARTAMENTO_CSC",dataSource:new DevExpress.data.DataSource({loadMode:"raw",paginate:!1,load:async function(b){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_CAT_EMPLEADO_DEPARTAMENTO"},getJSON(DeveloperType).ApiGeneral.token).then(c=>{if(1==c.success)return c.JsonData;console.log(c.message)})}catch(c){console.log(c)}},onError:async function(b){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",
{Tbl:"SAMT_CAT_EMPLEADO_DEPARTAMENTO"},getJSON(DeveloperType).ApiGeneral.token).then(c=>{if(1==c.success)return c.JsonData;console.log(c.message)})}catch(c){console.log(c)}}})}}]}]}).dxForm("instance");a.ObtenSelectBoxFrm=b=>{a._SelectBox_OriginalDts=[];let c=b.option("formData");Object.entries(c).forEach(([d])=>{var f=b.itemOption(d);if(void 0!=f){var h=f.editorType;f=f.label.text;"dxSelectBox"==h?(h=b.getEditor(d),a._SelectBox_OriginalDts.push({[d]:h.option("text"),Label:f})):"dxTextBox"==h||"dxNumberBox"==
h||"dxTextArea"==h||"dxDateBox"==h?(h=b.getEditor(d),a._SelectBox_OriginalDts.push({[d]:h.option("text"),Label:f})):"dxHtmlEditor"==h&&(h=b.getEditor(d),a._SelectBox_OriginalDts.push({[d]:h.option("value"),Label:f}))}else if(f=b.itemOption("__Detalle_Edificio."+d),void 0!=f)if(h=f.editorType,f=f.label.text,"dxSelectBox"==h)h=b.getEditor(d),a._SelectBox_OriginalDts.push({[d]:h.option("text"),Label:f});else if("dxTextBox"==h||"dxNumberBox"==h||"dxTextArea"==h||"dxDateBox"==h)h=b.getEditor(d),a._SelectBox_OriginalDts.push({[d]:h.option("text"),
Label:f})})};a.TestBitacoraInsert=b=>{console.log(b);return new Promise((c,d)=>{try{__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Insert_Bitacora_Ticket","POST",JSON.stringify(b),getJSON(DeveloperType).ApiGeneral.token).then(f=>{c(f)})}catch(f){d(f)}})};a.InsertaBitacoraManual=function(b,c,d,f,h){p.show();1==d&&(d=$("#Dg_Bitacora_Ticket").dxDataGrid("instance").getDataSource().items(),2<=jslinq(d).where(function(l){return 5==l.SAMT_TICKET_SUBTIPO_BITACORA_CSC}).toList().length?a.Generar_Orden_Trabajo_Rechazo():
console.log("NO SE GENERARA OT"));b={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),Type:localStorage.getItem("Type"),DATA_INSERT:{EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),AUDITORIA_USU_ALTA:JSON.parse(localStorage.getItem("obj_DatosEmpleado")).EMPLEADO_CSC_EMPLEADO,AUDITORIA_USU_ULT_MOD:JSON.parse(localStorage.getItem("obj_DatosEmpleado")).EMPLEADO_CSC_EMPLEADO,AUDITORIA_FEC_ALTA:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),AUDITORIA_FEC_ULT_MOD:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),
TIC_CSCTICKET:b.TIC_CSCTICKET,ESTATUS_TICKET_CSC:b.ESTATUS_TICKET_CSC,TIB_NOMBRE:n.EMPLEADO_NOMBREEMPLEADO+" "+n.EMPLEADO_APATERNOEMPLEADO+" "+n.EMPLEADO_AMATERNOEMPLEADO,TIB_DESCRIPCION:c,TIB_FECHAHORA:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),SAMT_TICKET_TIPO_BITACORA_CSC:f,SAMT_TICKET_SUBTIPO_BITACORA_CSC:h,EMPLEADO_CSC_EMPLEADO:JSON.parse(localStorage.getItem("obj_DatosEmpleado")).EMPLEADO_CSC_EMPLEADO}};__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Insert_Bitacora_Ticket",
"POST",JSON.stringify(b),getJSON(DeveloperType).ApiTickets_v2.token).then(l=>{1==l.success?(p.show(),setTimeout(()=>{$("#Pop_Insertar_BitacoraManual").dxPopup("hide");p.hide()},1E3),DevExpress.ui.notify({message:"BITACORA AGREGADA CORRECTAMENTE",minWidth:150,type:"success",displayTime:5E3},{position:"bottom right",direction:"up-push"})):p.hide();return l}).catch(function(l){p.hide();DevExpress.ui.notify({message:"ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE",minWidth:150,type:"error",displayTime:5E3},
{position:"bottom right",direction:"up-push"})})};$("#Dg_RepFoto_Ticket").dxDataGrid({headerFilter:{visible:!1},keyExpr:"TICKET_FOTO_CSC",selection:{mode:"single"},scrolling:{useNative:!1,scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always"},groupPanel:{visible:!1},grouping:{autoExpandAll:!0},paging:{enabled:!1,pageIndex:0,pageSize:20},hoverStateEnabled:!0,showBorders:!0,showRowLines:!0,showColumnLines:!0,rowAlternationEnabled:!0,columnAutoWidth:!1,columns:[{caption:"IdI",dataField:"TICKET_FOTO_CSC",
alignment:"left",sortIndex:1,sortOrder:"desc",visible:!1},{caption:"IMAGEN",dataField:"TICKET_DESCRIPCION",alignment:"left",allowSorting:!1},{caption:"FECHA DE ALTA",dataField:"TICKET_FECHA_ALTA",alignment:"left",dataType:"date",calculateCellValue:function(b){return moment(b.TICKET_FECHA_ALTA).add(a.TiempoUTCEmpleado,"hours").format("DD/MM/YYYY HH:mm:ss")},allowSorting:!1},{caption:"GENERADO POR",dataField:"TICKET_ORIGEN_CREACION",alignment:"left",cellTemplate(b,c){2==c.value?$("<div>").append($('<div">Operador</div>')).appendTo(b):
$("<div>").append($('<div">Cliente</div>')).appendTo(b)},allowSorting:!1}],onRowDblClick:function(b){console.log(b.data);b={ClaveEmpresa:localStorage.getItem("EMP_CLV_EMPRESA"),newIdTicket:b.data.TIC_NEWID,idImagen:b.data.TICKET_FOTO_CSC};__Reques_ajax(`${getJSON(DeveloperType).Bot_Internal_Storage_Anam.url}getImageTicketById/${a.DataTicketOpen.SAMT_CAM_TIPO_SERVICIO_CSC}`,"GET",b,getJSON(DeveloperType).ApiGeneral.token).then(c=>{if(1==c.success){p.hide();console.log(c);var d=c.urlTemporal;$("#Pop_Notificacion_Success").dxPopup("instance").option("height",
"85%");$("#Pop_Notificacion_Success").dxPopup("instance").option("width","90%");$("#Pop_Notificacion_Success").dxPopup("instance").option("contentTemplate",function(f){return $('<div style="height:100%;">').append("<iframe src="+d+' width="100%" height="100%" scrolling="auto" frameBorder="0" style=" flex-shrink: 1;flex-basis: auto;flex: 1; flex-grow: 1;"></iframe>')});$("#Pop_Notificacion_Success").dxPopup("show")}else a.notificaPantalla("Informaci\u00f3n",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),
`${c.message}`,400,130),p.hide()})}});$("#Dg_Documento_Ticket").dxDataGrid({headerFilter:{visible:!1},keyExpr:"TICKET_FILE_CSC",selection:{mode:"single"},scrolling:{useNative:!1,scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always"},groupPanel:{visible:!1},grouping:{autoExpandAll:!0},paging:{enabled:!1,pageIndex:0,pageSize:20},hoverStateEnabled:!0,showBorders:!0,showRowLines:!0,showColumnLines:!0,rowAlternationEnabled:!0,columnAutoWidth:!1,columns:[{caption:"Id",dataField:"TICKET_FILE_CSC",alignment:"left",
sortIndex:1,sortOrder:"desc",visible:!1},{caption:"DOCUMENTO",dataField:"TICKET_FILE_DESCRIPCION",alignment:"left",allowSorting:!1},{caption:"FECHA DE ALTA",dataField:"TICKET_FILE_FECHA_ALTA",alignment:"left",dataType:"date",allowSorting:!1,calculateCellValue:function(b){return moment(b.TICKET_FILE_FECHA_ALTA).add(a.TiempoUTCEmpleado,"hours").format("DD/MM/YYYY HH:mm:ss")}},{caption:"GENERADO POR",dataField:"TICKET_FILE_ORIGEN_CREACION",alignment:"left",allowSorting:!1,cellTemplate(b,c){2==c.value?
$("<div>").append($('<div">Operador</div>')).appendTo(b):$("<div>").append($('<div">Cliente</div>')).appendTo(b)}}],onRowDblClick:function(b){console.log(b.data);b={ClaveEmpresa:localStorage.getItem("EMP_CLV_EMPRESA"),newIdTicket:b.data.TIC_NEWID,idDocumento:b.data.TICKET_FILE_CSC};__Reques_ajax(`${getJSON(DeveloperType).Bot_Internal_Storage_Anam.url}getDocumentTicketById/${a.DataTicketOpen.SAMT_CAM_TIPO_SERVICIO_CSC}`,"GET",b,getJSON(DeveloperType).ApiGeneral.token).then(c=>{if(1==c.success){p.hide();
console.log(c);var d=c.urlTemporal;$("#Pop_Notificacion_Success").dxPopup("instance").option("height","85%");$("#Pop_Notificacion_Success").dxPopup("instance").option("width","90%");$("#Pop_Notificacion_Success").dxPopup("instance").option("contentTemplate",function(f){return $('<div style="height:100%;">').append("<iframe src="+d+' width="100%" height="100%" scrolling="auto" frameBorder="0" style=" flex-shrink: 1;flex-basis: auto;flex: 1; flex-grow: 1;"></iframe>')});$("#Pop_Notificacion_Success").dxPopup("show")}else a.notificaPantalla("Informaci\u00f3n",
moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),`${c.message}`,400,130),p.hide()})}});$("#Dg_Bitacora_Ticket").dxDataGrid({deferRendering:!0,allowColumnResizing:!0,headerFilter:{visible:!1},keyExpr:"TIB_CSCTICKETBITACORA",remoteOperations:!1,searchPanel:{visible:!1,highlightCaseSensitive:!0},selection:{mode:"single"},scrolling:{mode:"virtual",showScrollbar:"always",useNative:!0},groupPanel:{visible:!1},grouping:{autoExpandAll:!0},paging:{enabled:!1,pageIndex:0,pageSize:20},showBorders:!0,
showRowLines:!0,showColumnLines:!0,rowAlternationEnabled:!0,columnAutoWidth:!1,columns:[{caption:"NOMBRE",dataField:"TIB_NOMBRE"},{caption:"DESCRIPCION",dataField:"TIB_DESCRIPCION"},{caption:"FECHA DE CAMBIO",dataField:"TIB_FECHAHORA",dataType:"date",format:"dd-MM-yyyy HH:mm:ss",sortIndex:1,sortOrder:"desc",calculateCellValue:function(b){return moment(b.TIB_FECHAHORA).add(a.TiempoUTCEmpleado,"hours").format("DD/MM/YYYY HH:mm:ss")}}],onRowDblClick:function(b){$("#Pop_Notificacion_Success").dxPopup("instance").option("height",
420);$("#Pop_Notificacion_Success").dxPopup("instance").option("width",420);$("#Pop_Notificacion_Success").dxPopup("instance").option("contentTemplate",function(){return $("<div>").append($("<div class='popup-property-details'>").append($('<div class="Nice-Shadow-1" style="padding: 9px;">Detalle de Bitacora</div>'),$('<div style="padding: 9px; background: #FFFFFF; color: #000000;">').append($('<div style="flex-grow: 1; font-size: 12px; font-weight: bold; text-align:left;">FECHA DE ALTA: <span style="font-weight: normal;">'+
moment(b.data.TIB_FECHAHORA).add(a.TiempoUTCEmpleado,"hours").format("DD/MM/YYYY HH:mm:ss")+"</span></div>"),$('<div style="flex-grow: 1; font-size: 12px; font-weight: bold; text-align:left;">GENERADO POR: <span style="font-weight: normal;">'+b.data.TIB_NOMBRE+"</span></div>"),$('<div style="flex-grow: 1; font-size: 12px; font-weight: bold; text-align:left;">DETALLE: <span style="font-weight: normal;">'+b.data.TIB_DESCRIPCION+"</span></div>"))))});$("#Pop_Notificacion_Success").dxPopup("show")}});
a.Dg_MensajesClienteOperador=$("#Dg_MensajesClienteOperador").dxDataGrid({deferRendering:!0,allowColumnResizing:!0,headerFilter:{visible:!1},keyExpr:"CSC_RESPUESTA",remoteOperations:!1,searchPanel:{visible:!1,highlightCaseSensitive:!0},selection:{mode:"single"},scrolling:{mode:"virtual",showScrollbar:"always",useNative:!0},groupPanel:{visible:!1},grouping:{autoExpandAll:!0},paging:{enabled:!1,pageIndex:0,pageSize:20},showBorders:!1,showRowLines:!1,showColumnLines:!1,rowAlternationEnabled:!1,columnAutoWidth:!1,
columns:[{dataField:"DETALLE",allowFiltering:!1,allowSorting:!1,cellTemplate(b,c){({data:c}=c);var d=null;1===c.RESPUESTA_LEIDO_CLIENTE?d="Si":d="No";var f=null;1===c.RESPUESTA_LEIDO_OPERADOR?f="Si":f="No";$('<div class="FlexContainer-Column MensajesRespuestaContent-'+c.RESPUESTA_CLAVE+'">').append($('<span style="width: 100%; font-weight: bold;">').text(`${c.RESPUESTA_NOMBRE} - ${c.RESPUESTA_CLAVE}`)).append($('<span  style="width: 100%; font-style: italic;">').text(`${moment(c.RESPUESTA_FECHAHORA_ALTA).add(a.TiempoUTCEmpleado,
"hours").format("DD/MM/YYYY HH:mm:ss")}`)).append($('<span style="width: 100%; font-weight: bold;">').text(`Asunto: ${c.RESPUESTA_ASUNTO}`)).append($('<span  style="width: 100%; font-size: 9px; font-weight: bold;">').text(`Leido Cliente - ${d} / Fecha - ${moment(c.RESPUESTA_FEC_LEIDO_CLIENTE).add(a.TiempoUTCEmpleado,"hours").format("DD/MM/YYYY HH:mm:ss")}`)).append($('<span  style="width: 100%; font-size: 9px; font-weight: bold;">').text(`Leido Operador - ${f} / Fecha - ${moment(c.RESPUESTA_FEC_LEIDO_OPERADOR).add(a.TiempoUTCEmpleado,
"hours").format("DD/MM/YYYY HH:mm:ss")}`)).appendTo(b)}}],onRowDblClick:function(b){var c=b.data.RESPUESTA_FEC_LEIDO_CLIENTE,d=moment(b.data.RESPUESTA_FEC_LEIDO_OPERADOR).add(a.TiempoUTCEmpleado,"hours").format("DD/MM/YYYY HH:mm:ss")||null,f=moment(c).add(a.TiempoUTCEmpleado,"hours").format("DD/MM/YYYY HH:mm:ss")||null,h=moment(b.data.AUDITORIA_FEC_ALTA).add(a.TiempoUTCEmpleado,"hours").format("DD/MM/YYYY HH:mm:ss")||null;d="Invalid date"==d?"S/D":d;f="Invalid date"==f?"S/D":f;"GENERA"==getUrlParam("TPO_USUARIO")?
null==b.data.RESPUESTA_LEIDO_CLIENTE&&a.ActualizaRespuestaLectura(b.data.CSC_RESPUESTA,b.data.TIC_CSCTICKET):null==b.data.RESPUESTA_LEIDO_OPERADOR&&a.ActualizaRespuestaLectura(b.data.CSC_RESPUESTA,b.data.TIC_CSCTICKET);$("#Pop_Notificacion_Success").dxPopup("instance").option("height","510");$("#Pop_Notificacion_Success").dxPopup("instance").option("width","90%");$("#Pop_Notificacion_Success").dxPopup("instance").option("contentTemplate",function(){return $("<div>").append($("<div class='popup-property-details'>").append($('<div class="Nice-Shadow-1" style="padding: 9px;">Detalle de Mensaje/Respuesta</div>'),
$('<div  class="FlexContainer-Row" style="padding: 3px; background: #FFFFFF; color: #000000;">').append($('<div class="FlexContainer-Column" style="padding: 9px; background: #FFFFFF; color: #000000; position: relative;flex-shrink: 1;flex-basis: auto;flex: 1; flex-grow: 1;">').append($('<div class="FlexContainer-Row" style="padding: 9px; background: #FFFFFF; color: #000000;font-size: 11px;">').append($('<div style="position: relative;flex-shrink: 1;flex-basis: auto;flex: 1; flex-grow: 1;font-weight: bold;">ASUNTO: <span style="font-weight: normal;">'+
b.data.RESPUESTA_ASUNTO+"</span></div>"),$('<div style="position: relative;flex-shrink: 1;flex-basis: auto;flex: 1; flex-grow: 1;font-weight: bold; text-align: right;">FECHA DE ALTA: <span style="font-weight: normal;">'+h+"</span></br></div>")),$('<div id="contentAdjuntos" class="FlexContainer-Row" style="font-weight: bold; text-align:left;font-size: 9px;"></div>'),$('<div style="flex-grow: 1; overflow: scroll; height: 300px; padding: 3px; margin:5px; border: solid gray 1px;">'+b.data.RESPUESTA_DESCRIPCION+
"</div>"),$('<div class="FlexContainer-Row" style="padding: 9px; background: #FFFFFF; color: #000000;font-size: 11px;">').append($('<div style="position: relative;flex-shrink: 1;flex-basis: auto;flex: 1; flex-grow: 1;font-weight: bold;">GENERADO POR: <span style="font-weight: normal;">'+b.data.RESPUESTA_CLAVE+"</span></br></div>"),$('<div style="position: relative;flex-shrink: 1;flex-basis: auto;flex: 1; flex-grow: 1;font-weight: bold;">LECTURA POR CLIENTE: <span style="font-weight: normal;">'+f+
"</span></br></div>"),$('<div style="position: relative;flex-shrink: 1;flex-basis: auto;flex: 1; flex-grow: 1;font-weight: bold;">LECTURA POR OPERADOR:<span style="font-weight: normal;">'+d+"</span></br></div>"))))))});$("#Pop_Notificacion_Success").dxPopup("show");a.Get_Mensaje_Files(b.data.TICKET_MENSAJE_NEWID)}});a.Get_Mensaje_Files=function(b){b={...ReturnDefaultData_Init(),TICKET_MENSAJE_NEWID:b};__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Get_Respuesta_Mensaje_Files","GET",b,getJSON(DeveloperType).ApiTickets_v2.token).then(c=>
{if(1==c.success){c=c.JsonData;const d=document.getElementById("contentAdjuntos");c.forEach(f=>{const h=document.createElement("div");h.style.width="260px";h.style.height="24px";h.style.padding="3px";h.style.borderRadius="5px";h.style.border="solid #1f5e26 1px";h.style.margin="3px";h.style.cursor="pointer";var l=f.TICKET_MENSAJE_FILE_MIMETYPE_SISTEMA;const q=document.createElement("img");q.src=a.getIconoPorMimetype(l);q.alt="Icono";q.style.float="left";q.width=16;h.appendChild(q);l=document.createElement("p");
l.textContent=f.TICKET_MENSAJE_FILE_DESCRIPCION;l.style.lineHeight="2";h.appendChild(l);h.onclick=function(){a.obtenDocumentoMensaje(f)};d.appendChild(h)})}}).catch(function(c){console.log(c);DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE","error",3E3)})};a.getIconoPorMimetype=b=>({jpg:"../../../images/Icons/IconMimeType/48px/jpg.png",png:"../../../images/Icons/IconMimeType/48px/png.png",pdf:"../../../images/Icons/IconMimeType/48px/pdf.png",xlsx:"../../../images/Icons/IconMimeType/48px/xlsx.png",
xls:"../../../images/Icons/IconMimeType/48px/xls.png"})[b]||"../../../images/Icons/IconMimeType/48px/_blank.png";a.obtenDocumentoMensaje=b=>{console.log(b);b={clveEmpresa:localStorage.getItem("EMP_CLV_EMPRESA"),TypeCon:localStorage.getItem("Type"),imageKey:`TICKET_MENSAJE/${b.TIC_NEWID}/${b.TICKET_MENSAJE_NEWID}/${b.TICKET_MENSAJE_FILE_RUTA}.${b.TICKET_MENSAJE_FILE_MIMETYPE_SISTEMA}`,contentType:b.TICKET_MENSAJE_FILE_MIMETYPE_ORIGINAL,filename:b.TICKET_MENSAJE_FILE_DESCRIPCION};console.log(b);__Reques_ajax(`${getJSON(DeveloperType).Bot_Internal_Storage_Anam.url}getImageTicketById`,
"GET",b,getJSON(DeveloperType).ApiGeneral.token).then(c=>{1==c.success?(p.hide(),c=c.urlTemporal,console.log(c),window.open(c)):p.hide()})};a.Dg_Empleados_Ticket=$("#Dg_Empleados_Ticket").dxDataGrid({deferRendering:!0,dataSource:a._Obj_Agrega_Emp_Ticket,allowColumnResizing:!0,headerFilter:{visible:!1},remoteOperations:!1,searchPanel:{visible:!1,highlightCaseSensitive:!0},selection:{mode:"multiple"},scrolling:{mode:"virtual",showScrollbar:"always",useNative:!0},groupPanel:{visible:!1},grouping:{autoExpandAll:!0},
paging:{enabled:!1,pageIndex:0,pageSize:20},showBorders:!0,showRowLines:!0,showColumnLines:!0,rowAlternationEnabled:!0,columnAutoWidth:!1,columns:[{caption:"NO. EMPLEADO",dataField:"EMPLEADO_ID_EXTERNO",width:90},{caption:"NOMBRE",dataField:"NOMBRE"}],toolbar:{items:[{location:"after",widget:"dxButton",options:{text:"Agregar Empleado(s)",icon:"add",disabled:!1,onClick(){a.BusquedaEmpleado("AsignaTicket","multiple")}}},{location:"after",widget:"dxButton",options:{text:"Quitar empleados seleccionados",
icon:"trash",disabled:!0,onClick(){a.Dg_Empleados_Ticket.getSelectedRowKeys().forEach(b=>{a._Obj_Agrega_Emp_Ticket.remove(b)});a.Dg_Empleados_Ticket.refresh()}}}]},onSelectionChanged(b){"EDITAR"==getUrlParam("TIPO")||getUrlParam("TIPO")}}).dxDataGrid("instance");a._DataGrid_Autorizacion=$("#Dg_Ticket_Autorizaciones").dxDataGrid({deferRendering:!0,headerFilter:{visible:!1},dataSource:a._Obj_Autorizaciones_Grid,keyExpr:"SAMT_TICKET_AUTORIZACIONES_CSC",searchPanel:{visible:!1,highlightCaseSensitive:!0},
selection:{mode:"single"},scrolling:{mode:"virtual",showScrollbar:"always",useNative:!0},groupPanel:{visible:!1},grouping:{autoExpandAll:!0},paging:{enabled:!1,pageIndex:0,pageSize:20},showBorders:!0,showRowLines:!0,showColumnLines:!0,rowAlternationEnabled:!0,columnAutoWidth:!1,height:165,width:280,columns:[{caption:"ID",dataField:"SAMT_TICKET_AUTORIZACIONES_CSC",width:100},{caption:"ESTATUS",dataField:"SAMT_TIPO_RESPUESTA_AUTORIZA_CSC",width:150,lookup:{displayExpr:"TIPO_RESPUESTA_AUTORIZA_IDIOMA1",
valueExpr:"SAMT_TIPO_RESPUESTA_AUTORIZA_CSC",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_TIPO_RESPUESTA_AUTORIZA"},getJSON(DeveloperType).ApiGeneral.token).then(b=>{if(1==b.success)return b.JsonData;console.log(b.message)})}catch(b){console.log(b)}}})}}},{caption:"RESPONSABLE",dataField:"NOMBRE",width:180},{caption:"FECHA ALTA",dataField:"AUDITORIA_FEC_ALTA",
alignment:"center",dataType:"date",width:150,calculateCellValue:function(b){return moment(b.AUDITORIA_FEC_ALTA).add(a.TiempoUTCEmpleado,"hours").format("DD/MM/YYYY HH:mm:ss")}},{caption:"COMENTARIOS",dataField:"AUTORIZADO_COMENTARIOS",width:200},{caption:"FECHA ACTUALIZACION",dataField:"AUDITORIA_FEC_ULT_MOD",alignment:"center",dataType:"date",width:150,calculateCellValue:function(b){return moment(b.AUDITORIA_FEC_ULT_MOD).add(a.TiempoUTCEmpleado,"hours").format("DD/MM/YYYY HH:mm:ss")}}],onRowDblClick:function(b){console.log(b.data)}}).dxDataGrid("instance");
a._Datagrid_Ot_Ticket=$("#Dg_Ot_Ticket_rel").dxDataGrid({deferRendering:!0,allowColumnResizing:!0,headerFilter:{visible:!1},dataSource:a._Obj_Ot_Ticket_Grid,keyExpr:"OTR_CSCORDENTRABAJO",remoteOperations:!1,searchPanel:{visible:!1,highlightCaseSensitive:!0},selection:{mode:"single"},scrolling:{mode:"virtual",showScrollbar:"always",useNative:!0},groupPanel:{visible:!1},grouping:{autoExpandAll:!0},paging:{enabled:!1,pageIndex:0,pageSize:20},showBorders:!0,showRowLines:!0,showColumnLines:!0,rowAlternationEnabled:!0,
columnAutoWidth:!1,columns:[{caption:"OT",dataField:"OTR_CSCORDENTRABAJO"},{caption:"ESTATUS",dataField:"ESTATUS_ORDEN_CSC",lookup:{displayExpr:"ESTATUS_ORDEN_IDIOMA1",valueExpr:"ESTATUS_ORDEN_CSC",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_ESTATUS_ORDEN_TRABAJO"},getJSON(DeveloperType).ApiGeneral.token).then(b=>{if(1==b.success)return b.JsonData;
console.log(b.message)})}catch(b){console.log(b)}}})}}},{caption:"AREA",dataField:"TIPO_AREA_CSC_RESPONSABLE",lookup:{displayExpr:"TIPO_AREA_IDIOMA1",valueExpr:"TIPO_AREA_CSC",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_CAT_EMPLEADO_AREA"},getJSON(DeveloperType).ApiGeneral.token).then(b=>{if(1==b.success)return b.JsonData;console.log(b.message)})}catch(b){console.log(b)}}})}}},
{caption:"DEPARTAMENTO",dataField:"CAT_DEPTO_CSC_RESPONSABLE",lookup:{displayExpr:"SAMT_TIPO_DEPARTAMENTO_IDIOMA1",valueExpr:"EMPLEADO_DEPARTAMENTO_CSC",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_CAT_EMPLEADO_DEPARTAMENTO"},getJSON(DeveloperType).ApiGeneral.token).then(b=>{if(1==b.success)return b.JsonData;console.log(b.message)})}catch(b){console.log(b)}}})}}},
{caption:"RESPONSABLE",dataField:"EMPLEADO_CSC_RESPONSABLE"},{caption:"CERRADA",dataField:"OTR_CERRADA"}],onRowDblClick:function(b){console.log(b.data);setTimeout(()=>{e("EDITAR",b.data.OTR_NEWID)},1E3)}}).dxDataGrid("instance");a._DataGrid_Ticket_Participante=$("#Dg_Ticket_Participantes").dxDataGrid({deferRendering:!0,allowColumnResizing:!0,headerFilter:{visible:!1},dataSource:a._Obj_Ticket_Participantes_Grid,keyExpr:"EMPLEADO_CSC_EMPLEADO",remoteOperations:!1,searchPanel:{visible:!1,highlightCaseSensitive:!0},
selection:{mode:"multiple"},scrolling:{mode:"virtual",showScrollbar:"always",useNative:!0},groupPanel:{visible:!1},grouping:{autoExpandAll:!0},paging:{enabled:!1,pageIndex:0,pageSize:20},showBorders:!0,showRowLines:!0,showColumnLines:!0,rowAlternationEnabled:!0,columnAutoWidth:!1,columns:[{caption:"NOMBRE COMPLETO",dataField:"NOMBRE_EMPLEADO"},{caption:"TIPO PARTICIPANTE",dataField:"TIPO_PARTICIPANTE_CSC",lookup:{displayExpr:"TIPO_PARTICIPANTE_IDIOMA1",valueExpr:"TIPO_PARTICIPANTE_CSC",dataSource:{store:new DevExpress.data.CustomStore({load:async function(){try{return a.jsonTiposParticipanes}catch(b){console.log(b)}}})}}},
{caption:"CORREO",dataField:"EMPLEADO_EMAIL_NOTIFICA"}],toolbar:{items:[{location:"after",widget:"dxButton",options:{text:"Agregar Participante(s)",icon:"add",disabled:!1,onClick(){a.BusquedaEmpleado("AgregarParticipante","multiple")}}},{location:"after",widget:"dxButton",options:{text:"Quitar participante(s) seleccionado(s)",icon:"trash",disabled:!0,onClick(){a._DataGrid_Ticket_Participante.getSelectedRowKeys().forEach(b=>{a._Obj_Ticket_Participantes_Grid.remove(b)});a._DataGrid_Ticket_Participante.refresh()}}}]},
onSelectionChanged(b){"LECTURA"!=getUrlParam("TIPO")&&a._DataGrid_Ticket_Participante.option("toolbar.items[1].options.disabled",!b.selectedRowsData.length)}}).dxDataGrid("instance");a.FileCorreoRespuesta=$("#FileCorreoRespuesta").dxFileUploader({multiple:!0,allowedFileExtensions:".jpg .jpeg .gif .png .pdf .doc .docx .xlsx .wav .mp3 .xls .pptx".split(" "),uploadMode:"useButtons",visible:!0,disabled:!0,onValueChanged:function(b){var c=b.component.option("values");$.each(c,function(d,f){b.element.find(".dx-fileuploader-upload-button").hide()});
b.element.find(".dx-fileuploader-upload-button").hide()}}).dxFileUploader("instance")};a.ClickAlta=function(){$_Btn_Agregar_Respuesta.option("disabled",!0);$_Btn_Agregar_Bitacora.option("disabled",!0);$Btn_Alta_Ticket.option("visible",!1);$btn_Modificar_Ticket.option("visible",!1);$btn_Cancelar_Alta_Ticket.option("visible",!0);$btn_Salvar_Alta_Ticket.option("visible",!0);a.Frm_Ticket_Servicio_Instance.resetValues();a.Frm_Ticket_Servicio_Instance.option("readOnly",!1);a.setDefaultValues=!0;a.LoadCatFull=
!1;a.editandoForma=!1;var e=n.EMPLEADO_NOMBREEMPLEADO+" "+n.EMPLEADO_APATERNOEMPLEADO+" "+n.EMPLEADO_AMATERNOEMPLEADO;switch(getUrlParam("TPO_USUARIO")){case "GENERA":a.Frm_Ticket_Servicio_Instance.itemOption("TIC_ATIENDE","isRequired",!1);a.Frm_Ticket_Servicio_Instance.itemOption("TIC_SOLICITA","isRequired",!0);a.Frm_Ticket_Servicio_Instance.getEditor("CAM_MESA_CSC").option("readOnly",!0);a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("readOnly",!0);a.Frm_Ticket_Servicio_Instance.itemOption("CAM_CSC_SERVICIO_SOLICITA",
"isRequired",!1);a.Frm_Ticket_Servicio_Instance.getEditor("TIC_DESCRIPCION_SOLUCION").option("readOnly",!0);a.Frm_Ticket_Servicio_Instance.getEditor("ESTATUS_TICKET_CSC").option("readOnly",!0);a.Frm_Ticket_Servicio_Instance.getEditor("TIPO_TICKET_CSC").option("readOnly",!0);a.Frm_Ticket_Servicio_Instance.getEditor("TIPO_PRIORIDAD_CSC").option("readOnly",!0);a.Frm_Ticket_Servicio_Instance.getEditor("SAMT_CAM_TIPO_SERVICIO_CSC").option("readOnly",!0);a.Frm_Ticket_Servicio_Instance.getEditor("REQ_CSCREQUISICION").option("readOnly",
!1);a.Frm_Ticket_Servicio_Instance.getEditor("EMPLEADO_CSC_SOLICITA").option("readOnly",!0);a.Frm_Ticket_Servicio_Instance.getEditor("TIC_DESCRIPCION").option("readOnly",!1);a.Frm_Ticket_Servicio_Instance.getEditor("TIC_ATIENDE").option("readOnly",!0);a.Frm_Ticket_Servicio_Instance.getEditor("TIC_SOLICITA").option("readOnly",!1);a.Frm_Ticket_Servicio_Instance.getEditor("TIC_SOLICITA").option("value",e);a.Frm_Ticket_Servicio_Instance.getEditor("TIC_EMAIL_SOLICITANTE").option("value",n.EMPLEADO_EMAILLABORAL);
a.Frm_Ticket_Servicio_Instance.getEditor("TIC_TELEFONO_SOLICITANTE").option("value",n.EMPLEADO_TELEFONO1);a.Frm_Ticket_Servicio_Instance.getEditor("EMPLEADO_CSC_SOLICITA").option("value",n.EMPLEADO_CSC_EMPLEADO);a.Frm_Ticket_Servicio_Instance.getEditor("CLIENTE_CSC_SOLICITA").option("value",n.CLIENTE_CSC);a.Frm_Ticket_Servicio_Instance.getEditor("TIC_AUXS2").option("readOnly",!0);break;default:a.Frm_Ticket_Servicio_Instance.getEditor("CLIENTE_CSC_SOLICITA").option("value",n.CLIENTE_CSC),a.Frm_Ticket_Servicio_Instance.itemOption("TIC_ATIENDE",
"isRequired",!0),a.Frm_Ticket_Servicio_Instance.itemOption("TIC_SOLICITA","isRequired",!0),a.Frm_Ticket_Servicio_Instance.getEditor("EMPLEADO_CSC_ATIENDE").option("value",n.EMPLEADO_CSC_EMPLEADO),a.Frm_Ticket_Servicio_Instance.getEditor("TIC_DESCRIPCION").option("readOnly",!1),a.Frm_Ticket_Servicio_Instance.getEditor("REQ_CSCREQUISICION").option("readOnly",!1),a.Frm_Ticket_Servicio_Instance.getEditor("EMPLEADO_CSC_SOLICITA").option("readOnly",!0),a.Frm_Ticket_Servicio_Instance.getEditor("TIC_ATIENDE").option("value",
e),a.Frm_Ticket_Servicio_Instance.getEditor("TIC_ATIENDE").option("readOnly",!1),a.Frm_Ticket_Servicio_Instance.itemOption("CAM_CSC_SERVICIO_SOLICITA","isRequired",!0),a.Frm_Ticket_Servicio_Instance.getEditor("TIC_AUXS2").option("readOnly",!1)}setTimeout(()=>{a.Frm_Ticket_Servicio_Instance.getEditor("TIC_NEWID").option("value",createUUID(36));a.Frm_Ticket_Servicio_Instance.getEditor("TIC_FECHA_ALTA").option("value",moment().tz(a.TimeZoneEmpleado).format("YYYY-MM-DD HH:mm:ss"));a.Frm_Ticket_Servicio_Instance.getEditor("CAM_MESA_CSC").option("value",
parseInt(getUrlParam("CSC_MESA")))},1E3)};a.Generar_Alta_Ticket=function(){var e=a.Frm_Ticket_Servicio_Instance,g=a.Frm_Ticket_Servicio_Instance.option("formData"),m=a.Frm_Ticket_Servicio_Instance.getEditor("TIPIFICA_CSC").option("selectedItem"),k=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss");moment().tz(a.TimeZoneServidor).format("YYYY-MM-DDTHH:mm:ss");if(!0===e.validate().isValid){e=GetInsertData(g,e);e.AUDITORIA_USU_ALTA=n.EMPLEADO_CSC_EMPLEADO;e.AUDITORIA_USU_ULT_MOD=n.EMPLEADO_CSC_EMPLEADO;
e.EMP_CSC_EMPRESA_HOST=localStorage.getItem("EMP_CSC_EMPRESA_HOST");e.TIC_FECHA_ALTA=k;e.TIC_FECHA_ALTA_SOLA=k;e.TIC_FECHA_ALTA_HORA_COMPLETA=k;e.AUDITORIA_FEC_ALTA=k;e.AUDITORIA_FEC_ULT_MOD=k;e.TIC_DURACION_RECEPCION=0;e.TIC_FECHA_PROMESA=e.TIC_FECHA_PROMESA?moment(e.TIC_FECHA_PROMESA).add(CalculaTimeposInsertUpdate(),"hours").format("YYYY-MM-DD HH:mm:ss"):0==m.TIPIFICA_TIEMPO_EJECUCION?moment(k).add(a.TimeDefault,"seconds").format("YYYY-MM-DD HH:mm:ss"):moment(k).add(m.TIPIFICA_TIEMPO_EJECUCION,
"seconds").format("YYYY-MM-DD HH:mm:ss");e.TIC_FECHA_SOLICITA=e.TIC_FECHA_SOLICITA?moment(e.TIC_FECHA_SOLICITA).add(CalculaTimeposInsertUpdate(),"hours").format("YYYY-MM-DD HH:mm:ss"):moment(k).add(a.TimeDefault,"seconds").format("YYYY-MM-DD HH:mm:ss");""==e.TIC_CSCTICKET&&delete e.TIC_CSCTICKET;if(1==e.TIC_CERRADO){e.TIC_FECHA_CIERRE=k;e.TIC_FECHA_CIERRE_SOLA=k;e.TIC_FECHA_CIERRE_HORA_COMPLETA=k;var b=e.TIC_FECHA_ALTA;k=moment(k);b=moment(b);k=k.diff(b,"seconds");e.TIC_DURACION_EJECUCION=k}e.TIC_TIEMPO_RECEPCION=
m.TIPIFICA_TIEMPO_RECEPCION;e.TIC_TIEMPO_EJECUCION=0==m.TIPIFICA_TIEMPO_EJECUCION?a.TimeDefault:m.TIPIFICA_TIEMPO_EJECUCION;e.TIC_TIEMPO_CONFIRMACION=m.TIPIFICA_TIEMPO_CONFIRMACION;e.TIC_NOTIFICA_OPERACION=1;e.TIC_ESTATUS_SLA_ENUM="pause";e.TIC_REQ_AUTORIZACION=1;m=a.Frm_Ticket_Servicio_Instance.getEditor("TIPIFICA_CSC_PARENT_PARENT").option("selectedItem");e={...ReturnDefaultData_Init(),DATA_INSERT:e};"REQUERIMIENTO DE SERVICIO"==m.TIPIFICA_IDIOMA1&&1>=a.documentsUploadToTicket.option("value").length?
(a.notificaPantalla("Alerta!",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),`La categoria de ticket de tipo ${m.TIPIFICA_IDIOMA1} requiere oficio de solicitud y formato de requerimientos. Agr\u00e9guelos en "Documentos"`,400,150),p.hide()):"INCIDENTE"==m.TIPIFICA_IDIOMA1&&0==a.imageUploadToTicket.option("value").length?(a.notificaPantalla("Alerta!",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),`La categoria de ticket de tipo ${m.TIPIFICA_IDIOMA1} requiere al menos una evidencia fotogr\u00e1fica o video. Agr\u00e9guelos en "ADJUNTAR EVIDENCIA"`,
400,150),p.hide()):__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Insert_Ticket_Servicio","POST",JSON.stringify(e),getJSON(DeveloperType).ApiTickets_v2.token).then(c=>{if(1==c.success){DevExpress.ui.notify({message:"Solicitud generada correctamente",minWidth:150,type:"success",displayTime:1E4},{position:"bottom right",direction:"up-push"});$Btn_Alta_Ticket.option("visible",!0);$btn_Modificar_Ticket.option("visible",!0);$btn_Cancelar_Alta_Ticket.option("visible",!1);$btn_Salvar_Alta_Ticket.option("visible",
!1);a.Frm_Ticket_Servicio_Instance.option("readOnly",!0);var d={...ReturnDefaultData_Init(),TIC_NEWID:g.TIC_NEWID,CAM_CSC_SERVICIO:g.CAM_CSC_SERVICIO};let h=a.Frm_Ticket_Servicio_Instance.getEditor("ESTATUS_TICKET_CSC").option("selectedItem");var f={};f.TIC_CSCTICKET=c.JsonData.idTicketInsert;f.ESTATUS_TICKET_CSC=h.ESTATUS_TICKET_CSC;p.show();a.InsertaBitacoraManual(f,Globalize.formatMessage("txtBitaInfoAltaProceso")+": "+h.ESTATUS_TICKET_IDIOMA1,!1,1,2);a.uploadImageToTicket(!1);a.uploadFileToTicket(!1);
setTimeout(()=>{p.show();setTimeout(()=>{a.Get_Tickets(d,!0,null)},3E3)},2E3);$_Btn_Agregar_Respuesta.option("disabled",!1);$_Btn_Agregar_Bitacora.option("disabled",!1)}else p.hide();return c}).catch(function(c){console.log(c);p.hide();DevExpress.ui.notify({message:"ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"})})}else DevExpress.ui.notify({message:"Llene los campos en rojo",minWidth:150,type:"error",
displayTime:5E3},{position:"bottom right",direction:"up-push"})};a.InsertTicketProviderTesteo=function(e){__Reques_ajax_Providers("https://www.soportecarga.mx/Apicoveca1/Servicios","POST",JSON.stringify(e),"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1laWRlbnRpZmllciI6IkFMRVgiLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9lbWFpbGFkZHJlc3MiOiJsb3Blel9hbGVqYW5kcm9AbGl2ZS5jb20iLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9naXZlbm5hbWUiOiJBTEVKQU5EUk8gTMOTUEVaIiwiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93cy8yMDA4LzA2L2lkZW50aXR5L2NsYWltcy9yb2xlIjoiQURNSU5JU1RSQURPUiIsImV4cCI6MTc1NjQyMDQxMCwiaXNzIjoiaHR0cHM6Ly93d3cuc29wb3J0ZWNhcmdhLm14L2Rlc2tfcnQ0IiwiYXVkIjoiaHR0cHM6Ly93d3cuc29wb3J0ZWNhcmdhLm14L2Rlc2tfcnQ0In0.t9_uOYu_AQtVVkfyQDWaByUIx2zguOLCT18Cvr3aQCM").then(g=>
{console.log(g)}).catch(function(g){console.log(g);p.hide();DevExpress.ui.notify({message:"ERRO DE COMUNICACI\u00d3N CON PROVEEDOR, INTENTELO NUEVAMENTE",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"})})};a.Get_Tickets=function(e,g,m){p.show();__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Get_Ticket_Servicio","GET",e,getJSON(DeveloperType).ApiTickets_v2.token).then(k=>{if(1==k.success){p.hide();var b=k.JsonData[0];null!=b.TIC_FECHA_PROMESA&&(b.TIC_FECHA_PROMESA=
moment(b.TIC_FECHA_PROMESA).add(a.TiempoUTCEmpleado,"hours").format("YYYY-MM-DD HH:mm:ss"));null!=b.TIC_FECHA_ALTA&&(b.TIC_FECHA_ALTA=moment(b.TIC_FECHA_ALTA).add(a.TiempoUTCEmpleado,"hours").format("YYYY-MM-DD HH:mm:ss"));null!=b.TIC_FECHA_CIERRE&&(b.TIC_FECHA_CIERRE=moment(b.TIC_FECHA_CIERRE).add(a.TiempoUTCEmpleado,"hours").format("YYYY-MM-DD HH:mm:ss"));null!=b.TIC_FECHA_SOLICITA&&(b.TIC_FECHA_SOLICITA=moment(b.TIC_FECHA_SOLICITA).add(a.TiempoUTCEmpleado,"hours").format("YYYY-MM-DD HH:mm:ss"));
switch(getUrlParam("TPO_USUARIO")){case "GENERA":a.Frm_Ticket_Servicio_Instance.getEditor("CAM_CSC_SERVICIO_SOLICITA").option("readOnly",!0);$btnCalificaAtencion.option("visible",!0);$btn_Modificar_Ticket.option("visible",!1);break;default:if(a.Frm_Ticket_Servicio_Instance.itemOption("CAM_CSC_SERVICIO_SOLICITA","isRequired",!0),null==b.EMPLEADO_CSC_ATIENDE){if(console.log("No se tiene empleados asignado"),"GENERA"!=getUrlParam("TPO_USUARIO"))if("true"==getUrlParam("AUTORIZADOR"))console.log("No Asigna empleado");
else{b.EMPLEADO_CSC_ATIENDE=n.EMPLEADO_CSC_EMPLEADO;var c={};c.AUDITORIA_USU_ULT_MOD=n.EMPLEADO_CSC_EMPLEADO;c.EMPLEADO_CSC_ATIENDE=n.EMPLEADO_CSC_EMPLEADO;c.TIC_ATIENDE=n.EMPLEADO_NOMBREEMPLEADO+" "+n.EMPLEADO_APATERNOEMPLEADO+" "+n.EMPLEADO_AMATERNOEMPLEADO;c.AUDITORIA_FEC_ULT_MOD=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss");c={...ReturnDefaultData_Init(),DATA_UPDATE:c,DATA_WHERE:{TIC_CSCTICKET:b.TIC_CSCTICKET,TIC_NEWID:b.TIC_NEWID,EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST")}};
__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Update_Ticket_Servicio","POST",JSON.stringify(c),getJSON(DeveloperType).ApiTickets_v2.token).then(f=>{1==f.success&&(DevExpress.ui.notify("Empleado Asignado correctamente","success",3E3),a.Frm_Ticket_Servicio_Instance.getEditor("TIC_ATIENDE").option("value",n.EMPLEADO_NOMBREEMPLEADO+" "+n.EMPLEADO_APATERNOEMPLEADO+" "+n.EMPLEADO_AMATERNOEMPLEADO))}).catch(function(f){DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE",
"error",3E3)});let d=n.EMPLEADO_NOMBREEMPLEADO+" "+n.EMPLEADO_APATERNOEMPLEADO+" "+n.EMPLEADO_AMATERNOEMPLEADO;c={};c.TIC_CSCTICKET=b.TIC_CSCTICKET;c.ESTATUS_TICKET_CSC=b.ESTATUS_TICKET_CSC;a.InsertaBitacoraManual(c,"Ticket asignado a: "+d,!1,1,2);console.log("Ticket asignado a: "+d)}}else DevExpress.ui.notify("Ya se esta atendiendo por un operador","warning",3E3),console.log("Ya se tiene empleado asignado")}b=JSON.stringify(b);a.DataTicketOpen=JSON.parse(b);a.Frm_Ticket_Servicio_Instance.updateData(a.DataTicketOpen);
setTimeout(()=>{a.ObtenSelectBoxFrm(a.Frm_Ticket_Servicio_Instance);a.Get_Ticket_Documentos(!1);a.Previous_TxtEstatus=a.Frm_Ticket_Servicio_Instance.getEditor("ESTATUS_TICKET_CSC").option("text");getUrlParam("TPO_USUARIO")},3E3);1==g&&($("#Pop_Notificacion_Success").dxPopup("instance").option("height",300),$("#Pop_Notificacion_Success").dxPopup("instance").option("width",360),$("#Pop_Notificacion_Success").dxPopup("instance").option("contentTemplate",function(){return $("<div>").append($("<div class='popup-property-details'>").append($('<div class="Nice-Shadow-1" style="padding: 9px;">TICKET GENERADO</div>'),
$('<div class="content">').append($('<img style=" width: 200px; height: 150px;" src="../../../images/Icons/success_ticket.gif" alt="">'),$('<div style="flex-grow: 1; font-size: 20px; font-weight: bold;">No. ticket: '+k.JsonData[0].TIC_CSCTICKET+"</div>"),$('<div style="flex-grow: 1; font-size: 12px;">GUARDE SU NUMERO DE TICKET PARA FUTURAS CONSULTAS</div>'))))}),$("#Pop_Notificacion_Success").dxPopup("show"),b=a.Frm_Ticket_Servicio_Instance.getEditor("ESTATUS_TICKET_CSC").option("selectedItem"),a.EnviaRespuesta("Nuevo ticket No. - "+
a.DataTicketOpen.TIC_CSCTICKET,a.DataTicketOpen.TIC_NEWID,`<b>Estatus:</b> ${b.ESTATUS_TICKET_IDIOMA1} <br><br> Cordial saludo, queremos informarte que su ticket fue generado con \u00e9xito, a partir de este momento empezamos el estudio correspondiente para darte una respuesta con la mayor oportunidad posible.`,null))}else p.hide(),1==g?DevExpress.ui.notify("TICKET NO LOCALIZADO","error",3E3):DevExpress.ui.notify("TICKETS NO LOCALIZADO","error",3E3);return k}).catch(function(k){p.hide();console.log(k);
DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE","error",3E3)})};a.Get_Bitacora_tickets=function(e){$("#Dg_Bitacora_Ticket").length&&(e={...ReturnDefaultData_Init(),TIC_CSCTICKET:e},__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Get_Ticket_Bitacora","GET",e,getJSON(DeveloperType).ApiTickets_v2.token).then(g=>{1==g.success?$("#Dg_Bitacora_Ticket").dxDataGrid("instance").option("dataSource",g.JsonData):$("#Dg_Bitacora_Ticket").dxDataGrid("instance").option("dataSource",
[])}).catch(function(g){DevExpress.ui.notify({message:"ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"});$("#Dg_Bitacora_Ticket").dxDataGrid("instance").option("dataSource",[])}))};a.Get_Ticket_Foto=function(){if($("#Dg_RepFoto_Ticket").length){var e=a.Frm_Ticket_Servicio_Instance.option("formData");e={...ReturnDefaultData_Init(),TIC_NEWID:e.TIC_NEWID,TICKET_ACTIVO:1};__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+
"Get_Ticket_Foto","GET",e,getJSON(DeveloperType).ApiTickets_v2.token).then(g=>{1==g.success?$("#Dg_RepFoto_Ticket").dxDataGrid("instance").option("dataSource",g.JsonData):($("#Dg_RepFoto_Ticket").dxDataGrid("instance").option("dataSource",[]),p.hide())})}};a.Get_Ticket_Documentos=function(e){if($("#Dg_Documento_Ticket").length){var g=a.Frm_Ticket_Servicio_Instance.option("formData");g={...ReturnDefaultData_Init(),TIC_NEWID:g.TIC_NEWID,TICKET_FILE_ACTIVO:1};__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+
"Get_Ticket_Documentos","GET",g,getJSON(DeveloperType).ApiTickets_v2.token).then(m=>{if(1==m.success){var k=jslinq(m.JsonData).where(function(b){return"Solicitud_Servicio_Sistema.pdf"==b.TICKET_FILE_DESCRIPCION.trim()}).toList();1==e&&0<k.length&&a.ObtenSolicitudFormal(k[0].TIC_NEWID,k[0].TICKET_FILE_RUTA);$("#Dg_Documento_Ticket").dxDataGrid("instance").option("dataSource",m.JsonData)}else $("#Dg_Documento_Ticket").dxDataGrid("instance").option("dataSource",[]),p.hide()})}};a.Get_Linkeo_ticket_ot=
function(e){a._Obj_Ot_Ticket_Grid.clear();if(58!=n.CAT_AREA_CSC||112!=n.CAT_DEPARTAMENTO_CSC)e={...ReturnDefaultData_Init(),TIC_CSCTICKET:e,MS:"BASE"},__Reques_ajax(getJSON(DeveloperType).ApiOrdenTrabajo_v2.url+"Get_Linkeo_ticket_ot","GET",e,getJSON(DeveloperType).ApiOrdenTrabajo_v2.token).then(g=>{1==g.success&&g.JsonData.forEach(function(m){a._Obj_Ot_Ticket_Grid.insert(m)});a._Datagrid_Ot_Ticket.refresh()}).catch(function(g){DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE",
"error",3E3);a._Datagrid_Ot_Ticket.refresh()})};a.Get_Ticket_Participantes=function(e){$("#Dg_Ticket_Participantes").length&&(a._Obj_Ticket_Participantes_Grid.clear(),e={...ReturnDefaultData_Init(),TIC_NEWID:e,TIPO_PARTICIPANTE_CSC_IN:"1,2,3"},__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Get_Ticket_Part","GET",e,getJSON(DeveloperType).ApiTickets_v2.token).then(g=>{1==g.success&&(g=g.JsonData,console.log(g),g.forEach(function(m){a._Obj_Ticket_Participantes_Grid.insert(m)}));a._DataGrid_Ticket_Participante.refresh()}).catch(function(g){DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE",
"error",3E3);a._DataGrid_Ticket_Participante.refresh()}))};a.EnviaCorreo=function(e){t.show();t.message=Globalize.formatMessage("msjTicketSendMail");e=a.Frm_Ticket_Servicio_Instance.option("formData");e=[{mail:CorreoEnviar,Nombre:NombreMandaCorreo,Proceso:"Actualizaci\u00f3n de Solicitud",Solicitud:e.TIC_DESCRIPCION_SOLUCION}];var g=null;for(const m in e)g={CLAVE_SMTP:"DNA.ORACLE",Template:"Noti_Generica",emailto:e[m].mail,subject:"Notificaciones tickets",bcc:dts_FrmSura.EMAIL_RESPUESTA_CCO,TEMPLATE_PARAMETROS:{emailAddress:e[m].mail,
titulosolicitud:NombreMandaCorreo,lblproceso:e[m].Proceso,lbltiposolicitud:"<p>Cordial saludo,</p>\n        <p></p>\n        <p>\n          Te informamos que la solicitud a nombre de XXXXXX, con documento No. XXXX, se\n          encuentra en estado &quot;PENDIENTE POR REQUISITOS&quot; para poder hacer\n          efectiva esta solicitud debes adjuntar:\n        </p>\n        <p></p>\n        <p>XXXXX (especificar lo que se requiera)</p>\n        <p></p>\n        <p>\n          Es importante tener en cuenta que el tiempo de respuesta inicia, una vez la\n          solicitud tenga los requisitos completos.\n        </p>\n        <p></p>\n        <p>Muchas gracias por su comprensi\u00f3n y colaboraci\u00f3n.</p>",
lbltipotitulosoli:"Por favor, NO respondas a este mensaje, este es un medio informativo autom\u00e1tico. Si requieres m\u00e1s informaci\u00f3n sobre el contenido haz click aqu\u00ed: ",lblnombresoli:"Enviado por: BOT DNASYSTEM"}},__Reques_ajax(getJSON(DeveloperType).ApiSuraCrmColombia.url+"Send_Mail_Dinamico","POST",JSON.stringify(g),getJSON(DeveloperType).ApiSuraCrmColombia.token).then(k=>{1==k.success&&DevExpress.ui.notify({message:"E-Mail Enviado",minWidth:150,type:"success",displayTime:5E3},
{position:"bottom right",direction:"up-push"});t.hide()}).catch(function(k){t.hide();DevExpress.ui.notify({message:"ERROR EN COMUNICACION CON EL SERVIDOR INTENTE NUEVAMENTE",minWidth:150,type:"success",displayTime:5E3},{position:"bottom right",direction:"up-push"});console.log(k)})};a.utf8Encode=function(e){if("string"!=typeof e)throw new TypeError("parameter \u2018unicodeString\u2019 is not a string");return e.replace(/[\u0080-\u07ff]/g,function(g){g=g.charCodeAt(0);return String.fromCharCode(192|
g>>6,128|g&63)}).replace(/[\u0800-\uffff]/g,function(g){g=g.charCodeAt(0);return String.fromCharCode(224|g>>12,128|g>>6&63,128|g&63)})};a.EnviaRespuesta=function(e,g,m,k){t.show();t.message=Globalize.formatMessage("msjTicketSendMail");let b=a.Frm_Ticket_Servicio_Instance.option("formData"),c="";c=b.TIC_EMAIL_SOLICITANTE;e={_ClientData:{EMP_CLV_EMPRESA:ReturnDefaultData_Init().EMP_CLV_EMPRESA,Type:ReturnDefaultData_Init().Type,EMP_CSC_EMPRESA_HOST:ReturnDefaultData_Init().EMP_CSC_EMPRESA_HOST},MailDataConfig:{emailto:c,
subject:`${e} ###${b.TIC_CSCTICKET}###${g}`,template:{templateLayout:"Noti_Dna_Default",templateData:{lbl_id_ticket:"No. de ticket",val_id_ticket:b.TIC_CSCTICKET,lbl_f_alta:"Fecha de alta",val_f_alta:b.TIC_FECHA_ALTA,lbl_tipo:"Tipo",val_tipo:a.Frm_Ticket_Servicio_Instance.getEditor("TIPO_TICKET_CSC").option("text"),lbl_prio:"Prioridad",val_prio:a.Frm_Ticket_Servicio_Instance.getEditor("TIPO_PRIORIDAD_CSC").option("text"),lbl_head_info:"Informaci\u00f3n de solictud",lbl_mesa:"Mesa de ayuda",val_mesa:a.Frm_Ticket_Servicio_Instance.getEditor("CAM_MESA_CSC").option("text"),
lbl_estatus:"Estatus",val_estatus:a.Frm_Ticket_Servicio_Instance.getEditor("ESTATUS_TICKET_CSC").option("text"),txt_body_mail:m,lbl_footer:"<b>INFORMACI\u00d3N CONFIDENCIAL</b> Este comunicado es para ser utilizado por el receptor y contiene informaci\u00f3n que puede ser privilegiada, confidencial, de propiedad intelectual y/o que contenga datos personales, de acuerdo con las leyes aplicables. Si usted no es el receptor interesado, por el presente se le notifica formalmente que cualquier uso, copia o distribuci\u00f3n de este correo electr\u00f3nico, en todo o en parte, est\u00e1 estrictamente prohibido. Por favor notifique al remitente regres\u00e1ndole este correo electr\u00f3nico y b\u00f3rrelo de su sistema. Este correo electr\u00f3nico no constituye un consentimiento para el uso de la informaci\u00f3n del remitente, para prop\u00f3sitos directos de mercadotecnia o para transmisiones de informaci\u00f3n a terceros.",
fechaEnvio:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),EMPLEADO_CSC_EMPLEADO:n.EMPLEADO_CSC_EMPLEADO,TIC_NEWID:g,MensajeNewId:k}}}};$.ajax({xhr:function(){var d=new window.XMLHttpRequest;d.upload.addEventListener("progress",function(f){},!1);return d},type:"POST",url:`${getJSON(DeveloperType).Bot_Internal_Storage_Anam.url}apiNotify/mailsystem/SendMail`,cache:!1,processData:!1,data:JSON.stringify(e),contentType:"application/json",headers:{}}).done(function(d){1==d.success&&DevExpress.ui.notify({message:"E-Mail Enviado",
minWidth:150,type:"success",displayTime:5E3},{position:"bottom right",direction:"up-push"});t.hide()}).fail(function(d){console.log(d);DevExpress.ui.notify({message:"Error en el envio de correo",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"});t.hide()})};a.Generar_Orden_Trabajo_Rechazo=function(){var e=JSON.parse(sessionStorage.getItem("Cat_Proceso_Empleados")),g=JSON.parse(sessionStorage.getItem("Cat_Sub_Proceso_Empleados")),m=JSON.parse(sessionStorage.getItem("Cat_Estatus_Empleados"));
e=jslinq(e).where(function(k){return"ACTIVO"==k.CAT_PROCESO_EMP_CLAVE.trim()}).toList();g=jslinq(g).where(function(k){return"OPER"==k.CAT_SUBPROCESO_EMP_CLAVE.trim()}).toList();jslinq(m).where(function(k){return"ACT"==k.CAT_ESTATUS_PROCESO_EMP_CLAVE.trim()}).toList();m=e[0].CAT_PROCESO_EMP_CSC;g=g[0].CAT_SUBPROCESO_EMP_CSC;m={...ReturnDefaultData_Init(),CAT_PROCESO_EMP_CSC:m,CAT_SUBPROCESO_EMP_CSC:g,CAT_AREA_CSC:58,CAT_DEPARTAMENTO_CSC:107,OTR_CERRADA:0};__Reques_ajax(getJSON(DeveloperType).ApiOrdenTrabajo_v2.url+
"Get_Ot_Conteo_Empleado","GET",m,getJSON(DeveloperType).ApiOrdenTrabajo_v2.token).then(k=>{if(1==k.success){p.hide();k=k.JsonData;var b=a.Frm_Ticket_Servicio_Instance.option("formData");b="Detalle solicitud: "+b.TIC_DESCRIPCION+" Detalle de rechazo: "+b.TIC_MOTIVO_RECHAZO;var c=createUUID(36);k={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),Type:localStorage.getItem("Type"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),DATA_INSERT:{OTR_FECHA_ALTA:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),
OTR_NEWID:c,REQ_CSCREQUISICION:n.REQ_CSCREQUISICION,ESTATUS_ORDEN_CSC:1,CAT_PROVEEDOR_INFRA_CSC:12,TIPO_PRIORIDAD_CSC:3,TIPO_ORDEN_CSC:63,SUB_TIPO_CSC:351,TIPO_DISCIPLINA_OT_CSC:3,TIPO_ESPECIALIDAD_OT_CSC:48,TIPO_OT_TRAMITE_CSC:1,TIPO_CALIFICACION_CSC:1,EMPLEADO_CSC_SOLICITA:n.EMPLEADO_CSC_EMPLEADO,EMPLEADO_CSC_RESPONSABLE:k[0].EMPLEADO_CSC_EMPLEADO,TIPO_AREA_CSC_SOLICITUD:n.CAT_AREA_CSC,CAT_DEPTO_CSC_SOLICITUD:n.CAT_DEPARTAMENTO_CSC,TIPO_AREA_CSC_RESPONSABLE:58,CAT_DEPTO_CSC_RESPONSABLE:107,EMPLEADO_CSC_ALTA:n.EMPLEADO_CSC_EMPLEADO,
MDA_CVEMONEDA:1,OTR_COSTO:0,OTR_DESCRIPCION:b,OTR_SOLUCION:"",OTR_CANCELACION:"",OTR_FECHA_PROGRAMADA:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),OTR_FECHA_PROMESA:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),OTR_CERRADA:!1,MDA_CVEMONEDA_TOTAL:1,OTR_COSTO_TOTAL:0,SAMT_CSC_CENTRO_COSTOS:null,AUDITORIA_USU_ALTA:n.EMPLEADO_CSC_EMPLEADO,AUDITORIA_USU_ULT_MOD:n.EMPLEADO_CSC_EMPLEADO,AUDITORIA_FEC_ALTA:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),AUDITORIA_FEC_ULT_MOD:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),
OTR_FECHA_ALTA_CORTA:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),OTR_FECHA_ALTA_HORA_COMPLETA:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),CLIENTE_CSC:n.CLIENTE_CSC,PM_CSC_PROYECTO:n.PM_CSC_PROYECTO,CAM_CSC_SERVICIO:n.CAM_CSC_SERVICIO}};__Reques_ajax(getJSON(DeveloperType).ApiOrdenTrabajo_v2.url+"Insert_Orden_Trabajo","POST",JSON.stringify(k),getJSON(DeveloperType).ApiOrdenTrabajo_v2.token).then(d=>
{1==d.success?(p.hide(),DevExpress.ui.notify("Ot insertada correctamente","success",4E3),a.Consulta_Ordenes_Trabajo({OTR_NEWID:c},!0)):p.hide();return d}).catch(function(d){p.hide();DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE","error",3E3)})}else p.hide(),DevExpress.ui.notify("No se localizo ninguna empleado","success",3E3)}).catch(function(k){console.log(k);p.hide();DevExpress.ui.notify("Error de de busqueda vueva a intentar nuevamente","error",3E3)})};a.Consulta_Ordenes_Trabajo=
function(e,g){var m={...ReturnDefaultData_Init()};e=Object.assign(m,e);p.show();__Reques_ajax(getJSON(DeveloperType).ApiOrdenTrabajo_v2.url+"Get_Orden_Trabajo","GET",e,getJSON(DeveloperType).ApiOrdenTrabajo_v2.token).then(k=>{1==k.success?(p.hide(),k=k.JsonData,1==g&&(k={EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),TIC_CSCTICKET:a.DataTicketOpen.TIC_CSCTICKET,OTR_CSCORDENTRABAJO:k[0].OTR_CSCORDENTRABAJO,AUDITORIA_USU_ALTA:n.EMPLEADO_CSC_EMPLEADO,AUDITORIA_USU_ULT_MOD:n.EMPLEADO_CSC_EMPLEADO,
AUDITORIA_FEC_ALTA:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),AUDITORIA_FEC_ULT_MOD:moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss")},a.Inserta_Interseccion_Ot_Ticket(k))):(p.hide(),DevExpress.ui.notify("No se localizo ninguna Ot","success",3E3))}).catch(function(k){console.log(k);p.hide();DevExpress.ui.notify("Error de de busqueda vueva a intentar nuevamente","error",3E3)})};a.Inserta_Interseccion_Ot_Ticket=function(e){e={...ReturnDefaultData_Init(),DATA_INSERT:e};
__Reques_ajax(getJSON(DeveloperType).ApiOrdenTrabajo_v2.url+"Insert_Inter_Ot_Ticket","POST",JSON.stringify(e),getJSON(DeveloperType).ApiOrdenTrabajo_v2.token).then(g=>{p.hide();return g}).catch(function(g){console.log(g);p.hide();DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE","error",3E3)})};a.Get_Autorizaciones_Ticket=function(e){a._Obj_Autorizaciones_Grid.clear();e={...ReturnDefaultData_Init(),AUTORIZACIONES_TIC_NEWID:e};__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+
"Get_Autoriza_Ticket","GET",e,getJSON(DeveloperType).ApiTickets_v2.token).then(g=>{1==g.success&&g.JsonData.forEach(function(m){a._Obj_Autorizaciones_Grid.insert(m)});a._DataGrid_Autorizacion.refresh()}).catch(function(g){DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE","error",3E3);a._DataGrid_Autorizacion.refresh()})};a.Get_Respuesta_Mensaje=function(e){$("#Dg_MensajesClienteOperador").length&&(e={...ReturnDefaultData_Init(),TIC_CSCTICKET:e},__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+
"Get_Respuesta_Mensaje","GET",e,getJSON(DeveloperType).ApiTickets_v2.token).then(g=>{1==g.success?$("#Dg_MensajesClienteOperador").dxDataGrid("instance").option("dataSource",g.JsonData):$("#Dg_MensajesClienteOperador").dxDataGrid("instance").option("dataSource",[])}).catch(function(g){DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE","error",3E3);$("#Dg_MensajesClienteOperador").dxDataGrid("instance").option("dataSource",[])}))};a.ActualizaRespuestaLectura=function(e,
g){var m={};"GENERA"==getUrlParam("TPO_USUARIO")?(m.RESPUESTA_LEIDO_CLIENTE=1,m.RESPUESTA_FEC_LEIDO_CLIENTE=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss")):(m.RESPUESTA_LEIDO_OPERADOR=1,m.RESPUESTA_FEC_LEIDO_OPERADOR=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"));e={...ReturnDefaultData_Init(),DATA_UPDATE:m,DATA_WHERE:{TIC_CSCTICKET:g,CSC_RESPUESTA:e,EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST")}};__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+
"Update_Respuesta_Mensaje","POST",JSON.stringify(e),getJSON(DeveloperType).ApiTickets_v2.token).then(k=>{1==k.success&&DevExpress.ui.notify("Respuesta actualizada","success",3E3)}).catch(function(k){DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE","error",3E3)})};a.CopiarClipboar=function(e){navigator.clipboard.writeText(e).then(()=>{DevExpress.ui.notify("Copiado correctamente","success",4E3)}).catch(()=>{DevExpress.ui.notify("Ticket insertado correctamente","danger",
4E3)})};a.ObtenClipboard=function(e,g){navigator.clipboard.readText().then(m=>{$("#"+e).dxForm("instance").getEditor(g).option("value",m)}).catch(m=>{})};a.BusquedaEmpleado=function(e,g){$("#Pop_Notificacion_Success").dxPopup("instance").option("height","450");$("#Pop_Notificacion_Success").dxPopup("instance").option("width","600");$("#Pop_Notificacion_Success").dxPopup("instance").option("contentTemplate",function(){return $("<div>").append($("<div class='popup-property-details'>").append($('<div class="Nice-Shadow-1" style="padding: 9px;">Buscar empleado</div>'),
$("<div style='margin: 9px;'/>").attr("id","DataGridEmpleadosBusqueda").dxDataGrid({headerFilter:{visible:!1},keyExpr:"EMPLEADO_CSC_EMPLEADO",dataSource:a._Obj_Empleados_Grid,selection:{mode:g},height:300,filterRow:{visible:!0,applyFilter:"auto"},scrolling:{useNative:!1,scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always"},groupPanel:{visible:!0},grouping:{autoExpandAll:!0},paging:{enabled:!1,pageIndex:0,pageSize:20},hoverStateEnabled:!0,showBorders:!0,showRowLines:!0,showColumnLines:!0,rowAlternationEnabled:!0,
columnAutoWidth:!1,columns:[{caption:"NO. DE EMPLEADO",dataField:"EMPLEADO_ID_EXTERNO",alignment:"left",width:120},{caption:"NOMBRE",dataField:"NOMBRE",sortOrder:"asc",alignment:"left"},{caption:"Proceso",dataField:"CAT_PROCESO_EMP_CSC",alignment:"left",groupIndex:0,lookup:{displayExpr:"CAT_PROCESO_EMP_IDIOMA1",valueExpr:"CAT_PROCESO_EMP_CSC",dataSource:{store:new DevExpress.data.CustomStore({load:async function(){try{return JSON.parse(sessionStorage.getItem("Cat_Proceso_Empleados"))}catch(c){console.log(c)}}})}}},
{dataField:"ACCIONES",type:"buttons",width:110,buttons:[{text:"Seleccionar",onClick(c){switch(e){case "Solicita":a.Frm_Ticket_Servicio_Instance.getEditor("TIC_SOLICITA").option("value",c.row.data.NOMBRE);a.Frm_Ticket_Servicio_Instance.getEditor("EMPLEADO_CSC_SOLICITA").option("value",c.row.data.EMPLEADO_CSC_EMPLEADO);a.Frm_Ticket_Servicio_Instance.getEditor("TIC_EMAIL_SOLICITANTE").option("value",c.row.data.EMPLEADO_EMAILLABORAL);a.Frm_Ticket_Servicio_Instance.getEditor("TIC_TELEFONO_SOLICITANTE").option("value",
c.row.data.EMPLEADO_TELEFONO1);$("#Pop_Notificacion_Success").dxPopup("hide");break;case "Atiende":a.Frm_Ticket_Servicio_Instance.getEditor("TIC_ATIENDE").option("value",c.row.data.NOMBRE);a.Frm_Ticket_Servicio_Instance.getEditor("EMPLEADO_CSC_ATIENDE").option("value",c.row.data.EMPLEADO_CSC_EMPLEADO);$("#Pop_Notificacion_Success").dxPopup("hide");break;case "AgregarParticipante":console.log(c.row.data)}}}]}]}),$('<div class="Nice-Shadow-1" style="margin: auto; margin-bottom: 10px;"/>').attr("id",
"btnAsgEmpleados").dxButton({stylingMode:"contained",text:"Agregar",icon:"add",type:"success",width:200,visible:!1,onClick(){let c=$("#DataGridEmpleadosBusqueda").dxDataGrid("instance").getSelectedRowsData(),d=null,f={},h=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss");0==c.length?DevExpress.ui.notify({message:"Seleccione al menos a un usuario",minWidth:150,type:"info",displayTime:8E3},{position:"bottom right",direction:"up-push"}):null!=a._DataGrid_Ticket_Participante.getDataSource()&&
(d=a._DataGrid_Ticket_Participante.getDataSource().items(),c.forEach(function(l){var q=a.Frm_Ticket_Servicio_Instance.getEditor("EMPLEADO_CSC_ATIENDE").option("value");let r=a.Frm_Ticket_Servicio_Instance.getEditor("EMPLEADO_CSC_SOLICITA").option("value");q==l.EMPLEADO_CSC_EMPLEADO||r==l.EMPLEADO_CSC_EMPLEADO?a.notificaPantalla("Informaci\u00f3n",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),`${l.NOMBRE}; ${Globalize.formatMessage("msjUserAtnSol")}`,400,130):(q=null,null==l.EMPLEADO_EMAILLABORAL||
""==l.EMPLEADO_EMAILLABORAL?null==l.SOLICITUD_EMPLEADO_EMAIL_PERSONAL||""==l.SOLICITUD_EMPLEADO_EMAIL_PERSONAL?a.notificaPantalla("Alerta",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),`${l.NOMBRE}; ${Globalize.formatMessage("msjEmail")}`,400,130):q=l.SOLICITUD_EMPLEADO_EMAIL_PERSONAL:q=l.EMPLEADO_EMAILLABORAL,void 0==(null==d?void 0:d.find(u=>u.EMPLEADO_CSC_EMPLEADO===l.EMPLEADO_CSC_EMPLEADO))?null!=q&&(f={...ReturnDefaultData_Init(),DATA_INSERT:{EMP_CSC_EMPRESA_HOST:ReturnDefaultData_Init().EMP_CSC_EMPRESA_HOST,
TIC_NEWID:a.Frm_Ticket_Servicio_Instance.option("formData").TIC_NEWID,EMPLEADO_CSC_EMPLEADO:l.EMPLEADO_CSC_EMPLEADO,TIPO_PARTICIPANTE_CSC:1,EMPLEADO_TELEFONO_NOTIFICA:l.EMPLEADO_CELULAR,EMPLEADO_EMAIL_NOTIFICA:q,AUDITORIA_USU_ALTA:n.EMPLEADO_CSC_EMPLEADO,AUDITORIA_USU_ULT_MOD:n.EMPLEADO_CSC_EMPLEADO,AUDITORIA_FEC_ALTA:h,AUDITORIA_FEC_ULT_MOD:h}},console.log(f)):a.notificaPantalla("Informaci\u00f3n",moment().tz(a.TimeZoneEmpleado).format(" DD/MM/YYYY HH:mm"),`${l.NOMBRE}; ${Globalize.formatMessage("msjUserListPart")}`,
400,130))}))}})))});$("#Pop_Notificacion_Success").dxPopup("show");p.show();a._Obj_Empleados_Grid.clear();let m={},k=null,b=null;"AsignaTicket"==e?($("#DataGridEmpleadosBusqueda").dxDataGrid("instance").columnOption("ACCIONES","visible",!1),$("#btnAsgEmpleados").dxButton("instance").option("visible",!0),m={...ReturnDefaultData_Init(),ESTATUS_PROCESO_EMP_CSC:ReturnProcSubProcEstatus().ESTATUS_PROCESO_EMP_CSC,EMPLEADO_CSC_EMPLEADO_PADRE:n.EMPLEADO_CSC_EMPLEADO},k="ApiRecursosHumanos",b="GetSupervisionEmpl"):
"Atiende"==e?(m={...ReturnDefaultData_Init(),...ReturnProcSubProcEstatus(),TPO_USUARIO:"EMP_ADMIN_MESA",CAM_MESA_CSC:a.Frm_Ticket_Servicio_Instance.getEditor("CAM_MESA_CSC").option("value")},k="ApiTickets_v2",b="Get_Mesa_Empleado"):"Solicita"==e?(m={...ReturnDefaultData_Init(),...ReturnProcSubProcEstatus(),TIPO_CONSULTA:"AVANZADO",INFO:"ALLEMP"},k="ApiRecursosHumanos",b="GetEmpleado"):"AgregarParticipante"==e&&($("#DataGridEmpleadosBusqueda").dxDataGrid("instance").columnOption("ACCIONES","visible",
!1),$("#btnAsgEmpleados").dxButton("instance").option("visible",!0),m={...ReturnDefaultData_Init(),...ReturnProcSubProcEstatus(),TPO_USUARIO:"EMP_ADMIN_MESA",CAM_MESA_CSC:a.Frm_Ticket_Servicio_Instance.getEditor("CAM_MESA_CSC").option("value")},k="ApiTickets_v2",b="Get_Mesa_Empleado");a.CargaEmpleadosBy(m,k,b)};a.CargaEmpleadosBy=(e,g,m)=>{__Reques_ajax(getJSON(DeveloperType)[g].url+m,"GET",e,getJSON(DeveloperType)[g].token).then(k=>{1==k.success&&k.JsonData.forEach(function(b){a._Obj_Empleados_Grid.insert(b)});
$("#DataGridEmpleadosBusqueda").dxDataGrid("instance").refresh();p.hide()}).catch(function(k){DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE","error",3E3);$("#DataGridEmpleadosBusqueda").dxDataGrid("instance").refresh();p.hide()})};a._InsertaEmpleadosTicket=()=>{var e=null,g=moment().tz(a.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),m=a.Frm_Ticket_Servicio_Instance.option("formData");null!=a.Dg_Empleados_Ticket.getDataSource()&&(e=a.Dg_Empleados_Ticket.getDataSource().items(),
0!=e.length&&(e=e.map(k=>{var b={};b.EMP_CSC_EMPRESA_HOST=localStorage.getItem("EMP_CSC_EMPRESA_HOST");b.EMPLEADO_CSC_EMPLEADO=k.EMPLEADO_CSC_EMPLEADO;b.AUDITORIA_FEC_ALTA=g;b.AUDITORIA_FEC_ULT_MOD=g;b.AUDITORIA_USU_ALTA=n.EMPLEADO_CSC_EMPLEADO;b.AUDITORIA_USU_ULT_MOD=n.EMPLEADO_CSC_EMPLEADO;b.TIC_NEWID=m.TIC_NEWID;k={...ReturnDefaultData_Init(),DATA_INSERT:b};return a._EjecPromise(k)}),Promise.all(e).then(k=>{DevExpress.ui.notify({message:"Empleados asignados correctamente",minWidth:150,type:"info",
displayTime:5E3},{position:"bottom right",direction:"up-push"})}).catch(function(k){console.error("Ha ocurrido un error:",k)})))};a._EjecPromise=e=>new Promise((g,m)=>{try{__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Insert_Emp_Ticket","POST",JSON.stringify(e),getJSON(DeveloperType).ApiGeneral.token).then(k=>{g(k)})}catch(k){m(k)}});a.Get_Emp_Ticket=function(e){a._Obj_Agrega_Emp_Ticket.clear();e={...ReturnDefaultData_Init(),TIC_NEWID:e};__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+
"Get_Emp_Ticket","GET",e,getJSON(DeveloperType).ApiTickets_v2.token).then(g=>{1==g.success&&g.JsonData.forEach(function(m){a._Obj_Agrega_Emp_Ticket.insert(m)});a.Dg_Empleados_Ticket.refresh()}).catch(function(g){DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE","error",3E3);a.Dg_Empleados_Ticket.refresh()})};a.Get_Datos_Empleado_Solicita=function(e){e={...ReturnDefaultData_Init(),TIPO_CONSULTA:"AVANZADO",EMPLEADO_CSC_EMPLEADO:e};return __Reques_ajax(getJSON(DeveloperType).ApiRecursosHumanos.url+
"GetEmpleado","GET",e,getJSON(DeveloperType).ApiRecursosHumanos.token).then(g=>{if(1==g.success){let m=null;m=2<=g.JsonData.length?jslinq(g.JsonData).orderByDescending(function(k){return k.AUDITORIA_FEC_ALTA}).toList()[0]:g.JsonData[0];g=JSON.stringify(m);a.DatosEmpleadosGet=JSON.parse(g);a.Frm_Ticket_Empleado_Solita_Instance.updateData(a.DatosEmpleadosGet);a.ObtenSelectBoxFrm(a.Frm_Ticket_Empleado_Solita_Instance)}else a.DatosEmpleadosGet=null,a.Frm_Ticket_Empleado_Solita_Instance.updateData({}),
DevExpress.ui.notify({message:"No se localizo el empleado que realizo la solicitud",minWidth:150,type:"info",displayTime:5E3},{position:"bottom right",direction:"up-push"})}).catch(function(g){console.log(g);DevExpress.ui.notify({message:"Error en comunicaci\u00f3n con servidores",minWidth:150,type:"error",displayTime:5E3},{position:"bottom right",direction:"up-push"})})};a.notificaPantalla=function(e="Notificaci\u00f3n",g="Aviso",m="",k=350,b=100){DevExpress.ui.notify({height:b,width:k,minWidth:300,
type:"default",displayTime:15E3,animation:{show:{type:"fade",duration:400,from:0,to:1},hide:{type:"fade",duration:40,to:0}},closeOnClick:!0,contentTemplate:c=>{c.append(`
                    <div class="toast-dna">
                        <div class="toast-header-dna">
                            <img src="../../../images/asistente_virtual/AsisVritual_Info.svg" class="rounded me-2" alt="...">
                            <strong class="me-auto-dna">${e}</strong>
                            <small class="text-muted-dna">${g}</small>
                            <img src="../../../images/Icons/CancelIcon.png" class="rounded2 me-2" alt="...">
                        </div>
                        <div class="toast-body-dna">${m}</div>
                    </div>`)}},{position:"bottom right",direction:"up-stack"})};a.convertirSegundosADHHMMSS=function(e){const g=Math.floor(e/36E3);e%=36E3;const m=Math.floor(e/3600);e%=3600;return{dias:g,horas:m,minutos:Math.floor(e/60),segundos:e%60}};a.Get_Inmuebles_Empleados=async function(){let e={...ReturnDefaultData_Init(),USU_CSC_USUARIO:w.USU_CSC_USUARIO};try{let g=await __Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Get_Requisicion_Empleados_Inmuebles","GET",e,getJSON(DeveloperType).ApiTickets_v2.token);
if(1==g.success){let m=(Array.isArray(g.JsonData)?g.JsonData:[]).map(k=>k.REQ_CSCREQUISICION).join(",");a.REQ_CSCREQUISICION_IN=m}else a.REQ_CSCREQUISICION_IN=""}catch(g){DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE","error",3E3),a.REQ_CSCREQUISICION_IN=""}return a.REQ_CSCREQUISICION_IN};a.Run=function(){const e=[{Tbl:"SAMT_TIPO_REQ_USO"},{Tbl:"SAMT_TIPO_TICKET_PARTICIPANTE"},{Tbl:"SAMT_CAT_EMPLEADO_AREA"},{Tbl:"SAMT_CAT_EMPLEADO_DEPARTAMENTO"},{Tbl:"SAMT_CAM_MESA_DE_AYUDA"},
{Tbl:"SAMT_ESTATUS_TICKET"},{Tbl:"SAMT_TIPO_PRIORIDAD_TICKET"},{Tbl:"SAMT_TIPO_TICKET"},{Tbl:"SAMT_CAM_TIPO_SERVICIO"},{Tbl:"SAMT_TIPO_SEVERIDAD"},{Tbl:"SAMT_CLIENTES"},{Tbl:"SAMT_PROYECTOS"},{Tbl:"SAMT_CAM_SERVICIO"},{Tbl:"SAMT_TIPO_CALIFICACION"},{Tbl:"SAMT_TIPO_PUESTO_EMPLEADO"},{Tbl:"SAMT_TIPO_RESPUESTA_AUTORIZA"},{Tbl:"SAMT_ESTATUS_ORDEN_TRABAJO"},{Tbl:"SAMT_CAM_TIPIFICACIONES"}];var g=sessionStorage.getItem("catsTickets");""==g||null==g?(g=e.map(m=>a.CargaCatalogosPromise(m,"Get_Cat_Full")),
Promise.all(g).then(m=>{a.CatalogosPantalla=m;a.armaCatalogosVista(e)}).catch(function(m){console.log("Ha ocurrido un error:",m)})):(a.CatalogosPantalla=JSON.parse(g),a.armaCatalogosVista(e))};a.CargaCatalogosPromise=(e,g)=>new Promise((m,k)=>{try{__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+g,"GET",e,getJSON(DeveloperType).ApiGeneral.token).then(b=>{!0===b.success&&(b.CatName=e.Tbl);m(b)})}catch(b){k(b)}});a.armaCatalogosVista=e=>{jslinq(ObtenCatalogoPantalla(a.CatalogosPantalla,e[0].Tbl)).toList().forEach(function(g){a._CMB_SAMT_TIPO_REQ_USO_OBJDATA.insert(g)});
jslinq(ObtenCatalogoPantalla(a.CatalogosPantalla,e[1].Tbl)).toList().forEach(function(g){a._CMB_SAMT_TIPO_TICKET_PARTICIPANTE_OBJDATA.insert(g)});jslinq(ObtenCatalogoPantalla(a.CatalogosPantalla,e[2].Tbl)).toList().forEach(function(g){a._CMB_SAMT_CAT_EMPLEADO_AREA_OBJDATA.insert(g)});jslinq(ObtenCatalogoPantalla(a.CatalogosPantalla,e[3].Tbl)).toList().forEach(function(g){a._CMB_SAMT_CAT_EMPLEADO_DEPARTAMENTO_OBJDATA.insert(g)});jslinq(ObtenCatalogoPantalla(a.CatalogosPantalla,e[4].Tbl)).toList().forEach(function(g){a._CMB_SAMT_CAM_MESA_DE_AYUDA_OBJDATA.insert(g)});
jslinq(ObtenCatalogoPantalla(a.CatalogosPantalla,e[5].Tbl)).toList().forEach(function(g){a._CMB_SAMT_ESTATUS_TICKET_OBJDATA.insert(g)});jslinq(ObtenCatalogoPantalla(a.CatalogosPantalla,e[6].Tbl)).toList().forEach(function(g){a._CMB_SAMT_TIPO_PRIORIDAD_TICKET_OBJDATA.insert(g)});jslinq(ObtenCatalogoPantalla(a.CatalogosPantalla,e[7].Tbl)).toList().forEach(function(g){a._CMB_SAMT_TIPO_TICKET_OBJDATA.insert(g)});jslinq(ObtenCatalogoPantalla(a.CatalogosPantalla,e[8].Tbl)).toList().forEach(function(g){a._CMB_SAMT_CAM_TIPO_SERVICIO_OBJDATA.insert(g)});
jslinq(ObtenCatalogoPantalla(a.CatalogosPantalla,e[9].Tbl)).toList().forEach(function(g){a._CMB_SAMT_TIPO_SEVERIDAD_OBJDATA.insert(g)});jslinq(ObtenCatalogoPantalla(a.CatalogosPantalla,e[10].Tbl)).toList().forEach(function(g){a._CMB_SAMT_CLIENTES_OBJDATA.insert(g)});jslinq(ObtenCatalogoPantalla(a.CatalogosPantalla,e[11].Tbl)).toList().forEach(function(g){a._CMB_SAMT_PROYECTOS_OBJDATA.insert(g)});jslinq(ObtenCatalogoPantalla(a.CatalogosPantalla,e[12].Tbl)).toList().forEach(function(g){a._CMB_SAMT_CAM_SERVICIO_OBJDATA.insert(g)});
jslinq(ObtenCatalogoPantalla(a.CatalogosPantalla,e[13].Tbl)).toList().forEach(function(g){a._CMB_SAMT_TIPO_CALIFICACION_OBJDATA.insert(g)});jslinq(ObtenCatalogoPantalla(a.CatalogosPantalla,e[14].Tbl)).toList().forEach(function(g){a._CMB_SAMT_TIPO_PUESTO_EMPLEADO_OBJDATA.insert(g)});jslinq(ObtenCatalogoPantalla(a.CatalogosPantalla,e[15].Tbl)).toList().forEach(function(g){a._CMB_SAMT_TIPO_RESPUESTA_AUTORIZA_OBJDATA.insert(g)});jslinq(ObtenCatalogoPantalla(a.CatalogosPantalla,e[16].Tbl)).toList().forEach(function(g){a._CMB_SAMT_ESTATUS_ORDEN_TRABAJO_OBJDATA.insert(g)});
jslinq(ObtenCatalogoPantalla(a.CatalogosPantalla,e[17].Tbl)).toList().forEach(function(g){a._CMB_SAMT_CAM_TIPIFICACIONES_OBJDATA.insert(g)});setTimeout(()=>{try{sessionStorage.setItem("catsTickets",JSON.stringify(a.CatalogosPantalla))}catch(g){console.log(g)}a.init()},1E3)}};setTimeout(()=>{SalesDashboard.currentModel=new SalesDashboard.dashboardModel;SalesDashboard.currentModel.Run()},1E3);
