SalesDashboard.dashboardModel=function(){function r(f,a,b){n.show();let d={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),Type:localStorage.getItem("Type"),CAM_MESA_CSC:a};__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Get_Ensamble_Mesa_Ayuda","GET",d,getJSON(DeveloperType).ApiTickets_v2.token).then(e=>{if(1==e.success)if(e=e.JsonData[0],null==e.CAM_MESA_IFRAMEWEB)DevExpress.ui.notify("Error no se identifico mesa de ayuda",
"error",3E3);else{let g="TIPO="+f+"&CSC_MESA="+a+"&TK_ID="+b+"&TPO_USUARIO="+c.TipoUsuario,m="/"+c.patname.split("/")[1]+"/views/Vistas_Mesas_Ayuda/"+e.CAM_MESA_IFRAMEWEB+"/"+e.CAM_MESA_IFRAMEWEB+".html?"+g;$("#Pop_Mesa_Ayuda_Config").dxPopup("instance").option("contentTemplate",function(h){return $('<div style="height:100%;">').append("<iframe src="+m+' width="100%" height="100%" scrolling="auto" frameBorder="0" style=" flex-shrink: 1;flex-basis: auto;flex: 1; flex-grow: 1;"></iframe>')});$("#Pop_Mesa_Ayuda_Config").dxPopup("show");
n.hide()}else DevExpress.ui.notify("Error no se identifico mesa de ayuda","error",1E4)}).catch(function(e){DevExpress.ui.notify("Error mesa de ayuda no localizada intente nuevamnete","error",1E4)})}function p(f,a,b=null,d=[]){f=moment(f);var e=moment(a);if(!f.isValid()||!e.isValid())return"Fechas inv\u00e1lidas";a=new Set(d.map(h=>moment(h).format("YYYY-MM-DD")));d=0;if(f.isSame(e,"day"))6==f.isoWeekday()||7==f.isoWeekday()||a.has(f.format("YYYY-MM-DD"))||(d+=e.diff(f,"seconds"));else{6==f.isoWeekday()||
7==f.isoWeekday()||a.has(f.format("YYYY-MM-DD"))||(d+=f.clone().endOf("day").diff(f,"seconds"));6==e.isoWeekday()||7==e.isoWeekday()||a.has(e.format("YYYY-MM-DD"))||(d+=e.diff(e.clone().startOf("day"),"seconds"));e=e.diff(f,"days");for(var g=1;g<e;g++){var m=f.clone().add(g,"days");6==m.isoWeekday()||7==m.isoWeekday()||a.has(m.format("YYYY-MM-DD"))||(d+=86400)}}f=moment.duration(d,"seconds");return"VencimientoSemaforo"==b?d:("0"+f.days()).slice(-2)+" d "+("0"+f.hours()).slice(-2)+":"+("0"+f.minutes()).slice(-2)+
":"+("0"+f.seconds()).slice(-2)}let c=this,l=null;this.Nombre;this.Apellido;this.Estatus=null;let t=[],k=null;c.MisServiciosActivosTickets=[];c.FechaPromesaDefecto=86400;c.__Temp_Ult_Consulta={};let n=$("#loadPanel").dxLoadPanel({hideOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",showIndicator:!0,showPane:!0,shading:!0,visible:!0}).dxLoadPanel("instance");c.TipoUsuario="ADMIN";c.TimeZoneServidor=localStorage.getItem("tmzServidor");c.TimeZoneEmpleado=localStorage.getItem("tmzEmpleado");c.TiempoUTCEmpleado=
DiferencieTimeZones();c.__DataSource_Tickets_Grid_Admin=new DevExpress.data.ArrayStore({data:[]});c.__DataSource_Tipificaiones=new DevExpress.data.ArrayStore({data:[]});c._ClienteProyectoCampania_ObjData=new DevExpress.data.ArrayStore({data:[]});c.idServiciosUsuario={};c.init=function(){$("#splashscreen").fadeOut(1E3);Globalize.loadMessages(dictionary);var f=function(){let a=sessionStorage.getItem("locale");return null!=a?a:"es"}();Globalize.locale(f);DevExpress.localization.locale(f);$("#adm_title_ms").html(Globalize.formatMessage("adm_title_ms"));
$("#adm_title_grid").html(Globalize.formatMessage("adm_title_grid"));c.patname=window.location.pathname;l=JSON.parse(localStorage.getItem("obj_DatosEmpleado"));$("#Mod_Tab_Reporte_Sura").dxTabPanel({animationEnabled:!1,deferRendering:!1,repaintChangesOnly:!1,dataSource:[{title:"Grid General",template:"tab_gridGeneral",icon:"./images/Icons/Todos.png"}]});$("#treeTicketAdmin").dxTreeView({dataSource:[],height:"100%",showScrollbar:"always",dataStructure:"plain",selectionMode:"single",activeStateEnabled:!1,
hoverStateEnabled:!1,focusStateEnabled:!1,selectByClick:!1,searchEnabled:!1,expandEvent:"click",keyExpr:"ID",displayExpr:"DESCRIPCION",parentIdExpr:"Task_Parent_ID",autoExpandAll:!1,itemTemplate:function(a,b,d){b=document.createElement("span");b.className="menu_item "+a.ICON;d.append(b);b=document.createElement("span");b.className="item-text";b.innerText=a.DESCRIPCION;d.append(b)},onItemClick:function(a){c.__Temp_Ult_Consulta={};let b=a.itemData;k=c.MisServiciosActivosTickets.join(",");if(0==b.CAM_MESA_CSC)switch(b.CLAVE_ITEM){case "MTA_TODO":c.__Temp_Ult_Consulta.EMPLEADO_CSC_ATIENDE=
l.EMPLEADO_CSC_EMPLEADO;$("#Dialog_Busqueda_Fecha").dxPopup("show");break;case "MTA_NO_TK":c.__Temp_Ult_Consulta.EMPLEADO_CSC_ATIENDE=l.EMPLEADO_CSC_EMPLEADO;$("#Dialog_Busqueda_No_Ticket").dxPopup("show");break;case "MTA_ABIERTAS":c.__Temp_Ult_Consulta.EMPLEADO_CSC_ATIENDE=l.EMPLEADO_CSC_EMPLEADO;c.__Temp_Ult_Consulta.TIC_CERRADO=0;c.ConsultaTickets(c.__Temp_Ult_Consulta);break;case "MTA_CERRADAS":c.__Temp_Ult_Consulta.EMPLEADO_CSC_ATIENDE=l.EMPLEADO_CSC_EMPLEADO;c.__Temp_Ult_Consulta.TIC_CERRADO=
1;c.__Temp_Ult_Consulta.BYFC=!0;$("#Dialog_Busqueda_Fecha").dxPopup("show");break;case "MTC_TODO":c.__Temp_Ult_Consulta.EMPLEADO_CSC_SOLICITA=l.EMPLEADO_CSC_EMPLEADO;$("#Dialog_Busqueda_Fecha").dxPopup("show");break;case "MTC_NO_TK":c.__Temp_Ult_Consulta.EMPLEADO_CSC_SOLICITA=l.EMPLEADO_CSC_EMPLEADO;$("#Dialog_Busqueda_No_Ticket").dxPopup("show");break;case "MTC_ABIERTAS":c.__Temp_Ult_Consulta.EMPLEADO_CSC_SOLICITA=l.EMPLEADO_CSC_EMPLEADO;c.__Temp_Ult_Consulta.TIC_CERRADO=0;c.ConsultaTickets(c.__Temp_Ult_Consulta);
break;case "MTC_CERRADAS":c.__Temp_Ult_Consulta.EMPLEADO_CSC_SOLICITA=l.EMPLEADO_CSC_EMPLEADO;c.__Temp_Ult_Consulta.TIC_CERRADO=1;c.__Temp_Ult_Consulta.BYFC=!0;$("#Dialog_Busqueda_Fecha").dxPopup("show");break;case "MSA_ABIERTAS":if(""==k||null==k){DevExpress.ui.notify("No tiene niguna mesa de ayuda administrable","info",3E3);break}c.__Temp_Ult_Consulta.TIC_CERRADO=0;c.__Temp_Ult_Consulta.CAM_MESA_CSC_IN=k;c.ConsultaTickets(c.__Temp_Ult_Consulta);break;case "MSA_CERRADAS":if(""==k||null==k){DevExpress.ui.notify("No tiene niguna mesa de ayuda administrable",
"info",3E3);break}c.__Temp_Ult_Consulta.TIC_CERRADO=1;c.__Temp_Ult_Consulta.CAM_MESA_CSC_IN=k;c.__Temp_Ult_Consulta.BYFC=!0;$("#Dialog_Busqueda_Fecha").dxPopup("show");break;case "MSA_TODO":if(""==k||null==k){DevExpress.ui.notify("No tiene niguna mesa de ayuda administrable","info",3E3);break}c.__Temp_Ult_Consulta.CAM_MESA_CSC_IN=k;$("#Dialog_Busqueda_Fecha").dxPopup("show");break;case "MSA_NO_TK":""==k||null==k?DevExpress.ui.notify("No tiene niguna mesa de ayuda administrable","info",3E3):(c.__Temp_Ult_Consulta.CAM_MESA_CSC_IN=
k,$("#Dialog_Busqueda_No_Ticket").dxPopup("show"))}else if(0!=b.CAM_MESA_CSC)switch(c.__Temp_Ult_Consulta={},a=a.itemData,a.CLAVE_ITEM){case "TODAS":c.__Temp_Ult_Consulta.CAM_MESA_CSC=a.CAM_MESA_CSC;$("#Dialog_Busqueda_Fecha").dxPopup("show");break;case "ABIERTAS":c.__Temp_Ult_Consulta.TIC_CERRADO=0;c.__Temp_Ult_Consulta.CAM_MESA_CSC=a.CAM_MESA_CSC;c.ConsultaTickets(c.__Temp_Ult_Consulta);break;case "CERRADAS":c.__Temp_Ult_Consulta.TIC_CERRADO=1;c.__Temp_Ult_Consulta.CAM_MESA_CSC=a.CAM_MESA_CSC;c.__Temp_Ult_Consulta.BYFC=
!0;$("#Dialog_Busqueda_Fecha").dxPopup("show");break;case "ESTATUS":c.__Temp_Ult_Consulta.CAM_MESA_CSC=a.CAM_MESA_CSC;c.__Temp_Ult_Consulta.ESTATUS_CSC=a.ESTATUS_CSC;$("#Dialog_Busqueda_Fecha").dxPopup("show");break;case "ITEMSEVERIDAD":c.__Temp_Ult_Consulta.CAM_MESA_CSC=a.CAM_MESA_CSC;c.__Temp_Ult_Consulta.SEVERIDAD_CSC=a.SEVERIDAD_CSC;$("#Dialog_Busqueda_Fecha").dxPopup("show");break;case "ITEMPRIORIDAD":c.__Temp_Ult_Consulta.CAM_MESA_CSC=a.CAM_MESA_CSC,c.__Temp_Ult_Consulta.PRIORIDAD_CSC=a.PRIORIDAD_CSC,
$("#Dialog_Busqueda_Fecha").dxPopup("show")}}});$("#Pop_Mesa_Ayuda_Config").dxPopup({hideOnOutsideClick:!1,title:"Detalles",height:"90%",width:"70%",position:{my:"center",at:"center",of:window},onHiding:function(a){a.component.content().empty();c.ConsultaTickets(c.__Temp_Ult_Consulta)},onShowing:function(a){},onShown:function(a){}});c.DataGridTicketsAdmin=$("#Data_Grid_Ticket_Admin").dxDataGrid({dataSource:c.__DataSource_Tickets_Grid_Admin,deferRendering:!0,allowColumnResizing:!0,height:"100%",filterRow:{visible:!1},
filterPanel:{visible:!0},headerFilter:{visible:!0},keyExpr:"TIC_CSCTICKET",remoteOperations:!1,searchPanel:{visible:!1,highlightCaseSensitive:!0},selection:{mode:"single"},scrolling:{mode:"virtual",showScrollbar:"always",useNative:!0},groupPanel:{visible:!0},grouping:{autoExpandAll:!0},paging:{enabled:!1,pageIndex:0,pageSize:20},showBorders:!0,showRowLines:!1,showColumnLines:!0,rowAlternationEnabled:!0,columnAutoWidth:!0,export:{enabled:!0},onExporting:function(a){let b=new ExcelJS.Workbook,d=b.addWorksheet("Hoja1");
DevExpress.excelExporter.exportDataGrid({worksheet:d,component:a.component,customizeCell:function(e){e.font={name:"Arial",size:12};e.alignment={horizontal:"left"}}}).then(function(){b.xlsx.writeBuffer().then(function(e){saveAs(new Blob([e],{type:"application/octet-stream"}),"Solicitudes_"+moment().tz(c.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss")+".xlsx")})});a.cancel=!0},columns:[{caption:"TICKET",dataField:"TIC_CSCTICKET",fixed:!0,fixedPosition:"left",alignment:"center",sortOrder:"desc",width:130},
{caption:"FOLIO PROVEEDOR",dataField:"TIC_ID_EXTERNO_PROVEEDOR",fixed:!0,fixedPosition:"left",alignment:"center",width:180},{caption:"PAUSADO",dataField:"TIC_ESTATUS_SLA_ENUM",alignment:"left",calculateCellValue:function(a){if(1==a.TIC_CERRADO)return"Cerrado";if("open"==a.TIC_ESTATUS_SLA_ENUM)return"No";if("pause"==a.TIC_ESTATUS_SLA_ENUM)return"Si"}},{caption:"MESA DE AYUDA",dataField:"CAM_MESA_CSC",alignment:"left",lookup:{displayExpr:"CAM_MESA_IDIOMA1",valueExpr:"CAM_MESA_CSC",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",
paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_CAM_MESA_DE_AYUDA"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return a.JsonData;console.log(a.message)})}catch(a){console.log(a)}}})}}},{caption:"ESTATUS",dataField:"ESTATUS_TICKET_CSC",alignment:"left",width:130,lookup:{displayExpr:"ESTATUS_TICKET_IDIOMA1",valueExpr:"ESTATUS_TICKET_CSC",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",
paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_ESTATUS_TICKET"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return a.JsonData;console.log(a.message)})}catch(a){console.log(a)}}})}}},{caption:"CATEGORIA",dataField:"TIPIFICA_CSC_PARENT_PARENT",alignment:"left",width:130,lookup:{displayExpr:"TIPIFICA_IDIOMA1",valueExpr:"TIPIFICA_CSC",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",
paginate:!1,load:async function(){try{let a={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),Type:localStorage.getItem("Type"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST")};return __Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Get_Simple_Tipificaciones","GET",a,getJSON(DeveloperType).ApiTickets_v2.token).then(b=>{if(1==b.success)return b.JsonData.forEach(function(d){c.__DataSource_Tipificaiones.insert(d)}),b.JsonData;console.log(b.message)})}catch(a){console.log(a)}}})}}},
{caption:"CATEGORIA NIVEL 2",dataField:"TIPIFICA_CSC_PARENT",alignment:"left",width:130,lookup:{displayExpr:"TIPIFICA_IDIOMA1",valueExpr:"TIPIFICA_CSC",dataSource:c.__DataSource_Tipificaiones}},{caption:"CATEGORIA NIVEL 3",dataField:"TIPIFICA_CSC",alignment:"left",lookup:{displayExpr:"TIPIFICA_IDIOMA1",valueExpr:"TIPIFICA_CSC",dataSource:c.__DataSource_Tipificaiones}},{caption:"PRIORIDAD",dataField:"TIPO_PRIORIDAD_CSC",alignment:"left",width:130,lookup:{displayExpr:"TIPO_PRIORIDAD_IDIOMA1",valueExpr:"TIPO_PRIORIDAD_CSC",
dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_TIPO_PRIORIDAD_TICKET"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return a.JsonData;console.log(a.message)})}catch(a){console.log(a)}}})}}},{caption:"SOLICITA",dataField:"TIC_SOLICITA",alignment:"left",width:130},{caption:"VPN",dataField:"TIC_CODIGO_VPN",alignment:"left",width:90},
{caption:"UBICACION/ADUANA/ALMACEN:",dataField:"REQ_CSCREQUISICION",alignment:"left",width:130,lookup:{displayExpr:"REQUISICION_PROVEEDORES_NOMBRE",valueExpr:"SAMT_REQUISICION_PROVEEDORES_CSC",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_REQUISICION_PROVEEDORES"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return a.JsonData;console.log(a.message)})}catch(a){console.log(a)}}})}}},
{caption:"RUTA",dataField:"TIC_SEGMENTACION_INM_DES",alignment:"left",width:130},{caption:"CLIENTE",dataField:"CLIENTE_CSC_SOLICITA",alignment:"left",width:130,lookup:{displayExpr:"CLIENTE_NOMBRE",valueExpr:"CLIENTE_CSC",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_CLIENTES"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return a.JsonData;
console.log(a.message)})}catch(a){console.log(a)}}})}}},{caption:"SERVICIO",dataField:"PM_CSC_PROYECTO_SOLICITA",alignment:"left",width:130,lookup:{displayExpr:"PM_NOMBRE",valueExpr:"PM_CSC_PROYECTO",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_PROYECTOS"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return a.JsonData;console.log(a.message)})}catch(a){console.log(a)}}})}}},
{caption:"PROVEEDOR",dataField:"CAM_CSC_SERVICIO_SOLICITA",alignment:"left",width:130,lookup:{displayExpr:"CAM_SERVICIO_NOMBRE",valueExpr:"CAM_CSC_SERVICIO",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_CAM_SERVICIO"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return a.JsonData;console.log(a.message)})}catch(a){console.log(a)}}})}}},
{caption:"FECHA ALTA",dataField:"fecha_alta_timezone",alignment:"center",dataType:"datetime",format:"dd/MM/yyyy HH:mm:ss",width:130},{caption:"FECHA CIERRE",dataField:"fecha_cierre_timezone",alignment:"center",dataType:"datetime",format:"dd/MM/yyyy HH:mm:ss",width:150},{caption:"SLA ATENCION",width:150,alignment:"center",calculateCellValue:function(a){if(0==a.TIC_TIEMPO_RECEPCION)return a=moment.duration(c.FechaPromesaDefecto,"seconds"),0==a._isValid?"Sin Gestionar":("0"+a.days()).slice(-2)+"d "+
("0"+a.hours()).slice(-2)+":"+("0"+a.minutes()).slice(-2)+":"+("0"+a.seconds()).slice(-2);a=moment.duration(a.TIC_TIEMPO_RECEPCION,"seconds");return 0==a._isValid?"Sin Gestionar":("0"+a.days()).slice(-2)+"d "+("0"+a.hours()).slice(-2)+":"+("0"+a.minutes()).slice(-2)+":"+("0"+a.seconds()).slice(-2)}},{caption:"TIEMPO ATENCION",dataField:"TIC_DURACION_RECEPCION",alignment:"center",width:160,calculateCellValue:function(a){var b=a.TIC_DURACION_RECEPCION,d=moment.duration(b,"seconds");if(0==b)return d=
moment().tz(c.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),b=moment(a.TIC_FECHA_ALTA),d=moment(d).diff(b,"miliseconds"),d=moment.duration(d),0==d._isValid?"Sin Gestionar":24==a.CAM_CSC_SERVICIO_SOLICITA?("0"+d.days()).slice(-2)+" d "+("0"+d.hours()).slice(-2)+":"+("0"+d.minutes()).slice(-2)+":00":("0"+d.days()).slice(-2)+" d "+("0"+d.hours()).slice(-2)+":"+("0"+d.minutes()).slice(-2)+":"+("0"+d.seconds()).slice(-2);b=d.days();let e=d.hours(),g=d.minutes();d=d.seconds();return 24==a.CAM_CSC_SERVICIO_SOLICITA?
b+"d "+("0"+e).slice(-2)+":"+("0"+g).slice(-2)+":00":b+"d "+("0"+e).slice(-2)+":"+("0"+g).slice(-2)+":"+("0"+d).slice(-2)}},{caption:"T. PENALIZACION ATN",dataField:"TIEMPO_PENAL_ATN_2",alignment:"center",width:170,calculateCellValue:function(a){var b=a.TIC_DURACION_RECEPCION-a.TIC_TIEMPO_RECEPCION;if(0>b)return"00:00:00";moment.duration(b,"seconds");var d=Math.floor(b/86400),e=Math.floor(b%86400/3600),g=Math.floor(b%3600/60);b%=60;return 24==a.CAM_CSC_SERVICIO_SOLICITA?("0"+d).slice(-2)+"d "+("0"+
e).slice(-2)+":"+("0"+g).slice(-2)+":00":("0"+d).slice(-2)+"d "+("0"+e).slice(-2)+":"+("0"+g).slice(-2)+":"+("0"+b).slice(-2)}},{caption:"SLA EJECUCION",width:150,alignment:"center",calculateCellValue:function(a){if(0==a.TIC_TIEMPO_EJECUCION)return a=moment.duration(c.FechaPromesaDefecto,"seconds"),0==a._isValid?"Sin Gestionar":("0"+a.days()).slice(-2)+"d "+("0"+a.hours()).slice(-2)+":"+("0"+a.minutes()).slice(-2)+":"+("0"+a.seconds()).slice(-2);a=moment.duration(a.TIC_TIEMPO_EJECUCION,"seconds");
return 0==a._isValid?"Sin Gestionar":("0"+a.days()).slice(-2)+"d "+("0"+a.hours()).slice(-2)+":"+("0"+a.minutes()).slice(-2)+":"+("0"+a.seconds()).slice(-2)}},{caption:"CUMPLIMIENTO SLA (EJECUCION)",width:190,alignment:"center",cellTemplate:function(a,b){const d=$("<div>").text(b.value);"Vencido"==b.value?$("<div>").css("height","16px").css("width","16px").css("background-color","red").css("border-radius","50%").css("border","double 3px red").css("float","left").appendTo(a):$("<div>").css("height",
"16px").css("width","16px").css("background-color","#299A0B").css("border-radius","50%").css("border","double 3px #299A0B").css("float","left").appendTo(a);return d},calculateCellValue:function(a){var b=moment(a.fecha_alta_timezone).format("YYYY-MM-DD HH:mm:ss");const d=moment().tz(c.TimeZoneEmpleado).format("YYYY-MM-DD HH:mm:ss"),e=a.TIC_TIEMPO_EJECUCION;if(1==a.TIC_CERRADO)switch(a.CAM_CSC_SERVICIO_SOLICITA){case 38:return a=moment(a.fecha_cierre_timezone).format("YYYY-MM-DD HH:mm:ss"),a=p(b,a,
"VencimientoSemaforo",["2025-04-17","2025-04-18","2025-05-01"]),a>e?"Resuelto fuera de SLA":"Resuelto en tiempo";default:return b=a.TIC_FECHA_CIERRE,a=moment(a.TIC_FECHA_ALTA),a=moment(b).diff(a,"seconds"),0==e?a>c.FechaPromesaDefecto?"Resuelto fuera de SLA":"Resuelto en tiempo":a>e?"Resuelto fuera de SLA":"Resuelto en tiempo"}else switch(a.CAM_CSC_SERVICIO_SOLICITA){case 38:return a=p(b,d,"VencimientoSemaforo",["2025-04-17","2025-04-18"]),a>e?"Vencido":"En Tiempo";default:return b=moment().tz(c.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),
a=moment(a.TIC_FECHA_ALTA),moment(b).diff(a,"seconds")>e?"Vencido":"En Tiempo"}}},{caption:"TIEMPO EJECUCION",dataField:"TIEMPO_EJECUCION",alignment:"center",width:160,calculateCellValue:function(a){var b=moment(a.fecha_alta_timezone).format("YYYY-MM-DD HH:mm:ss");let d=moment().tz(c.TimeZoneEmpleado).format("YYYY-MM-DD HH:mm:ss");if(1==a.TIC_CERRADO)switch(a.CAM_CSC_SERVICIO_SOLICITA){case 38:return a=moment(a.fecha_cierre_timezone).format("YYYY-MM-DD HH:mm:ss"),p(b,a,null,["2025-04-17","2025-04-18"]);
default:return b=a.TIC_FECHA_CIERRE,a=moment(a.TIC_FECHA_ALTA),a=moment(b).diff(a,"miliseconds"),a=moment.duration(a),0==a._isValid?"Sin Gestionar":("0"+a.days()).slice(-2)+" d "+("0"+a.hours()).slice(-2)+":"+("0"+a.minutes()).slice(-2)+":"+("0"+a.seconds()).slice(-2)}else switch(a.CAM_CSC_SERVICIO_SOLICITA){case 38:return p(b,d,null,["2025-04-17","2025-04-18"]);default:return b=moment().tz(c.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss"),a=moment(a.TIC_FECHA_ALTA),a=moment(b).diff(a,"miliseconds"),
a=moment.duration(a),0==a._isValid?"Sin Gestionar":("0"+a.days()).slice(-2)+" d "+("0"+a.hours()).slice(-2)+":"+("0"+a.minutes()).slice(-2)+":"+("0"+a.seconds()).slice(-2)}}},{caption:"T. PENALIZACION (EJECUCION)",dataField:"TIEMPO_EJECUCION_2",alignment:"center",width:230,calculateCellValue:function(a){if(1==a.TIC_CERRADO)switch(a.CAM_CSC_SERVICIO_SOLICITA){case 38:var b=moment(a.fecha_alta_timezone).format("YYYY-MM-DD HH:mm:ss"),d=moment(a.fecha_cierre_timezone).format("YYYY-MM-DD HH:mm:ss"),e=
p(b,d,"VencimientoSemaforo",["2025-04-17","2025-04-18","2025-05-01"])-a.TIC_TIEMPO_EJECUCION;if(0>e)return"00:00:00";b=Math.floor(e/86400);d=Math.floor(e%86400/3600);var g=Math.floor(e%3600/60);e%=60;return 24==a.CAM_CSC_SERVICIO_SOLICITA?("0"+b).slice(-2)+"d "+("0"+d).slice(-2)+":"+("0"+g).slice(-2)+":00":("0"+b).slice(-2)+"d "+("0"+d).slice(-2)+":"+("0"+g).slice(-2)+":"+("0"+e).slice(-2);default:e=a.TIEMPO_EJECUCION-a.TIC_TIEMPO_EJECUCION;if(0>e)return"00:00:00";b=Math.floor(e/86400);d=Math.floor(e%
86400/3600);g=Math.floor(e%3600/60);e%=60;return 24==a.CAM_CSC_SERVICIO_SOLICITA?("0"+b).slice(-2)+"d "+("0"+d).slice(-2)+":"+("0"+g).slice(-2)+":00":("0"+b).slice(-2)+"d "+("0"+d).slice(-2)+":"+("0"+g).slice(-2)+":"+("0"+e).slice(-2)}else return"00:00:00"}},{caption:"T. TRANSCURRIDO",dataField:"TRANSCURRIDOS",alignment:"center",width:150,calculateCellValue:function(a){if(1==a.TIC_CERRADO){var b=a.TIC_FECHA_CIERRE,d=moment(a.TIC_FECHA_ALTA);b=moment(b).diff(d,"miliseconds");b=moment.duration(b);return 0==
b._isValid?"Sin Gestionar":24==a.CAM_CSC_SERVICIO_SOLICITA?("0"+b.days()).slice(-2)+" d "+("0"+b.hours()).slice(-2)+":"+("0"+b.minutes()).slice(-2)+":00":("0"+b.days()).slice(-2)+" d "+("0"+b.hours()).slice(-2)+":"+("0"+b.minutes()).slice(-2)+":"+("0"+b.seconds()).slice(-2)}b=moment().tz(c.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss");d=moment(a.TIC_FECHA_ALTA);b=moment(b).diff(d,"miliseconds");b=moment.duration(b);return 0==b._isValid?"Sin Gestionar":24==a.CAM_CSC_SERVICIO_SOLICITA?("0"+b.days()).slice(-2)+
" d "+("0"+b.hours()).slice(-2)+":"+("0"+b.minutes()).slice(-2)+":00":("0"+b.days()).slice(-2)+" d "+("0"+b.hours()).slice(-2)+":"+("0"+b.minutes()).slice(-2)+":"+("0"+b.seconds()).slice(-2)}},{caption:"ESTADO",width:170,alignment:"center",calculateCellValue:function(a){return 1==a.TIC_CERRADO?"CERRADO":null!=a.TIC_FECHA_CIERRE?"ESPERA DE CALIFICACI\u00d3N":"EN PROCESO"},cellTemplate:function(a,b){a=$("<div>").text(b.value);"VENCIDO"==b.value?a.css({color:"white","background-color":"red"}):"CERRADO"==
b.value?a.css({color:"black"}):a.css({color:"white","background-color":"green"});return a}},{caption:"ASIGNACION",width:160,alignment:"center",cellTemplate:function(a,b){const d=$("<div>").text(b.value);"ASIGNADO"==b.value?$("<div>").css("height","16px").css("width","16px").css("background-color","#23A521").css("border-radius","50%").css("border","double 3px #23A521").css("float","left").appendTo(a):$("<div>").css("height","16px").css("width","16px").css("background-color","#1E5799").css("border-radius",
"50%").css("border","double 3px #1E5799").css("float","left").appendTo(a);return d},calculateCellValue:function(a){return null==a.TIC_ATIENDE?"SIN ASIGNAR":"ASIGNADO"}}],summary:{totalItems:[{name:"Total",showInColumn:"TIC_CSCTICKET",displayFormat:"Total: {0}",summaryType:"count"}]},onRowDblClick:function(a){r("LECTURA",a.data.CAM_MESA_CSC,a.data.TIC_NEWID)}}).dxDataGrid("instance");$("#Dialog_Busqueda_Fecha").dxPopup({hideOnOutsideClick:!1,title:"PARAMETROS",height:function(){return 160},width:function(){return 400},
position:{my:"center",at:"center",of:window},onShowing:function(a){},contentTemplate:function(a){a.attr({style:"display: flex; flex-direction: column;"});a.append($("<div/>").append("Selecciona un rango de fechas.").attr({style:"font-size: 12px; margin-bottom: 5px; "}),$("<div/>").append("**Se recomienda realizar busquedas en bloques no mayores a 3 meses.").attr({style:"font-size: 10px; margin-bottom: 5px; color:red;"}),$("<div />").attr({id:"Form_Busqueda_Fecha",style:"border: solid red 0px; margin-bottom: 5px; "}).dxForm({readOnly:!1,
showColonAfterLabel:!0,showValidationSummary:!1,validationGroup:"Form_Busqueda_Fecha_Validation",labelMode:"static",labelLocation:"top",items:[{itemType:"group",colCount:2,items:[{dataField:"TIC_FECHA_INICIAL",label:{text:"Fecha Inicial"},editorType:"dxDateBox",editorOptions:{type:"date",disabled:!1,dateSerializationFormat:"yyyy-MM-dd",displayFormat:"dd/MM/yyyy",max:new Date},validationRules:[{type:"required",message:"Fecha requerida"}]},{dataField:"TIC_FECHA_FINAL",label:{text:"Fecha Final"},editorType:"dxDateBox",
editorOptions:{type:"date",disabled:!1,dateSerializationFormat:"yyyy-MM-dd",displayFormat:"dd/MM/yyyy",max:new Date},validationRules:[{type:"required",message:"Fecha requerida"}]},{itemType:"button",location:"before",locateInMenu:"auto",buttonOptions:{text:"Cancelar",icon:"remove",type:"danger",width:"100%",visible:!0,onInitialized:function(b){},onClick(){$("#Form_Busqueda_Fecha").dxForm("instance").resetValues();$("#Form_Busqueda_Fecha").dxForm("instance").option("formData",{});$("#Dialog_Busqueda_Fecha").dxPopup("hide")}}},
{itemType:"button",location:"before",locateInMenu:"auto",buttonOptions:{text:"Buscar",icon:"search",type:"default",width:"100%",visible:!0,onInitialized:function(b){},onClick(){var b=$("#Form_Busqueda_Fecha").dxForm("instance");b.validate().isValid?(b=b.option("formData"),c.__Temp_Ult_Consulta.TIC_FECHA_INICIAL=b.TIC_FECHA_INICIAL+" 00:00:00",c.__Temp_Ult_Consulta.TIC_FECHA_FINAL=b.TIC_FECHA_FINAL+" 23:59:59",c.ConsultaTickets(c.__Temp_Ult_Consulta),$("#Dialog_Busqueda_Fecha").dxPopup("hide")):DevExpress.ui.notify("LLENE LOS CAMPOS EN ROJO",
"error",300)}}}]}]}))}});$("#Dialog_Busqueda_No_Ticket").dxPopup({hideOnOutsideClick:!1,title:"BUSQUEDA DE TICKET",height:function(){return 120},width:function(){return 400},position:{my:"center",at:"center",of:window},onShowing:function(a){},contentTemplate:function(a){a.attr({style:"display: flex; flex-direction: column;"});a.append($("<div />").attr({id:"Form_Busqueda_No_Ticket",style:"border: solid red 0px; margin-bottom: 5px; "}).dxForm({readOnly:!1,showColonAfterLabel:!0,showValidationSummary:!1,
validationGroup:"Form_Busqueda_No_Ticket_Validation",labelMode:"static",labelLocation:"top",items:[{itemType:"group",colCount:2,items:[{colSpan:2,editorType:"dxNumberBox",dataField:"TIC_CSCTICKET",label:{text:"No. Ticket"},editorOptions:{disabled:!1},validationRules:[{type:"required",message:"Fecha requerida"}]},{itemType:"button",location:"before",locateInMenu:"auto",buttonOptions:{text:"Cancelar",icon:"remove",type:"danger",width:"100%",visible:!0,onInitialized:function(b){},onClick(){$("#Form_Busqueda_No_Ticket").dxForm("instance").resetValues();
$("#Form_Busqueda_No_Ticket").dxForm("instance").option("formData",{});$("#Dialog_Busqueda_No_Ticket").dxPopup("hide")}}},{itemType:"button",location:"before",locateInMenu:"auto",buttonOptions:{text:"Buscar",icon:"search",type:"default",width:"100%",visible:!0,onInitialized:function(b){},onClick(){var b=$("#Form_Busqueda_No_Ticket").dxForm("instance");b.validate().isValid?(b=b.option("formData"),c.__Temp_Ult_Consulta.TIC_CSCTICKET=b.TIC_CSCTICKET,c.ConsultaTickets(c.__Temp_Ult_Consulta),$("#Dialog_Busqueda_No_Ticket").dxPopup("hide")):
DevExpress.ui.notify("LLENE LOS CAMPOS EN ROJO","error",300)}}}]}]}))}});f={Tbl:"SAMT_CAM_SERVICIO",WHR:" EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")+" "};__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr","GET",f,getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success){a=a.JsonData;for(let b=0;b<a.length;b++)t.push(a[b].CAM_MESA_CSC)}});c.cargaArbolTicket()};c.cargaArbolTicket=function(){let f=[],a=18,b={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),
EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),Type:localStorage.getItem("Type"),EMPLEADO_CSC_EMPLEADO:l.EMPLEADO_CSC_EMPLEADO,TPO_USUARIO:c.TipoUsuario};__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Get_Mesa_Empleado","GET",b,getJSON(DeveloperType).ApiTickets_v2.token).then(d=>{if(1==d.success){let e=d.JsonData;d={Tbl:"SAMT_ESTATUS_TICKET",WHR:"EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")};__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+
"Get_Cat_Whr","GET",d,getJSON(DeveloperType).ApiGeneral.token).then(g=>{1==g.success&&(g={Tbl:"SAMT_TIPO_SEVERIDAD",WHR:"EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")+" AND TIPO_SEVERIDAD_TICKET_ACTIVO = 1 "},__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr","GET",g,getJSON(DeveloperType).ApiGeneral.token).then(m=>{1==m.success&&(m={Tbl:"SAMT_TIPO_PRIORIDAD_TICKET",WHR:"EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")+" AND TIPO_PRIORIDAD_ACTIVO = 1 "},
__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr","GET",m,getJSON(DeveloperType).ApiGeneral.token).then(h=>{if(1==h.success){for(h=0;h<e.length;h++){c.MisServiciosActivosTickets.push(e[h].CAM_MESA_CSC);let q=parseInt(a+"");f.push({ID:q,CLAVE_ITEM:"SERVICIO",CAM_MESA_CSC:e[h].CAM_MESA_CSC,DESCRIPCION:e[h].CAM_MESA_IDIOMA1,Task_Parent_ID:0,ICON:"SERVICIO"});a++;f.push({ID:a,CLAVE_ITEM:"TODAS",DESCRIPCION:"Todas",CAM_MESA_CSC:e[h].CAM_MESA_CSC,Task_Parent_ID:q,ICON:"TODAS"});a++;f.push({ID:a,
CLAVE_ITEM:"ABIERTAS",DESCRIPCION:"Abiertas",CAM_MESA_CSC:e[h].CAM_MESA_CSC,Task_Parent_ID:q,ICON:"ABIERTAS"});a++;f.push({ID:a,CLAVE_ITEM:"CERRADAS",DESCRIPCION:"Cerradas",CAM_MESA_CSC:e[h].CAM_MESA_CSC,Task_Parent_ID:q,ICON:"CERRADAS"});a++;parseInt(a+"");a++}$("#treeTicketAdmin").dxTreeView("instance").option("dataSource",f);n.hide()}}))}))})}else $("#treeTicketAdmin").dxTreeView("instance").option("dataSource",f),n.hide()});n.hide()};c.ConsultaTickets=function(f){c.__DataSource_Tickets_Grid_Admin.clear();
let a={...ReturnDefaultData_Init()};f=Object.assign(a,f,{CAM_CSC_SERVICIO_SOLICITA_IN:c.idServiciosUsuario,TIC_REQ_AUTORIZACION:0});n.show();__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Get_Ticket_Servicio","GET",f,getJSON(DeveloperType).ApiTickets_v2.token).then(b=>{1==b.success?b.JsonData.forEach(function(d){c.__DataSource_Tickets_Grid_Admin.insert(d)}):c.__DataSource_Tickets_Grid_Admin.clear();c.DataGridTicketsAdmin.refresh();n.hide()}).catch(function(b){c.__DataSource_Tickets_Grid_Admin.clear();
c.DataGridTicketsAdmin.refresh();n.hide();DevExpress.ui.notify("Eror de de busqueda vueva a intentar nuevamente","error",3E3)})};c.run=function(){c.getPermisosEmpleadoServicios()};c.getPermisosEmpleadoServicios=async function(){var f=JSON.parse(localStorage.getItem("obj_DatosEmpleado"));f={...ReturnDefaultData_Init(),EMPLEADO_CSC_EMPLEADO:f.EMPLEADO_CSC_EMPLEADO};try{let b=await __Reques_ajax(getJSON(DeveloperType).ApiGeneral.url+"getTreeCliProyCamp","GET",f,getJSON(DeveloperType).ApiGeneral.token);
if(1==b.success){jslinq(b.JsonData).toList().forEach(function(d){c._ClienteProyectoCampania_ObjData.insert(d)});var a=jslinq(b.JsonData).select(function(d){return d.CAM_CSC_SERVICIO}).toList();c.idServiciosUsuario=a.join(",");c.init()}}catch(b){DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE","error",3E3)}return!0};c.convertirSegundosADHHMMSS=function(f){const a=Math.floor(f/36E3);f%=36E3;const b=Math.floor(f/3600);f%=3600;const d=Math.floor(f/60);f%=60;return("0"+a).slice(-2)+
"d "+("0"+b).slice(-2)+":"+("0"+d).slice(-2)+":"+("0"+f).slice(-2)}};setTimeout(()=>{SalesDashboard.currentModel=new SalesDashboard.dashboardModel;SalesDashboard.currentModel.run()},1E3);
