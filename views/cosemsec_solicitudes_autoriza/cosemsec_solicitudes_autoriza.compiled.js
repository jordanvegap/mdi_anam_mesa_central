SalesDashboard.dashboardModel=function(){function p(e,a,c){l.show();let d={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),Type:localStorage.getItem("Type"),CAM_MESA_CSC:a};__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Get_Ensamble_Mesa_Ayuda","GET",d,getJSON(DeveloperType).ApiTickets_v2.token).then(f=>{if(1==f.success)if(f=f.JsonData[0],null==f.CAM_MESA_IFRAMEWEB)DevExpress.ui.notify("Error no se identifico mesa de ayuda",
"error",3E3);else{let m="TIPO="+e+"&CSC_MESA="+a+"&TK_ID="+c+"&TPO_USUARIO="+b.TipoUsuario+"&AUTORIZADOR=true",n="/"+b.patname.split("/")[1]+"/views/Vistas_Mesas_Ayuda/"+f.CAM_MESA_IFRAMEWEB+"/"+f.CAM_MESA_IFRAMEWEB+".html?"+m;$("#Pop_Mesa_Ayuda_Config").dxPopup("instance").option("contentTemplate",function(k){return $('<div style="height:100%;">').append("<iframe src="+n+' width="100%" height="100%" scrolling="auto" frameBorder="0" style=" flex-shrink: 1;flex-basis: auto;flex: 1; flex-grow: 1;"></iframe>')});
$("#Pop_Mesa_Ayuda_Config").dxPopup("show");l.hide()}else DevExpress.ui.notify("Error no se identifico mesa de ayuda","error",1E4)}).catch(function(f){DevExpress.ui.notify("Error mesa de ayuda no localizada intente nuevamnete","error",1E4)})}let b=this,h=null;this.Nombre;this.Apellido;this.Estatus=null;let r=[],g=null;b.MisServiciosActivosTickets=[];b.FechaPromesaDefecto=86400;b.__Temp_Ult_Consulta={};let l=$("#loadPanel").dxLoadPanel({hideOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",showIndicator:!0,
showPane:!0,shading:!0,visible:!0}).dxLoadPanel("instance");b.TipoUsuario="ADMIN";b.TimeZoneServidor=localStorage.getItem("tmzServidor");b.TimeZoneEmpleado=localStorage.getItem("tmzEmpleado");b.TiempoUTCEmpleado=DiferencieTimeZones();b.__DataSource_Tickets_Grid_Admin=new DevExpress.data.ArrayStore({data:[]});b.__DataSource_Tipificaiones=new DevExpress.data.ArrayStore({data:[]});b._ClienteProyectoCampania_ObjData=new DevExpress.data.ArrayStore({data:[]});b.idServiciosUsuario={};b.init=function(){$("#splashscreen").fadeOut(1E3);
Globalize.loadMessages(dictionary);var e=function(){let a=sessionStorage.getItem("locale");return null!=a?a:"es"}();Globalize.locale(e);DevExpress.localization.locale(e);$("#adm_title_ms").html(Globalize.formatMessage("adm_title_ms"));$("#adm_title_grid").html(Globalize.formatMessage("adm_title_grid"));b.patname=window.location.pathname;h=JSON.parse(localStorage.getItem("obj_DatosEmpleado"));$("#Mod_Tab_Reporte_Sura").dxTabPanel({animationEnabled:!1,deferRendering:!1,repaintChangesOnly:!1,dataSource:[{title:"Grid General",
template:"tab_gridGeneral",icon:"./images/Icons/Todos.png"}]});$("#treeTicketAdmin").dxTreeView({dataSource:[],height:"100%",showScrollbar:"always",dataStructure:"plain",selectionMode:"single",activeStateEnabled:!1,hoverStateEnabled:!1,focusStateEnabled:!1,selectByClick:!1,searchEnabled:!1,expandEvent:"click",keyExpr:"ID",displayExpr:"DESCRIPCION",parentIdExpr:"Task_Parent_ID",autoExpandAll:!1,itemTemplate:function(a,c,d){c=document.createElement("span");c.className="menu_item "+a.ICON;d.append(c);
c=document.createElement("span");c.className="item-text";c.innerText=a.DESCRIPCION;d.append(c)},onItemClick:function(a){b.__Temp_Ult_Consulta={};let c=a.itemData;g=b.MisServiciosActivosTickets.join(",");if(0==c.CAM_MESA_CSC)switch(c.CLAVE_ITEM){case "MTA_TODO":b.__Temp_Ult_Consulta.EMPLEADO_CSC_ATIENDE=h.EMPLEADO_CSC_EMPLEADO;$("#Dialog_Busqueda_Fecha").dxPopup("show");break;case "MTA_NO_TK":b.__Temp_Ult_Consulta.EMPLEADO_CSC_ATIENDE=h.EMPLEADO_CSC_EMPLEADO;$("#Dialog_Busqueda_No_Ticket").dxPopup("show");
break;case "MTA_ABIERTAS":b.__Temp_Ult_Consulta.EMPLEADO_CSC_ATIENDE=h.EMPLEADO_CSC_EMPLEADO;b.__Temp_Ult_Consulta.TIC_CERRADO=0;b.ConsultaTickets(b.__Temp_Ult_Consulta);break;case "MTA_CERRADAS":b.__Temp_Ult_Consulta.EMPLEADO_CSC_ATIENDE=h.EMPLEADO_CSC_EMPLEADO;b.__Temp_Ult_Consulta.TIC_CERRADO=1;b.__Temp_Ult_Consulta.BYFC=!0;$("#Dialog_Busqueda_Fecha").dxPopup("show");break;case "MTC_TODO":b.__Temp_Ult_Consulta.EMPLEADO_CSC_SOLICITA=h.EMPLEADO_CSC_EMPLEADO;$("#Dialog_Busqueda_Fecha").dxPopup("show");
break;case "MTC_NO_TK":b.__Temp_Ult_Consulta.EMPLEADO_CSC_SOLICITA=h.EMPLEADO_CSC_EMPLEADO;$("#Dialog_Busqueda_No_Ticket").dxPopup("show");break;case "MTC_ABIERTAS":b.__Temp_Ult_Consulta.EMPLEADO_CSC_SOLICITA=h.EMPLEADO_CSC_EMPLEADO;b.__Temp_Ult_Consulta.TIC_CERRADO=0;b.ConsultaTickets(b.__Temp_Ult_Consulta);break;case "MTC_CERRADAS":b.__Temp_Ult_Consulta.EMPLEADO_CSC_SOLICITA=h.EMPLEADO_CSC_EMPLEADO;b.__Temp_Ult_Consulta.TIC_CERRADO=1;b.__Temp_Ult_Consulta.BYFC=!0;$("#Dialog_Busqueda_Fecha").dxPopup("show");
break;case "MSA_ABIERTAS":if(""==g||null==g){DevExpress.ui.notify("No tiene niguna mesa de ayuda administrable","info",3E3);break}b.__Temp_Ult_Consulta.TIC_CERRADO=0;b.__Temp_Ult_Consulta.CAM_MESA_CSC_IN=g;b.ConsultaTickets(b.__Temp_Ult_Consulta);break;case "MSA_CERRADAS":if(""==g||null==g){DevExpress.ui.notify("No tiene niguna mesa de ayuda administrable","info",3E3);break}b.__Temp_Ult_Consulta.TIC_CERRADO=1;b.__Temp_Ult_Consulta.CAM_MESA_CSC_IN=g;b.__Temp_Ult_Consulta.BYFC=!0;$("#Dialog_Busqueda_Fecha").dxPopup("show");
break;case "MSA_TODO":if(""==g||null==g){DevExpress.ui.notify("No tiene niguna mesa de ayuda administrable","info",3E3);break}b.__Temp_Ult_Consulta.CAM_MESA_CSC_IN=g;$("#Dialog_Busqueda_Fecha").dxPopup("show");break;case "MSA_NO_TK":""==g||null==g?DevExpress.ui.notify("No tiene niguna mesa de ayuda administrable","info",3E3):(b.__Temp_Ult_Consulta.CAM_MESA_CSC_IN=g,$("#Dialog_Busqueda_No_Ticket").dxPopup("show"))}else if(0!=c.CAM_MESA_CSC)switch(b.__Temp_Ult_Consulta={},a=a.itemData,a.CLAVE_ITEM){case "ALTATICKET":null==
a.IFRAMEWEB?DevExpress.ui.notify("Error no se identifico mesa de ayuda","error",3E3):(b.__Temp_Ult_Consulta.TIC_CERRADO=0,b.__Temp_Ult_Consulta.CAM_MESA_CSC=a.CAM_MESA_CSC,p("ALTA",a.CAM_MESA_CSC,null));break;case "TODAS":b.__Temp_Ult_Consulta.CAM_MESA_CSC=a.CAM_MESA_CSC;$("#Dialog_Busqueda_Fecha").dxPopup("show");break;case "ABIERTAS":b.__Temp_Ult_Consulta.TIC_CERRADO=0;b.__Temp_Ult_Consulta.CAM_MESA_CSC=a.CAM_MESA_CSC;b.ConsultaTickets(b.__Temp_Ult_Consulta);break;case "CERRADAS":b.__Temp_Ult_Consulta.TIC_CERRADO=
1;b.__Temp_Ult_Consulta.CAM_MESA_CSC=a.CAM_MESA_CSC;b.__Temp_Ult_Consulta.BYFC=!0;$("#Dialog_Busqueda_Fecha").dxPopup("show");break;case "ESTATUS":b.__Temp_Ult_Consulta.CAM_MESA_CSC=a.CAM_MESA_CSC;b.__Temp_Ult_Consulta.ESTATUS_CSC=a.ESTATUS_CSC;$("#Dialog_Busqueda_Fecha").dxPopup("show");break;case "ITEMSEVERIDAD":b.__Temp_Ult_Consulta.CAM_MESA_CSC=a.CAM_MESA_CSC;b.__Temp_Ult_Consulta.SEVERIDAD_CSC=a.SEVERIDAD_CSC;$("#Dialog_Busqueda_Fecha").dxPopup("show");break;case "ITEMPRIORIDAD":b.__Temp_Ult_Consulta.CAM_MESA_CSC=
a.CAM_MESA_CSC,b.__Temp_Ult_Consulta.PRIORIDAD_CSC=a.PRIORIDAD_CSC,$("#Dialog_Busqueda_Fecha").dxPopup("show")}}});$("#Pop_Mesa_Ayuda_Config").dxPopup({hideOnOutsideClick:!1,title:"Detalles",height:"90%",width:"70%",position:{my:"center",at:"center",of:window},onHiding:function(a){a.component.content().empty();b.ConsultaTickets(b.__Temp_Ult_Consulta)},onShowing:function(a){},onShown:function(a){}});b.DataGridTicketsAdmin=$("#Data_Grid_Ticket_Admin").dxDataGrid({dataSource:b.__DataSource_Tickets_Grid_Admin,
deferRendering:!0,allowColumnResizing:!0,height:"100%",filterRow:{visible:!1},filterPanel:{visible:!0},headerFilter:{visible:!0},keyExpr:"TIC_CSCTICKET",remoteOperations:!1,searchPanel:{visible:!1,highlightCaseSensitive:!0},selection:{mode:"single"},scrolling:{mode:"virtual",showScrollbar:"always",useNative:!0},groupPanel:{visible:!0},grouping:{autoExpandAll:!0},paging:{enabled:!1,pageIndex:0,pageSize:20},showBorders:!0,showRowLines:!1,showColumnLines:!0,rowAlternationEnabled:!0,columnAutoWidth:!0,
export:{enabled:!0},onExporting:function(a){let c=new ExcelJS.Workbook,d=c.addWorksheet("Hoja1");DevExpress.excelExporter.exportDataGrid({worksheet:d,component:a.component,customizeCell:function(f){f.font={name:"Arial",size:12};f.alignment={horizontal:"left"}}}).then(function(){c.xlsx.writeBuffer().then(function(f){saveAs(new Blob([f],{type:"application/octet-stream"}),"Solicitudes_"+moment().tz(b.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss")+".xlsx")})});a.cancel=!0},columns:[{caption:"TICKET",
dataField:"TIC_CSCTICKET",fixed:!0,fixedPosition:"left",alignment:"center",sortOrder:"desc",width:130},{caption:"PAUSADO",dataField:"TIC_ESTATUS_SLA_ENUM",alignment:"left",calculateCellValue:function(a){if(1==a.TIC_CERRADO)return"Cerrado";if("open"==a.TIC_ESTATUS_SLA_ENUM)return"No";if("pause"==a.TIC_ESTATUS_SLA_ENUM)return"Si"}},{caption:"MESA DE AYUDA",dataField:"CAM_MESA_CSC",alignment:"left",lookup:{displayExpr:"CAM_MESA_IDIOMA1",valueExpr:"CAM_MESA_CSC",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",
paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_CAM_MESA_DE_AYUDA"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return a.JsonData;console.log(a.message)})}catch(a){console.log(a)}}})}}},{caption:"ESTATUS",dataField:"ESTATUS_TICKET_CSC",alignment:"left",width:130,lookup:{displayExpr:"ESTATUS_TICKET_IDIOMA1",valueExpr:"ESTATUS_TICKET_CSC",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",
paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_ESTATUS_TICKET"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return a.JsonData;console.log(a.message)})}catch(a){console.log(a)}}})}}},{caption:"CATEGORIA",dataField:"TIPIFICA_CSC_PARENT_PARENT",alignment:"left",width:130,lookup:{displayExpr:"TIPIFICA_IDIOMA1",valueExpr:"TIPIFICA_CSC",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",
paginate:!1,load:async function(){try{let a={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),Type:localStorage.getItem("Type"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST")};return __Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Get_Simple_Tipificaciones","GET",a,getJSON(DeveloperType).ApiTickets_v2.token).then(c=>{if(1==c.success)return c.JsonData.forEach(function(d){b.__DataSource_Tipificaiones.insert(d)}),c.JsonData;console.log(c.message)})}catch(a){console.log(a)}}})}}},
{caption:"CATEGORIA NIVEL 2",dataField:"TIPIFICA_CSC_PARENT",alignment:"left",width:130,lookup:{displayExpr:"TIPIFICA_IDIOMA1",valueExpr:"TIPIFICA_CSC",dataSource:b.__DataSource_Tipificaiones}},{caption:"CATEGORIA NIVEL 3",dataField:"TIPIFICA_CSC",alignment:"left",lookup:{displayExpr:"TIPIFICA_IDIOMA1",valueExpr:"TIPIFICA_CSC",dataSource:b.__DataSource_Tipificaiones}},{caption:"PRIORIDAD",dataField:"TIPO_PRIORIDAD_CSC",alignment:"left",width:130,lookup:{displayExpr:"TIPO_PRIORIDAD_IDIOMA1",valueExpr:"TIPO_PRIORIDAD_CSC",
dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_TIPO_PRIORIDAD_TICKET"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return a.JsonData;console.log(a.message)})}catch(a){console.log(a)}}})}}},{caption:"SOLICITA",dataField:"TIC_SOLICITA",alignment:"left",width:130},{caption:"ATIENDE",dataField:"TIC_ATIENDE",alignment:"left",width:130},
{caption:"UBICACION/ADUANA/ALMACEN:",dataField:"REQ_CSCREQUISICION",alignment:"left",width:130,lookup:{displayExpr:"REQUISICION_PROVEEDORES_NOMBRE",valueExpr:"SAMT_REQUISICION_PROVEEDORES_CSC",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_REQUISICION_PROVEEDORES"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return a.JsonData;console.log(a.message)})}catch(a){console.log(a)}}})}}},
{caption:"RUTA",dataField:"TIC_SEGMENTACION_INM_DES",alignment:"left",width:130},{caption:"CLIENTE",dataField:"CLIENTE_CSC_SOLICITA",alignment:"left",width:130,lookup:{displayExpr:"CLIENTE_NOMBRE",valueExpr:"CLIENTE_CSC",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_CLIENTES"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return a.JsonData;
console.log(a.message)})}catch(a){console.log(a)}}})}}},{caption:"SERVICIO",dataField:"PM_CSC_PROYECTO_SOLICITA",alignment:"left",width:130,lookup:{displayExpr:"PM_NOMBRE",valueExpr:"PM_CSC_PROYECTO",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_PROYECTOS"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return a.JsonData;console.log(a.message)})}catch(a){console.log(a)}}})}}},
{caption:"PROVEEDOR",dataField:"CAM_CSC_SERVICIO_SOLICITA",alignment:"left",width:130,lookup:{displayExpr:"CAM_SERVICIO_NOMBRE",valueExpr:"CAM_CSC_SERVICIO",dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_CAM_SERVICIO"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return a.JsonData;console.log(a.message)})}catch(a){console.log(a)}}})}}},
{caption:"FECHA ALTA",dataField:"fecha_alta_timezone",alignment:"center",dataType:"datetime",format:"dd/MM/yyyy HH:mm:ss",width:130},{caption:"FECHA CIERRE",dataField:"fecha_cierre_timezone",alignment:"center",dataType:"datetime",format:"dd/MM/yyyy HH:mm:ss",width:150},{caption:"SLA",width:150,alignment:"center",calculateCellValue:function(a){if(0==a.TIC_TIEMPO_EJECUCION)return a=moment.duration(b.FechaPromesaDefecto,"seconds"),0==a._isValid?"Sin Gestionar":("0"+a.days()).slice(-2)+"d "+("0"+a.hours()).slice(-2)+
":"+("0"+a.minutes()).slice(-2)+":"+("0"+a.seconds()).slice(-2);let c=moment.duration(a.TIC_TIEMPO_EJECUCION,"seconds");return 0==c._isValid?"Sin Gestionar":9==a.CAM_CSC_SERVICIO_SOLICITA?b.convertirSegundosADHHMMSS(a.TIC_TIEMPO_EJECUCION):("0"+c.days()).slice(-2)+"d "+("0"+c.hours()).slice(-2)+":"+("0"+c.minutes()).slice(-2)+":"+("0"+c.seconds()).slice(-2)}},{caption:"T. PENALIZACION",dataField:"TIEMPO_EJECUCION_2",alignment:"center",width:160,calculateCellValue:function(a){if(0==a.TIC_CERRADO)return"00:00:00";
var c=a.TIEMPO_EJECUCION-a.TIC_TIEMPO_EJECUCION;if(0>c)return"00:00:00";var d=moment.duration(c,"seconds");c=Math.floor(d.asHours());let f=d.minutes();d=d.seconds();return 24==a.CAM_CSC_SERVICIO_SOLICITA?("0"+c).slice(-2)+":"+("0"+f).slice(-2)+":00":("0"+c).slice(-2)+":"+("0"+f).slice(-2)+":"+("0"+d).slice(-2)}},{caption:"T. TRANSCURRIDO",dataField:"TRANSCURRIDOS",alignment:"center",width:150,calculateCellValue:function(a){if(1==a.TIC_CERRADO){var c=a.TIC_FECHA_CIERRE,d=moment(a.TIC_FECHA_ALTA);c=
moment(c).diff(d,"miliseconds");c=moment.duration(c);return 0==c._isValid?"Sin Gestionar":24==a.CAM_CSC_SERVICIO_SOLICITA?("0"+c.days()).slice(-2)+" d "+("0"+c.hours()).slice(-2)+":"+("0"+c.minutes()).slice(-2)+":00":("0"+c.days()).slice(-2)+" d "+("0"+c.hours()).slice(-2)+":"+("0"+c.minutes()).slice(-2)+":"+("0"+c.seconds()).slice(-2)}c=moment().tz(b.TimeZoneServidor).format("YYYY-MM-DD HH:mm:ss");d=moment(a.TIC_FECHA_ALTA);c=moment(c).diff(d,"miliseconds");c=moment.duration(c);return 0==c._isValid?
"Sin Gestionar":24==a.CAM_CSC_SERVICIO_SOLICITA?("0"+c.days()).slice(-2)+" d "+("0"+c.hours()).slice(-2)+":"+("0"+c.minutes()).slice(-2)+":00":("0"+c.days()).slice(-2)+" d "+("0"+c.hours()).slice(-2)+":"+("0"+c.minutes()).slice(-2)+":"+("0"+c.seconds()).slice(-2)}}],summary:{totalItems:[{name:"Total",showInColumn:"TIC_CSCTICKET",displayFormat:"Total: {0}",summaryType:"count"}]},onRowDblClick:function(a){p("EDITAR",a.data.CAM_MESA_CSC,a.data.TIC_NEWID)}}).dxDataGrid("instance");$("#Dialog_Busqueda_Fecha").dxPopup({hideOnOutsideClick:!1,
title:"PARAMETROS",height:function(){return 160},width:function(){return 400},position:{my:"center",at:"center",of:window},onShowing:function(a){},contentTemplate:function(a){a.attr({style:"display: flex; flex-direction: column;"});a.append($("<div/>").append("Selecciona un rango de fechas.").attr({style:"font-size: 12px; margin-bottom: 5px; "}),$("<div/>").append("**Se recomienda realizar busquedas en bloques no mayores a 3 meses.").attr({style:"font-size: 10px; margin-bottom: 5px; color:red;"}),
$("<div />").attr({id:"Form_Busqueda_Fecha",style:"border: solid red 0px; margin-bottom: 5px; "}).dxForm({readOnly:!1,showColonAfterLabel:!0,showValidationSummary:!1,validationGroup:"Form_Busqueda_Fecha_Validation",labelMode:"static",labelLocation:"top",items:[{itemType:"group",colCount:2,items:[{dataField:"TIC_FECHA_INICIAL",label:{text:"Fecha Inicial"},editorType:"dxDateBox",editorOptions:{type:"date",disabled:!1,dateSerializationFormat:"yyyy-MM-dd",displayFormat:"dd/MM/yyyy"},validationRules:[{type:"required",
message:"Fecha requerida"}]},{dataField:"TIC_FECHA_FINAL",label:{text:"Fecha Final"},editorType:"dxDateBox",editorOptions:{type:"date",disabled:!1,dateSerializationFormat:"yyyy-MM-dd",displayFormat:"dd/MM/yyyy"},validationRules:[{type:"required",message:"Fecha requerida"}]},{itemType:"button",location:"before",locateInMenu:"auto",buttonOptions:{text:"Cancelar",icon:"remove",type:"danger",width:"100%",visible:!0,onInitialized:function(c){},onClick(){$("#Form_Busqueda_Fecha").dxForm("instance").resetValues();
$("#Form_Busqueda_Fecha").dxForm("instance").option("formData",{});$("#Dialog_Busqueda_Fecha").dxPopup("hide")}}},{itemType:"button",location:"before",locateInMenu:"auto",buttonOptions:{text:"Buscar",icon:"search",type:"default",width:"100%",visible:!0,onInitialized:function(c){},onClick(){var c=$("#Form_Busqueda_Fecha").dxForm("instance");c.validate().isValid?(c=c.option("formData"),b.__Temp_Ult_Consulta.TIC_FECHA_INICIAL=c.TIC_FECHA_INICIAL+" 00:00:00",b.__Temp_Ult_Consulta.TIC_FECHA_FINAL=c.TIC_FECHA_FINAL+
" 23:59:59",b.ConsultaTickets(b.__Temp_Ult_Consulta),$("#Dialog_Busqueda_Fecha").dxPopup("hide")):DevExpress.ui.notify("LLENE LOS CAMPOS EN ROJO","error",300)}}}]}]}))}});$("#Dialog_Busqueda_No_Ticket").dxPopup({hideOnOutsideClick:!1,title:"BUSQUEDA DE TICKET",height:function(){return 120},width:function(){return 400},position:{my:"center",at:"center",of:window},onShowing:function(a){},contentTemplate:function(a){a.attr({style:"display: flex; flex-direction: column;"});a.append($("<div />").attr({id:"Form_Busqueda_No_Ticket",
style:"border: solid red 0px; margin-bottom: 5px; "}).dxForm({readOnly:!1,showColonAfterLabel:!0,showValidationSummary:!1,validationGroup:"Form_Busqueda_No_Ticket_Validation",labelMode:"static",labelLocation:"top",items:[{itemType:"group",colCount:2,items:[{colSpan:2,editorType:"dxNumberBox",dataField:"TIC_CSCTICKET",label:{text:"No. Ticket"},editorOptions:{disabled:!1},validationRules:[{type:"required",message:"Fecha requerida"}]},{itemType:"button",location:"before",locateInMenu:"auto",buttonOptions:{text:"Cancelar",
icon:"remove",type:"danger",width:"100%",visible:!0,onInitialized:function(c){},onClick(){$("#Form_Busqueda_No_Ticket").dxForm("instance").resetValues();$("#Form_Busqueda_No_Ticket").dxForm("instance").option("formData",{});$("#Dialog_Busqueda_No_Ticket").dxPopup("hide")}}},{itemType:"button",location:"before",locateInMenu:"auto",buttonOptions:{text:"Buscar",icon:"search",type:"default",width:"100%",visible:!0,onInitialized:function(c){},onClick(){var c=$("#Form_Busqueda_No_Ticket").dxForm("instance");
c.validate().isValid?(c=c.option("formData"),b.__Temp_Ult_Consulta.TIC_CSCTICKET=c.TIC_CSCTICKET,b.ConsultaTickets(b.__Temp_Ult_Consulta),$("#Dialog_Busqueda_No_Ticket").dxPopup("hide")):DevExpress.ui.notify("LLENE LOS CAMPOS EN ROJO","error",300)}}}]}]}))}});e={Tbl:"SAMT_CAM_SERVICIO",WHR:" EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")+" "};__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr","GET",e,getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success){a=
a.JsonData;for(let c=0;c<a.length;c++)r.push(a[c].CAM_MESA_CSC)}});b.cargaArbolTicket()};b.cargaArbolTicket=function(){let e=[],a=18,c={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),Type:localStorage.getItem("Type"),EMPLEADO_CSC_EMPLEADO:h.EMPLEADO_CSC_EMPLEADO,TPO_USUARIO:b.TipoUsuario,ESPECIALIZADA:!0,CAM_MESA_CSC:4};__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Get_Mesa_Empleado","GET",c,getJSON(DeveloperType).ApiTickets_v2.token).then(d=>
{if(1==d.success){let f=d.JsonData;d={Tbl:"SAMT_ESTATUS_TICKET",WHR:"EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")};__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr","GET",d,getJSON(DeveloperType).ApiGeneral.token).then(m=>{1==m.success&&(m={Tbl:"SAMT_TIPO_SEVERIDAD",WHR:"EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")+" AND TIPO_SEVERIDAD_TICKET_ACTIVO = 1 "},__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr","GET",
m,getJSON(DeveloperType).ApiGeneral.token).then(n=>{1==n.success&&(n={Tbl:"SAMT_TIPO_PRIORIDAD_TICKET",WHR:"EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")+" AND TIPO_PRIORIDAD_ACTIVO = 1 "},__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr","GET",n,getJSON(DeveloperType).ApiGeneral.token).then(k=>{if(1==k.success){for(k=0;k<f.length;k++){b.MisServiciosActivosTickets.push(f[k].CAM_MESA_CSC);let q=parseInt(a+"");e.push({ID:q,CLAVE_ITEM:"SERVICIO",CAM_MESA_CSC:f[k].CAM_MESA_CSC,
DESCRIPCION:f[k].CAM_MESA_IDIOMA1,Task_Parent_ID:0,ICON:"SERVICIO"});a++;e.push({ID:a,CLAVE_ITEM:"ABIERTAS",DESCRIPCION:"Por Autorizar",CAM_MESA_CSC:f[k].CAM_MESA_CSC,Task_Parent_ID:q,ICON:"ABIERTAS"})}$("#treeTicketAdmin").dxTreeView("instance").option("dataSource",e);l.hide()}}))}))})}else $("#treeTicketAdmin").dxTreeView("instance").option("dataSource",e),l.hide()});l.hide();setTimeout(()=>{let d={TIC_CERRADO:0};b.__Temp_Ult_Consulta=d;b.ConsultaTickets(d)},1E3)};b.ConsultaTickets=function(e){b.__DataSource_Tickets_Grid_Admin.clear();
let a={...ReturnDefaultData_Init()};e=Object.assign(a,e,{CAM_CSC_SERVICIO_SOLICITA_IN:b.idServiciosUsuario,TIC_REQ_AUTORIZACION:1});l.show();__Reques_ajax(getJSON(DeveloperType).ApiTickets_v2.url+"Get_Ticket_Servicio","GET",e,getJSON(DeveloperType).ApiTickets_v2.token).then(c=>{1==c.success?c.JsonData.forEach(function(d){b.__DataSource_Tickets_Grid_Admin.insert(d)}):b.__DataSource_Tickets_Grid_Admin.clear();b.DataGridTicketsAdmin.refresh();l.hide()}).catch(function(c){b.__DataSource_Tickets_Grid_Admin.clear();
b.DataGridTicketsAdmin.refresh();l.hide();DevExpress.ui.notify("Eror de de busqueda vueva a intentar nuevamente","error",3E3)})};b.run=function(){b.getPermisosEmpleadoServicios()};b.getPermisosEmpleadoServicios=async function(){var e=JSON.parse(localStorage.getItem("obj_DatosEmpleado"));e={...ReturnDefaultData_Init(),EMPLEADO_CSC_EMPLEADO:e.EMPLEADO_CSC_EMPLEADO};try{let c=await __Reques_ajax(getJSON(DeveloperType).ApiGeneral.url+"getTreeCliProyCamp","GET",e,getJSON(DeveloperType).ApiGeneral.token);
if(1==c.success){jslinq(c.JsonData).toList().forEach(function(d){b._ClienteProyectoCampania_ObjData.insert(d)});var a=jslinq(c.JsonData).select(function(d){return d.CAM_CSC_SERVICIO}).toList();b.idServiciosUsuario=a.join(",");b.init()}}catch(c){DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE","error",3E3)}return!0};b.convertirSegundosADHHMMSS=function(e){const a=Math.floor(e/36E3);e%=36E3;const c=Math.floor(e/3600);e%=3600;const d=Math.floor(e/60);e%=60;return("0"+a).slice(-2)+
"d "+("0"+c).slice(-2)+":"+("0"+d).slice(-2)+":"+("0"+e).slice(-2)}};setTimeout(()=>{SalesDashboard.currentModel=new SalesDashboard.dashboardModel;SalesDashboard.currentModel.run()},1E3);
