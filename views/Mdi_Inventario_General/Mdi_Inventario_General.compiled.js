SalesDashboard.dashboardModel=function(){let c=this,k=$("#loadPanel").dxLoadPanel({hideOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",showIndicator:!0,showPane:!0,shading:!0,visible:!0}).dxLoadPanel("instance");c.TimeZoneServidor=localStorage.getItem("tmzServidor");c.TimeZoneEmpleado=localStorage.getItem("tmzEmpleado");c.TiempoUTCEmpleado=DiferencieTimeZones();c.__DataSource_Inventario_Grid=new DevExpress.data.ArrayStore({data:[]});c.init=function(){$("#splashscreen").fadeOut(1E3);Globalize.loadMessages(dictionary);
let d=function(){let b=sessionStorage.getItem("locale");return null!=b?b:"es"}();Globalize.locale(d);DevExpress.localization.locale(d);$("#adm_title").html(Globalize.formatMessage("adm_title"));$("#adm_title_grid").html(Globalize.formatMessage("adm_title_grid"));c.patname=window.location.pathname;JSON.parse(localStorage.getItem("obj_DatosEmpleado"));$("#Mod_Tab_Reporte").dxTabPanel({animationEnabled:!1,deferRendering:!1,repaintChangesOnly:!1,dataSource:[{title:"Grid General",template:"tab_gridGeneral",
icon:"./images/Icons/Todos.png"}]});$("#treeViewAdmin").dxTreeView({dataSource:[],height:"100%",showScrollbar:"always",dataStructure:"plain",selectionMode:"single",activeStateEnabled:!1,hoverStateEnabled:!1,focusStateEnabled:!1,selectByClick:!0,searchEnabled:!1,expandEvent:"click",keyExpr:"ID",displayExpr:"ITEM_DESCRIPCION",parentIdExpr:"ITEM_PARENT_ID",autoExpandAll:!1,itemTemplate:function(b,a,e){a=document.createElement("img");a.src=b.ICON;a.classList.add("icon");a.classList.add("size-24x24");
e.append(a);a=document.createElement("span");a.className="item-text";a.innerText=" "+b.ITEM_DESCRIPCION;e.append(a)},onItemClick:function(b){let a=b.itemData;switch(a.ITEM_CATEGORIA){case "SISTEMA":b={CAT_SISTEMA_CSC:a.ITEM_CSC,CAT_SUB_SISTEMA_CSC:0,PRODC_SERV_CSC:0,TIPO_ESTATUS_EQUIPO:"'1'",REQ_CSCREQUISICION:0};c.consultaInventario(b);console.log("id Sistema: "+a.ITEM_CSC);break;case "SUBSISTEMA":b={CAT_SISTEMA_CSC:a.ITEM_SISTEMA_ID,CAT_SUB_SISTEMA_CSC:a.ITEM_CSC,PRODC_SERV_CSC:0,TIPO_ESTATUS_EQUIPO:"'1'",
REQ_CSCREQUISICION:0};c.consultaInventario(b);console.log("ID SISTEMA: "+a.ITEM_SISTEMA_ID+" id Sub Sistema"+a.ITEM_CSC);break;case "PROD_SERV":b={CAT_SISTEMA_CSC:a.ITEM_SISTEMA_ID,CAT_SUB_SISTEMA_CSC:a.ITEM_SUBSISTEMA_ID,PRODC_SERV_CSC:a.ITEM_CSC,TIPO_ESTATUS_EQUIPO:"'1'",REQ_CSCREQUISICION:0};c.consultaInventario(b);console.log("ID SISTEMA: "+a.ITEM_SISTEMA_ID+" ID SUBSISTEMA: "+a.ITEM_SUBSISTEMA_ID+" id Producto Servicio"+a.ITEM_CSC);break;default:DevExpress.ui.notify("No se selecciono un dato",
"error",3E3),console.log("No se selecciono un dato")}}});c.DataGridInventario=$("#Data_Grid_Inventario").dxDataGrid({dataSource:c.__DataSource_Inventario_Grid,deferRendering:!0,allowColumnResizing:!0,height:"100%",headerFilter:{visible:!0},filterRow:{visible:!1},filterPanel:{visible:!0},remoteOperations:!1,searchPanel:{visible:!1,highlightCaseSensitive:!0},selection:{mode:"single"},scrolling:{mode:"virtual",showScrollbar:"always",useNative:!0},groupPanel:{visible:!0},grouping:{autoExpandAll:!0},paging:{enabled:!1,
pageIndex:0,pageSize:20},showBorders:!0,showRowLines:!1,showColumnLines:!0,rowAlternationEnabled:!0,columnAutoWidth:!0,export:{enabled:!0},onExporting:function(b){let a=new ExcelJS.Workbook,e=a.addWorksheet("Reporte");DevExpress.excelExporter.exportDataGrid({worksheet:e,component:b.component,customizeCell:function(l){l.font={name:"Arial",size:11};l.alignment={horizontal:"left"}}}).then(function(){a.xlsx.writeBuffer().then(function(l){saveAs(new Blob([l],{type:"application/octet-stream"}),"REPORTE_INVENTARIO_"+
moment().tz(c.TimeZoneEmpleado).format("YYYYMMDD_HH")+".xlsx")})});b.cancel=!0},columns:[{caption:"Clase",dataField:"TIPO_CLASE_IDIOMA1",fixed:!0,fixedPosition:"left",alignment:"center"},{caption:"Descripcion Equipo",dataField:"PRODC_SERV_NOMBRE",fixed:!0,fixedPosition:"left",alignment:"center"},{caption:"Marca Producto",dataField:"CAT_MARCA_DECRIPCION",fixed:!0,fixedPosition:"left",alignment:"center"},{caption:"Modelo",dataField:"EQUIPAMIENTO_MODELO",fixed:!0,fixedPosition:"left",alignment:"center"},
{caption:"Estatus",dataField:"TIPO_ESTATUS_IDIOMA1",alignment:"center"},{caption:"Ruta WBS",dataField:"SEG_CSC_SEGMENTACION_INM_WBS",alignment:"center"},{caption:"Tipo De Adquisicion",dataField:"TIPO_EQUIPO_IDIOMA1",alignment:"center"},{caption:"Inicio de Operacion",dataField:"EQUIPAMIENTO_INICIO_OPERACIO",alignment:"center",dataType:"datetime",format:"yyyy/MM/dd"},{caption:"Proveedor",dataField:"CAT_PROVEEDOR_INFRA_RAZONSOCIALNOMBRE",alignment:"center"},{caption:"Codigo de Barras",dataField:"EQUIPAMIENTO_CODBARRAS",
alignment:"center"},{caption:"No Serie",dataField:"EQUIPAMIENTO_NO_SERIE",alignment:"center"},{caption:"Presentacion",dataField:"UME_DESCRIPCION_INTERNACIONALES",alignment:"center"},{caption:"UM",dataField:"UME_DESCRIPCION",alignment:"center"},{caption:"Cantidad",dataField:"EQUIPAMIENTO_CANTIDAD",alignment:"center"},{caption:"Consumo",dataField:"EQUIPAMIENTO_CONSUMIDO",alignment:"center"},{caption:"Existencia",dataField:"EQUIPAMIENTO_EXISTENCIA",alignment:"center"},{caption:"Comentarios",dataField:"PRODC_SERV_DESCRIPCION",
alignment:"left"}],summary:{totalItems:[{name:"Total",showInColumn:"TIPO_CLASE_IDIOMA1",displayFormat:"Total: {0}",summaryType:"count"}]},onRowDblClick:function(b){setTimeout(()=>{console.log("Llamar pantalla equipamiento")},1E3)}}).dxDataGrid("instance");c.cargaTreeView()};c.cargaTreeView=function(){let d=[],b=1,a={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),Type:localStorage.getItem("Type"),CAT_SISTEMAS_CLAVE:"'EQ','MOV','SW','ICIVIL','KIT','INS','HTAS'"};
__Reques_ajax(getJSON(DeveloperType).ApiEquipamiento.url+"Get_Sistema_Producto_Serv","GET",a,getJSON(DeveloperType).ApiEquipamiento.token).then(e=>{if(1==e.success){let l=e.JsonData;e={Tbl:"SAMT_CAT_SUBSISTEMA_PRODCT_SER",WHR:"EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")};__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr","GET",e,getJSON(DeveloperType).ApiGeneral.token).then(m=>{if(1==m.success){let q=m.JsonData;m={Tbl:"SAMT_PRODUCTOS_SERVICIOS",WHR:"EMP_CSC_EMPRESA_HOST = "+
localStorage.getItem("EMP_CSC_EMPRESA_HOST")};__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr","GET",m,getJSON(DeveloperType).ApiGeneral.token).then(n=>{if(1==n.success){n=n.JsonData;for(const g of l){let r=parseInt(b+"");d.push({ID:b,ITEM_CATEGORIA:"SISTEMA",ITEM_CLAVE:g.CAT_SISTEMAS_CLAVE,ITEM_CSC:g.CAT_SISTEMA_CSC,ITEM_DESCRIPCION:g.CAT_SISTEMA_IDIOMA1,ITEM_PARENT_ID:0,ICON:g.CAT_SISTEMA_IMAGE?.data?"data:image/png;base64,"+toBase64(g.CAT_SISTEMA_IMAGE.data):null});b++;var p=
jslinq(q).where(function(f){return f.CAT_SISTEMA_CSC==g.CAT_SISTEMA_CSC}).toList();for(const f of p){p=parseInt(b+"");d.push({ID:b,ITEM_CATEGORIA:"SUBSISTEMA",ITEM_CLAVE:f.CAT_SUBSISTEMA_CLAVE,ITEM_CSC:f.CAT_SUB_SISTEMA_CSC,ITEM_DESCRIPCION:f.CAT_SUBSISTEMA_IDIOMA1,ITEM_PARENT_ID:r,ITEM_SISTEMA_ID:g.CAT_SISTEMA_CSC,ICON:f.CAT_SUBSISTEMA_IMAGE?.data?"data:image/png;base64,"+toBase64(f.CAT_SUBSISTEMA_IMAGE.data):null});b++;let t=jslinq(n).where(function(h){return h.CAT_SUP_SISTEMA_CSC==f.CAT_SUB_SISTEMA_CSC}).toList();
for(const h of t)d.push({ID:b,ITEM_CATEGORIA:"PROD_SERV",ITEM_CLAVE:h.CAT_CLAVE,ITEM_CSC:h.PRODC_SERV_CSC,ITEM_DESCRIPCION:h.PRODC_SERV_NOMBRE+" (0)",ITEM_PARENT_ID:p,ITEM_SISTEMA_ID:g.CAT_SISTEMA_CSC,ITEM_SUBSISTEMA_ID:f.CAT_SUB_SISTEMA_CSC,ICON:h.PRODC_SERV_IMAGEN?.data?"data:image/png;base64,"+toBase64(h.PRODC_SERV_IMAGEN.data):null}),b++}$("#treeViewAdmin").dxTreeView("instance").option("dataSource",d);k.hide()}}})}})}else $("#treeViewAdmin").dxTreeView("instance").option("dataSource",d),k.hide()})};
c.consultaInventario=function(d){c.__DataSource_Inventario_Grid.clear();let b={...ReturnDefaultData_Init()};d=Object.assign(b,d);k.show();__Request_Http_Mode(getJSON(DeveloperType).ApiEquipamiento.url+"Get_Inventario","GET",d,getJSON(DeveloperType).ApiEquipamiento.token).then(a=>{1==a.success?(a.JsonData.forEach(function(e){c.__DataSource_Inventario_Grid.insert(e)}),c.DataGridInventario.refresh(),k.hide()):(c.__DataSource_Inventario_Grid.clear(),c.DataGridInventario.refresh(),k.hide(),DevExpress.ui.notify("No se encontraron registros en la busqueda.",
"info",3E3))}).catch(function(a){c.__DataSource_Inventario_Grid.clear();c.DataGridInventario.refresh();k.hide();DevExpress.ui.notify("Eror en la busqueda, vuelva a intentar nuevamente","error",3E3)})}};setTimeout(()=>{SalesDashboard.currentModel=new SalesDashboard.dashboardModel;SalesDashboard.currentModel.init()},1E3);
