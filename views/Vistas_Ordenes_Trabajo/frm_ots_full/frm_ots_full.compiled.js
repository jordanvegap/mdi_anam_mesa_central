SalesDashboard.dashboardModel=function(){function v(d,g,a){l.show();l.option("message","Cargando archivo...");console.log(d);d.type.split("/");var b=d.name,e=d.name.split(".");e=e[e.length-1];var k=new FormData;k.append("FileUpload",d,w()+"."+e);k.append("proyecto",localStorage.getItem("EMP_CLV_EMPRESA")+"/"+localStorage.getItem("EMP_CSC_EMPRESA_HOST")+"/"+t[0].TIPO_ORIGEN_CLAVE+"/"+c.DataOtOpen.OTR_CSCORDENTRABAJO);$.ajax({xhr:function(){var h=new window.XMLHttpRequest;h.upload.addEventListener("progress",
function(f){f.lengthComputable&&(c.uploadProgressBar.option("visible",!0),f=f.loaded/f.total,f=parseInt(100*f),c.uploadProgressBar.option("value",f))},!1);return h},type:"POST",url:"https://cdn.dnasystem.io:2020/api/PageUpload",data:k,dataType:"json",cache:!1,contentType:!1,processData:!1,headers:{"access-token":"9E21547C-9511-4B2E-9139-2AF549CBA698"}}).done(function(h){if("Exito"==h.Estatus){console.log(h);c.uploadProgressBar.option("visible",!1);document.getElementById("dropzone-text-id-"+g).innerHTML=
'<span style="text-align: center;">Archivo cargado correctamente</span>';$("#File_Upload_Archivos_OrdenTrabajo").dxFileUploader("instance").reset();console.log(a);switch(a){case "image/jpeg":$("#dropzone-image-id-"+g).attr("src",h.filename);break;case "image/png":$("#dropzone-image-id-"+g).attr("src",h.filename);break;case "application/pdf":$("#dropzone-image-id-"+g).attr("src","./img/icons/upload.png");break;default:$("#dropzone-image-id-"+g).attr("src","./img/icons/upload.png")}var f=c.Frm_Ot_Instance.option("formData");
h={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),Type:localStorage.getItem("Type"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),REQ_CSCREQUISICION:0,INM_CSCINMUEBLE:0,FOTO_CSC_EXTERNO:f.OTR_CSCORDENTRABAJO,TIPO_ORIGEN_CSC:t[0].TIPO_ORIGEN_CSC,FOTO_IMAGEN_RUTA:h.filename,FOTO_IMAGEN_URL:h.filename,FOTO_NUMERO_FOTO:null,FOTO_DESCRIPCION:"Documento: "+b,FOTO_ACTIVO:1};x(h)}l.hide()})}function x(d){l.show();__Reques_ajax(getJSON(DeveloperType).ApiGeneral.url+"Put_Archivos_General",
"POST",JSON.stringify(d),getJSON(DeveloperType).ApiGeneral.token).then(g=>{1==g.success?(l.hide(),c.Get_Archivos_BD()):(console.log(g),l.hide())})}function w(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var g=16*Math.random()|0;return("x"==d?g:g&3|8).toString(16)})}var c=this,m,t;c.DataOtOpen=null;c.setDefaultValues_Ots=!1;c.Ids_TipoUso_Requi_Ots=9;c.Frm_Ot_Instance=null;var l=$("#loadPanel").dxLoadPanel({hideOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",showIndicator:!0,
showPane:!0,shading:!0,visible:!0}).dxLoadPanel("instance");c.init=function(){function d(a,b,e,k){var h=$.when();Object.entries(b).forEach(([f])=>{if(b[f]!=a[f]){var r=e.itemOption(f),n=r.editorType,p=" '"+r.label.text+"' cambio de  ";if("dxTextBox"==n)p+="'"+a[f]+"' a '"+b[f]+"'";else if("dxCheckBox"==n)p+="'"+a[f]+"' a '"+b[f]+"'";else if("dxDateBox"==n)p+="'"+a[f]+"' a '"+b[f]+"'";else if("dxRadioGroup"==n||"dxSelectBox"==n){var q=n=null;n=e.getEditor(f).option("dataSource");q=1==Array.isArray(n)?
n:n.store().__rawData;void 0==q&&(q=r.editorOptions.dataSource);n=jslinq(q).where(function(u){return u[r.editorOptions.valueExpr]==a[f]}).toList();q=jslinq(q).where(function(u){return u[r.editorOptions.valueExpr]==b[f]}).toList();p=0<n.length?p+(n[0][r.editorOptions.displayExpr]+" a "):p+(a[f]+" a ");p=0<q.length?p+q[0][r.editorOptions.displayExpr]:p+a[f]}else p+="'"+a[f]+"' a '"+b[f]+"'";var y={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),Type:localStorage.getItem("Type"),DATA_INSERT:{EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),
AUDITORIA_USU_ALTA:JSON.parse(localStorage.getItem("obj_DatosEmpleado")).EMPLEADO_CSC_EMPLEADO,AUDITORIA_USU_ULT_MOD:JSON.parse(localStorage.getItem("obj_DatosEmpleado")).EMPLEADO_CSC_EMPLEADO,AUDITORIA_FEC_ALTA:"GETDATE()",AUDITORIA_FEC_ULT_MOD:"GETDATE()",OTR_CSCORDENTRABAJO:b.OTR_CSCORDENTRABAJO,ESTATUS_ORDEN_CSC:b.ESTATUS_ORDEN_CSC,OTB_NOMBRE:m.EMPLEADO_NOMBREEMPLEADO+" "+m.EMPLEADO_APATERNOEMPLEADO,OTB_DESCRIPCION:p,OTB_FECHAHORA:"GETDATE()"}};h=h.then(function(){return __Reques_ajax_BitaoraDato(getJSON(DeveloperType).ApiOrdenTrabajo_v2.url+
"Insert_Bitacora_Ot","POST",JSON.stringify(y),getJSON(DeveloperType).ApiOrdenTrabajo_v2.token)}).catch(function(){return!1})}else h=h.then(function(){return!1})})}m=JSON.parse(localStorage.getItem("obj_DatosEmpleado"));l.hide();$("#splashscreen").fadeOut(1E3);Globalize.loadMessages(dictionary);var g=function(){var a=sessionStorage.getItem("locale");return null!=a?a:"es-mx"}();Globalize.locale(g);DevExpress.localization.locale(g);"EDITAR"==getUrlParam("TIPO")?(g={OTR_NEWID:getUrlParam("OT_ID")},c.Get_OrdenTrabajos(g,
!1,null)):getUrlParam("TIPO");t=JSON.parse(sessionStorage.getItem("cat_origen_foto"));t=jslinq(t).where(function(a){return"OT"==a.TIPO_ORIGEN_CLAVE}).toList();c.uploadProgressBar=$("#upload-progress").dxProgressBar({min:0,max:100,width:"100%",showStatus:!1,visible:!1}).dxProgressBar("instance");$("#Pop_Notificacion").dxPopup({width:20,height:20,visible:!1,showTitle:!1,title:"Information",hideOnOutsideClick:!1,toolbarItems:[{widget:"dxButton",toolbar:"bottom",options:{text:"Cerrar",onClick(){$("#Pop_Notificacion").dxPopup("hide")}}}]}).dxPopup("instance");
$("#Tab_Panel_OrdenTrabajo_Detalle").dxTabPanel({animationEnabled:!1,deferRendering:!1,repaintChangesOnly:!1,height:"200",elementAttr:{id:"Tab-OrdenTrabajoDetalle"},dataSource:[{title:"Activos Fijos",template:"tab-ActivosFijos"},{title:"Insumos",template:"tab-Insumos"},{title:"Tareas",template:"tab-Tareas"},{title:"Bitacora",template:"tab-Bitacora"},{title:"Autorizacion",template:"tab-Autorizacion"},{title:"Documentos",template:"tab-Documentos"},{title:"Fotos",template:"tab-Fotos"},{title:"Empleado",
template:"tab-Empleado"},{title:"Herramientas",template:"tab-Herramientas"},{title:"Servicios",template:"tab-Servicios"}]});$("#File_Upload_Archivos_OrdenTrabajo").dxFileUploader({dialogTrigger:"#dropzone-id-frente",dropZone:"#dropzone-id-frente",multiple:!1,allowedFileExtensions:[".jpg",".jpeg",".gif",".png"],uploadMode:"useButtons",visible:!1,onDropZoneEnter:function(a){},onDropZoneLeave:function(a){},onValueChanged:function(a){if((a=a.value)&&a[0]){var b=new FileReader;b.onload=function(e){};b.readAsDataURL(a[0]);
v(a[0],"frente",a[0].type)}}}).dxFileUploader("instance");$("#___Tb_Ot").dxToolbar({onContentReady:function(){$Btn_Alta_OrdenTrabajo.option("visible",!0);$btn_Modificar_OrdenTrabajo.option("visible",!0);$btn_Salvar_Alta_OrdenTrabajo.option("visible",!1);$btn_Salvar_Modifica_OrdenTrabajo.option("visible",!1);$btn_Cancelar_Alta_OrdenTrabajo.option("visible",!1);$btn_Cancelar_Modificar_OrdenTrabajo.option("visible",!1)},items:[{location:"before",widget:"dxButton",locateInMenu:"auto",options:{icon:"plus",
text:"Alta",type:"default",onInitialized:function(a){$Btn_Alta_OrdenTrabajo=a.component},onClick(){$Btn_Alta_OrdenTrabajo.option("visible",!1);$btn_Modificar_OrdenTrabajo.option("visible",!1);$btn_Cancelar_Alta_OrdenTrabajo.option("visible",!0);$btn_Salvar_Alta_OrdenTrabajo.option("visible",!0);c.Frm_Ot_Instance.option("readOnly",!1);c.Frm_Ot_Instance.resetValues();c.setDefaultValues_Ots=!0;setTimeout(()=>{c.Frm_Ot_Instance.getEditor("OTR_NEWID").option("value",createUUID(36));c.Frm_Ot_Instance.getEditor("OTR_FECHA_ALTA").option("value",
new Date);c.Frm_Ot_Instance.getEditor("EMPLEADO_CSC_ALTA").option("value",m.EMPLEADO_CSC_EMPLEADO);c.Frm_Ot_Instance.getEditor("EMPLEADO_CSC_SOLICITA").option("value",m.EMPLEADO_CSC_EMPLEADO);c.Frm_Ot_Instance.getEditor("TIPO_AREA_CSC_SOLICITUD").option("value",m.CAT_AREA_CSC);c.Frm_Ot_Instance.getEditor("CAT_DEPTO_CSC_SOLICITUD").option("value",m.CAT_DEPARTAMENTO_CSC);c.Frm_Ot_Instance.getEditor("REQ_CSCREQUISICION").option("value",m.REQ_CSCREQUISICION);c.Frm_Ot_Instance.getEditor("TIPO_PRIORIDAD_CSC").getDataSource().reload();
c.Frm_Ot_Instance.getEditor("TIPO_OT_TRAMITE_CSC").getDataSource().reload();c.Frm_Ot_Instance.getEditor("TIPO_CALIFICACION_CSC").getDataSource().reload()},1E3)}}},{location:"before",widget:"dxButton",locateInMenu:"auto",options:{icon:"save",text:"Salvar Alta",type:"success",onInitialized:function(a){$btn_Salvar_Alta_OrdenTrabajo=a.component},onClick(){l.show();1==c.Frm_Ot_Instance.validate().isValid?c.Generar_Alta_OrdenTrabajo():(l.hide(),DevExpress.ui.notify("LLENE LOS CAMPOS EN ROJO"))}}},{location:"after",
widget:"dxButton",locateInMenu:"auto",options:{icon:"clear",text:"Cancelar Alta",type:"danger",onInitialized:function(a){$btn_Cancelar_Alta_OrdenTrabajo=a.component},onClick(){$Btn_Alta_OrdenTrabajo.option("visible",!0);$btn_Modificar_OrdenTrabajo.option("visible",!0);$btn_Cancelar_Alta_OrdenTrabajo.option("visible",!1);$btn_Salvar_Alta_OrdenTrabajo.option("visible",!1);c.Frm_Ot_Instance.option("readOnly",!0);c.Frm_Ot_Instance.resetValues()}}},{location:"after",widget:"dxButton",locateInMenu:"auto",
options:{icon:"edit",text:"Modificar",type:"normal",onInitialized:function(a){$btn_Modificar_OrdenTrabajo=a.component},onClick(){""==c.Frm_Ot_Instance.getEditor("OTR_NEWID").option("value")?DevExpress.ui.notify("No hay elemento a modificar"):(c.setDefaultValues_Ots=!1,$btn_Modificar_OrdenTrabajo.option("visible",!1),$Btn_Alta_OrdenTrabajo.option("visible",!1),$btn_Salvar_Modifica_OrdenTrabajo.option("visible",!0),$btn_Cancelar_Modificar_OrdenTrabajo.option("visible",!0),c.Frm_Ot_Instance.option("readOnly",
!1))}}},{location:"before",widget:"dxButton",locateInMenu:"auto",options:{icon:"save",text:"Salvar Modifica",type:"success",onInitialized:function(a){$btn_Salvar_Modifica_OrdenTrabajo=a.component},onClick(){var a=JSON.stringify(c.DataOtOpen);c.DataOtOpen=JSON.parse(a);a=c.Frm_Ot_Instance.option("formData");var b=GetUpdateData(c.DataOtOpen,a),e=0===Object.keys(b).length;1==c.Frm_Ot_Instance.validate().isValid?1!=e&&(d(c.DataOtOpen,a,c.Frm_Ot_Instance,343174),b.AUDITORIA_USU_ULT_MOD=m.EMPLEADO_CSC_EMPLEADO,
b.AUDITORIA_FEC_ULT_MOD="GETDATE()",b.EMP_CSC_EMPRESA_HOST=localStorage.getItem("EMP_CSC_EMPRESA_HOST"),b.OTR_FECHA_ALTA&&(b.OTR_FECHA_ALTA=ConvertDatetimeToStringBD(b.OTR_FECHA_ALTA)),b.OTR_FECHA_PROMESA&&(b.OTR_FECHA_PROMESA=ConvertDatetimeToStringBD(b.OTR_FECHA_PROMESA)),b.OTR_FECHA_PROGRAMADA&&(b.OTR_FECHA_PROGRAMADA=ConvertDatetimeToStringBD(b.OTR_FECHA_PROGRAMADA)),1==b.OTR_CERRADA&&(b.OTR_FECHA_CIERRE="GETDATE()"),a={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),Type:localStorage.getItem("Type"),
EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),DATA_UPDATE:b,DATA_WHERE:{OTR_CSCORDENTRABAJO:c.DataOtOpen.OTR_CSCORDENTRABAJO,OTR_NEWID:c.DataOtOpen.OTR_NEWID,EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST")}},l.show(),__Reques_ajax(getJSON(DeveloperType).ApiOrdenTrabajo_v2.url+"Update_Orden_Trabajo","POST",JSON.stringify(a),getJSON(DeveloperType).ApiOrdenTrabajo_v2.token).then(k=>{if(1==k.success){var h=JSON.stringify(k.JsonData[0]),f=JSON.parse(h);f.OTR_FECHA_CIERRE&&
(f.OTR_FECHA_CIERRE=ConvertStringToObjDateLong(f.OTR_FECHA_CIERRE));f.OTR_FECHA_PROMESA&&(f.OTR_FECHA_PROMESA=ConvertStringToObjDateLong(f.OTR_FECHA_PROMESA));f.OTR_FECHA_ALTA&&(f.OTR_FECHA_ALTA=ConvertStringToObjDateLong(f.OTR_FECHA_ALTA));f.OTR_FECHA_PROGRAMADA&&(f.OTR_FECHA_PROGRAMADA=ConvertStringToObjDateLong(f.OTR_FECHA_PROGRAMADA));c.DataOtOpen=JSON.parse(h);c.Frm_Ot_Instance.updateData(f);l.hide();DevExpress.ui.notify("OT actualizada correctamente","success",4E3);$btn_Modificar_OrdenTrabajo.option("visible",
!0);$Btn_Alta_OrdenTrabajo.option("visible",!0);$btn_Salvar_Modifica_OrdenTrabajo.option("visible",!1);$btn_Cancelar_Modificar_OrdenTrabajo.option("visible",!1);c.Frm_Ot_Instance.option("readOnly",!0);setTimeout(()=>{c.Get_Bitacora_OrdenTrabajos(f.OTR_CSCORDENTRABAJO);c.Get_Archivos_BD(f.OTR_CSCORDENTRABAJO)},3E3)}else l.hide();return k}).catch(function(k){console.log(k);l.hide();DevExpress.ui.notify("Error al actualizar ticket intentelo nuevamente","error",1E4)})):(l.hide(),DevExpress.ui.notify("LLENE LOS CAMPOS EN ROJO"))}}},
{location:"after",widget:"dxButton",locateInMenu:"auto",options:{icon:"clear",text:"Cancelar Modificar",type:"danger",onInitialized:function(a){$btn_Cancelar_Modificar_OrdenTrabajo=a.component},onClick(){$btn_Modificar_OrdenTrabajo.option("visible",!0);$Btn_Alta_OrdenTrabajo.option("visible",!0);$btn_Salvar_Modifica_OrdenTrabajo.option("visible",!1);$btn_Cancelar_Modificar_OrdenTrabajo.option("visible",!1);c.Frm_Ot_Instance.option("readOnly",!0);var a=JSON.stringify(c.DataOtOpen);c.DataOtOpen=JSON.parse(a);
c.Frm_Ot_Instance.updateData(c.DataOtOpen)}}}]}).dxToolbar("instance");c.Frm_Ot_Instance=$("#__Frm_Orden_Trabajo").dxForm({readOnly:!0,showColonAfterLabel:!0,showValidationSummary:!1,validationGroup:"__Frm_Orden_Trabajo_Validation",labelMode:"static",labelLocation:"top",items:[{itemType:"group",colCount:4,cssClass:"hidden_box",items:[{colSpan:4,dataField:"OTR_NEWID",label:{text:"UUID"},editorOptions:{readOnly:!0,disabled:!1}}]},{itemType:"group",colCount:6,items:[{colSpan:6,template:"<div class='heading_InnerFrm'><h2>Detalles de orden de trabajo</h2></div>"},
{colSpan:2,dataField:"OTR_CSCORDENTRABAJO",label:{text:"No. de OT"},editorOptions:{readOnly:!0,disabled:!1}},{colSpan:2,dataField:"OTR_CSCORDENTRABAJO",label:{text:"No. de Ticket"},editorOptions:{readOnly:!0,disabled:!1}},{colSpan:2,dataField:"OTR_CERRADA",editorType:"dxSwitch",label:{location:"left",text:"Estatus"},editorOptions:{switchedOffText:"Abierta",switchedOnText:"Cerrada",width:"100%",onValueChanged:function(a){console.log(a.value)}}},{colSpan:3,dataField:"EMPLEADO_CSC_ALTA",editorType:"dxSelectBox",
label:{text:"Empleado Alta"},editorOptions:{searchEnabled:!0,displayExpr:"NOMBRE",valueExpr:"EMPLEADO_CSC_EMPLEADO",deferRendering:!1,dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.CustomStore({key:"EMPLEADO_CSC_EMPLEADO",loadMode:"raw",paginate:!1,load:async function(){return JSON.parse(sessionStorage.getItem("all_emp_host"))}})}),onValueChanged:function(a){}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:3,dataField:"ESTATUS_ORDEN_CSC",editorType:"dxSelectBox",
label:{text:"Proceso"},editorOptions:{searchEnabled:!0,displayExpr:"ESTATUS_ORDEN_IDIOMA1",valueExpr:"ESTATUS_ORDEN_CSC",dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.CustomStore({key:"ESTATUS_ORDEN_CSC",loadMode:"raw",paginate:!1,load:async function(){return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat","GET",{Tbl:"SAMT_ESTATUS_ORDEN_TRABAJO",NACTIVE:"ESTATUS_ORDEN_ACTIVO"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return a.JsonData;
console.log(a.message)})}})}),onValueChanged:function(a){}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:3,dataField:"TIPO_AREA_CSC_SOLICITUD",editorType:"dxSelectBox",label:{text:"Area Solicita"},editorOptions:{searchEnabled:!0,displayExpr:"TIPO_AREA_IDIOMA1",valueExpr:"TIPO_AREA_CSC",dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.CustomStore({key:"TIPO_AREA_CSC",loadMode:"raw",paginate:!1,load:async function(){return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+
"Get_Cat","GET",{Tbl:"SAMT_CAT_EMPLEADO_AREA",NACTIVE:"TIPO_AREA_ACTIVO"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return jslinq(a.JsonData).orderBy(function(b){return b.TIPO_AREA_IDIOMA1}).toList();console.log(a.message)})}})}),onValueChanged:function(a){a=a.value;var b=c.Frm_Ot_Instance.getEditor("CAT_DEPTO_CSC_SOLICITUD");b.option("value",null);a={Tbl:"SAMT_CAT_EMPLEADO_DEPARTAMENTO",WHR:"EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")+" AND TIPO_AREA_CSC = "+
a};__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr","GET",a,getJSON(DeveloperType).ApiGeneral.token).then(e=>{1==e.success?b.option("dataSource",e.JsonData):b.option("dataSource",[])})}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:3,dataField:"TIPO_AREA_CSC_RESPONSABLE",editorType:"dxSelectBox",label:{text:"Area Ejecuta"},editorOptions:{searchEnabled:!0,displayExpr:"TIPO_AREA_IDIOMA1",valueExpr:"TIPO_AREA_CSC",dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.CustomStore({key:"TIPO_AREA_CSC",
loadMode:"raw",paginate:!1,load:async function(){return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat","GET",{Tbl:"SAMT_CAT_EMPLEADO_AREA",NACTIVE:"TIPO_AREA_ACTIVO"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return jslinq(a.JsonData).orderBy(function(b){return b.TIPO_AREA_IDIOMA1}).toList();console.log(a.message)})}})}),onValueChanged:function(a){a=a.value;var b=c.Frm_Ot_Instance.getEditor("CAT_DEPTO_CSC_RESPONSABLE");b.option("value",null);a={Tbl:"SAMT_CAT_EMPLEADO_DEPARTAMENTO",
WHR:"EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")+" AND TIPO_AREA_CSC = "+a};__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr","GET",a,getJSON(DeveloperType).ApiGeneral.token).then(e=>{1==e.success?b.option("dataSource",e.JsonData):b.option("dataSource",[])})}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:3,dataField:"CAT_DEPTO_CSC_SOLICITUD",editorType:"dxSelectBox",label:{text:"Dep. Solicita"},editorOptions:{searchEnabled:!0,displayExpr:"SAMT_TIPO_DEPARTAMENTO_IDIOMA1",
valueExpr:"EMPLEADO_DEPARTAMENTO_CSC",onValueChanged:function(a){}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:3,dataField:"CAT_DEPTO_CSC_RESPONSABLE",editorType:"dxSelectBox",label:{text:"Dep. Ejecuta"},editorOptions:{searchEnabled:!0,displayExpr:"SAMT_TIPO_DEPARTAMENTO_IDIOMA1",valueExpr:"EMPLEADO_DEPARTAMENTO_CSC",onValueChanged:function(a){if(null==c.DataOtOpen||void 0==c.DataOtOpen)c.Frm_Ot_Instance.getEditor("TIPO_ORDEN_CSC").option("value",null),c.Frm_Ot_Instance.getEditor("TIPO_ESPECIALIDAD_OT_CSC").option("value",
null);a=a.value;console.log(a);var b=c.Frm_Ot_Instance.getEditor("TIPO_ORDEN_CSC"),e={Tbl:"SAMT_TIPO_ORDEN_TRABAJO",WHR:"EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")+" AND EMPLEADO_DEPARTAMENTO_CSC = "+a};__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr","GET",e,getJSON(DeveloperType).ApiGeneral.token).then(h=>{1==h.success?b.option("dataSource",h.JsonData):b.option("dataSource",[])});var k=c.Frm_Ot_Instance.getEditor("TIPO_ESPECIALIDAD_OT_CSC");e={Tbl:"SAMT_TIPO_ESPECIALIDAD_OT",
WHR:"EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")+" AND EMPLEADO_DEPARTAMENTO_CSC = "+a};__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr","GET",e,getJSON(DeveloperType).ApiGeneral.token).then(h=>{1==h.success?k.option("dataSource",h.JsonData):k.option("dataSource",[])})}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:3,dataField:"EMPLEADO_CSC_SOLICITA",editorType:"dxSelectBox",label:{text:"Solicita"},editorOptions:{searchEnabled:!0,displayExpr:"NOMBRE",
valueExpr:"EMPLEADO_CSC_EMPLEADO",deferRendering:!1,dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.CustomStore({key:"EMPLEADO_CSC_EMPLEADO",loadMode:"raw",paginate:!1,load:async function(){return JSON.parse(sessionStorage.getItem("all_emp_host"))}})}),onValueChanged:function(a){}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:3,dataField:"TIPO_ORDEN_CSC",editorType:"dxSelectBox",label:{text:"Tipo Orden"},editorOptions:{searchEnabled:!0,displayExpr:"TIPO_ORDEN_IDIOMA1",
valueExpr:"TIPO_ORDEN_CSC",onValueChanged:function(a){a=a.value;var b=c.Frm_Ot_Instance.getEditor("SUB_TIPO_CSC");a={Tbl:"SAMT_TIPO_SUB_TIPO_OT",WHR:"EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")+" AND TIPO_ORDEN_CSC = "+a};__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr","GET",a,getJSON(DeveloperType).ApiGeneral.token).then(e=>{1==e.success?b.option("dataSource",e.JsonData):b.option("dataSource",[])})}},validationRules:[{type:"required",message:"requerido"}]},
{colSpan:3,dataField:"TIPO_PRIORIDAD_CSC",editorType:"dxSelectBox",label:{text:"Prioridad"},editorOptions:{searchEnabled:!0,displayExpr:"TIPO_PRIORIDAD_IDIOMA1",valueExpr:"TIPO_PRIORIDAD_CSC",dataSource:new DevExpress.data.DataSource({loadMode:"raw",paginate:!1,load:async function(){var a=c.Frm_Ot_Instance.getEditor("TIPO_PRIORIDAD_CSC");return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat","GET",{Tbl:"SAMT_TIPO_PRIORIDAD_OT",NACTIVE:"TIPO_PRIORIDAD_ACTIVO"},getJSON(DeveloperType).ApiGeneral.token).then(b=>
{if(1==b.success){if(1==c.setDefaultValues_Ots){var e=jslinq(b.JsonData).where(function(k){return 1==k.TIPO_PRIORIDAD_DEFAULT}).toList();a.option("value",e[0].TIPO_PRIORIDAD_CSC);console.log(e[0].TIPO_PRIORIDAD_CSC)}return jslinq(b.JsonData).orderBy(function(k){return k.TIPO_PRIORIDAD_ORDEN}).toList()}console.log(b.message)})}}),onValueChanged:function(a){}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:3,dataField:"SUB_TIPO_CSC",editorType:"dxSelectBox",label:{text:"Sub Tipo Orden"},
editorOptions:{searchEnabled:!0,displayExpr:"SUB_TIPO_OT_IDIOMA1",valueExpr:"SUB_TIPO_CSC",onValueChanged:function(a){}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:3,dataField:"REQ_CSCREQUISICION",editorType:"dxSelectBox",label:{text:"Ubicaci\u00f3n"},editorOptions:{searchEnabled:!0,dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.CustomStore({key:"REQ_CSCREQUISICION",loadMode:"raw",paginate:!1,load:async function(){var a={Tbl:"SAMT_REQUISICIONES",WHR:"EMP_CSC_EMPRESA_HOST = "+
localStorage.getItem("EMP_CSC_EMPRESA_HOST")+" AND ESTATUS_REQUISICION_CSC=1"};return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr","GET",a,getJSON(DeveloperType).ApiGeneral.token).then(b=>{if(1==b.success)return jslinq(b.JsonData).orderBy(function(e){return e.REQ_NOMBREAREA}).toList();console.log(b.message)})}})}),displayExpr:"REQ_NOMBREAREA",valueExpr:"REQ_CSCREQUISICION",onValueChanged:function(a){}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:3,dataField:"TIPO_ESPECIALIDAD_OT_CSC",
editorType:"dxSelectBox",label:{text:"Especialidad"},editorOptions:{searchEnabled:!0,displayExpr:"TIPO_ESPECIALIDAD_OT_IDIOMA1",valueExpr:"TIPO_ESPECIALIDAD_OT_CSC",onValueChanged:function(a){}}},{itemType:"empty",colSpan:3},{colSpan:3,dataField:"TIPO_DISCIPLINA_OT_CSC",editorType:"dxSelectBox",label:{text:"Disciplina"},editorOptions:{searchEnabled:!0,displayExpr:"TIPO_DISCIPLINA_OT_IDIOMA1",valueExpr:"TIPO_DISCIPLINA_OT_CSC",dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.CustomStore({key:"TIPO_DISCIPLINA_OT_CSC",
loadMode:"raw",paginate:!1,load:async function(){return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat","GET",{Tbl:"SAMT_TIPO_DISCIPLINA_OT",NACTIVE:"TIPO_DISCIPLINA_OT_ACTIVO"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return jslinq(a.JsonData).orderBy(function(b){return b.TIPO_DISCIPLINA_OT_IDIOMA1}).toList();console.log(a.message)})}})}),onValueChanged:function(a){}}},{colSpan:6,template:"<div class='heading_InnerFrm'><h2>Calendario</h2></div>"},{itemType:"group",
colCount:1,colSpan:3,items:[{colSpan:3,dataField:"EMPLEADO_CSC_RESPONSABLE",editorType:"dxSelectBox",label:{text:"Empleado Asignado"},editorOptions:{searchEnabled:!0,displayExpr:"NOMBRE",valueExpr:"EMPLEADO_CSC_EMPLEADO",deferRendering:!1,dataSource:new DevExpress.data.DataSource({loadMode:"raw",paginate:!1,load:async function(){return JSON.parse(sessionStorage.getItem("all_emp_host"))}}),onValueChanged:function(a){}}},{dataField:"OTR_FECHA_ALTA",label:{text:"Fecha de alta"},editorType:"dxDateBox",
editorOptions:{value:new Date,type:"datetime",disabled:!0,displayFormat:"dd/MM/yyyy hh:mm:ss",dateSerializationFormat:"yyyy-MM-ddTHH:mm:ss"}},{dataField:"OTR_FECHA_PROGRAMADA",editorType:"dxDateBox",label:{text:"Fecha programada"},editorOptions:{type:"datetime",disabled:!1,width:"100%",placeholder:"DD/MM/AAAA HH:mm:ss",useMaskBehavior:!0,displayFormat:"dd/MM/yyyy HH:mm:ss",dateSerializationFormat:"yyyy-MM-ddTHH:mm:ss",onValueChanged:function(a){}}},{dataField:"OTR_FECHA_PROMESA",label:{text:"Fecha promesa"},
editorType:"dxDateBox",editorOptions:{type:"datetime",disabled:!1,width:"100%",placeholder:"DD/MM/AAAA HH:mm:ss",useMaskBehavior:!0,displayFormat:"dd/MM/yyyy HH:mm:ss",dateSerializationFormat:"yyyy-MM-ddTHH:mm:ss",onValueChanged:function(a){}}},{dataField:"OTR_FECHA_CIERRE",label:{text:"Fecha Cierre"},editorType:"dxDateBox",editorOptions:{readOnly:!0,type:"datetime",disabled:!1,width:"100%",placeholder:"DD/MM/AAAA HH:mm:ss",useMaskBehavior:!0,displayFormat:"dd/MM/yyyy HH:mm:ss",dateSerializationFormat:"yyyy-MM-ddTHH:mm:ss",
onValueChanged:function(a){}}}]},{itemType:"group",colCount:2,colSpan:3,items:[{colSpan:2,dataField:"TIPO_OT_TRAMITE_CSC",editorType:"dxSelectBox",label:{text:"Tramite"},editorOptions:{searchEnabled:!0,displayExpr:"TIPO_OT_TRAMITE_IDIOMA1",valueExpr:"TIPO_OT_TRAMITE_CSC",dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.CustomStore({key:"TIPO_OT_TRAMITE_CSC",loadMode:"raw",paginate:!1,load:async function(){var a=c.Frm_Ot_Instance.getEditor("TIPO_OT_TRAMITE_CSC");return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+
"Get_Cat","GET",{Tbl:"SAMT_TIPO_OT_TRAMITE",NACTIVE:"TIPO_OT_TRAMITE_ACTIVO"},getJSON(DeveloperType).ApiGeneral.token).then(b=>{if(1==b.success){if(1==c.setDefaultValues_Ots){var e=jslinq(b.JsonData).where(function(k){return 1==k.TIPO_OT_TRAMITE_DEFAULT}).toList();a.option("value",e[0].TIPO_OT_TRAMITE_CSC)}return jslinq(b.JsonData).orderBy(function(k){return k.TIPO_OT_TRAMITE_ORDEN}).toList()}console.log(b.message)})}})}),onValueChanged:function(a){}},validationRules:[{type:"required",message:"requerido"}]},
{colSpan:2,dataField:"CAT_PROVEEDOR_INFRA_CSC",editorType:"dxSelectBox",label:{text:"Proveedor"},editorOptions:{searchEnabled:!0,displayExpr:"CAT_PROVEEDOR_INFRA_RAZONSOCIALNOMBRE",valueExpr:"CAT_PROVEEDOR_INFRA_CSC",dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.CustomStore({key:"CAT_PROVEEDOR_INFRA_CSC",loadMode:"raw",paginate:!1,load:async function(){return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat","GET",{Tbl:"SAMT_CAT_PROVEEDORES_INFRA",NACTIVE:"CAT_PROVEEDOR_INFRA_ACTIVO"},
getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return jslinq(a.JsonData).orderBy(function(b){return b.CAT_PROVEEDOR_INFRA_RAZONSOCIALNOMBRE}).toList();console.log(a.message)})}})}),onValueChanged:function(a){}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:1,dataField:"MDA_CVEMONEDA",editorType:"dxSelectBox",label:{text:"Costo Planeado"},editorOptions:{searchEnabled:!0,displayExpr:"MDA_DESCRIPCION",valueExpr:"MDA_CVEMONEDA",dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.CustomStore({key:"CAT_PROVEEDOR_INFRA_CSC",
loadMode:"raw",paginate:!1,load:async function(){return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat","GET",{Tbl:"SAMT_MONEDAS",NACTIVE:"MDA_MONEDABASE"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return jslinq(a.JsonData).orderBy(function(b){return b.MDA_DESCRIPCION}).toList();console.log(a.message)})}})}),onValueChanged:function(a){}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:1,dataField:"OTR_COSTO",editorType:"dxNumberBox",label:{text:"$"},
editorOptions:{valueChangeEvent:"keyup",useMaskBehavior:!0,format:"$ #,##0.##",min:0,value:null,onValueChanged:function(a){}}},{colSpan:1,dataField:"MDA_CVEMONEDA_TOTAL",editorType:"dxSelectBox",label:{text:"Costo Real"},editorOptions:{searchEnabled:!0,displayExpr:"MDA_DESCRIPCION",valueExpr:"MDA_CVEMONEDA",dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.CustomStore({key:"CAT_PROVEEDOR_INFRA_CSC",loadMode:"raw",paginate:!1,load:async function(){return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+
"Get_Cat","GET",{Tbl:"SAMT_MONEDAS",NACTIVE:"MDA_MONEDABASE"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return jslinq(a.JsonData).orderBy(function(b){return b.MDA_DESCRIPCION}).toList();console.log(a.message)})}})}),onValueChanged:function(a){}},validationRules:[{type:"required",message:"requerido"}]},{colSpan:1,dataField:"OTR_COSTO_TOTAL",editorType:"dxNumberBox",label:{text:"$"},editorOptions:{valueChangeEvent:"keyup",useMaskBehavior:!0,format:"$ #,##0.##",min:0,value:null,
onValueChanged:function(a){}}},{colSpan:2,dataField:"TIPO_CALIFICACION_CSC",editorType:"dxSelectBox",label:{text:"Calificacion"},editorOptions:{searchEnabled:!0,displayExpr:"TIPO_CALIFICACION_IDIOMA1",valueExpr:"TIPO_CALIFICACION_CSC",dataSource:new DevExpress.data.DataSource({loadMode:"raw",paginate:!1,load:async function(){try{var a={Tbl:"SAMT_TIPO_CALIFICACION",WHR:"EMP_CSC_EMPRESA_HOST = "+localStorage.getItem("EMP_CSC_EMPRESA_HOST")+" AND TIPO_CALIFICACION_ACTIVO = 1 "},b=c.Frm_Ot_Instance.getEditor("TIPO_CALIFICACION_CSC");
return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Whr","GET",a,getJSON(DeveloperType).ApiGeneral.token).then(e=>{if(1==e.success){if(1==c.setDefaultValues_Ots){var k=jslinq(e.JsonData).where(function(h){return 1==h.TIPO_CALIFICACION_DEFAULT}).toList();b.option("value",k[0].TIPO_CALIFICACION_CSC)}return e.JsonData}console.log(e.message)})}catch(e){console.log(e)}}}),onValueChanged:function(a){}}},{colSpan:2,dataField:"SAMT_CSC_CENTRO_COSTOS",editorType:"dxSelectBox",label:{text:"Centro de costos"},
editorOptions:{searchEnabled:!0,displayExpr:"SAMT_TIPO_CENTRO_IDIOMA1",valueExpr:"SAMT_CSC_CENTRO_COSTOS",dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.CustomStore({key:"SAMT_CSC_CENTRO_COSTOS",loadMode:"raw",paginate:!1,load:async function(){return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat","GET",{Tbl:"SAMT_TIPO_CENTRO_COSTOS",NACTIVE:"SAMT_TIPO_CENTRO_ACTIVO"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return jslinq(a.JsonData).orderBy(function(b){return b.SAMT_TIPO_CENTRO_IDIOMA1}).toList();
console.log(a.message)})}})}),onValueChanged:function(a){}},validationRules:[{type:"required",message:"requerido"}]}]},{dataField:"OTR_DESCRIPCION",editorType:"dxTextArea",colSpan:2,label:{text:"Descripci\u00f3n"},editorOptions:{height:58,valueChangeEvent:"keyup",onValueChanged:function(a){null!=a.value&&""!=a.value&&a.component.option("value",a.value.toUpperCase())}}},{dataField:"OTR_SOLUCION",editorType:"dxTextArea",colSpan:2,label:{text:"Detalle de soluci\u00f3n"},editorOptions:{height:58,valueChangeEvent:"keyup",
onValueChanged:function(a){null!=a.value&&""!=a.value&&a.component.option("value",a.value.toUpperCase())}}},{dataField:"OTR_CANCELACION",editorType:"dxTextArea",colSpan:2,label:{text:"Detalle de cancelaci\u00f3n"},editorOptions:{height:58,valueChangeEvent:"keyup",onValueChanged:function(a){null!=a.value&&""!=a.value&&a.component.option("value",a.value.toUpperCase())}}}]}]}).dxForm("instance");setTimeout(()=>{c.Run()},3E3);$("#Dg_Documentos_OrdenTrabajo").dxDataGrid({headerFilter:{visible:!1},keyExpr:"FOTO_GENERAL_CSC",
selection:{mode:"single"},scrolling:{useNative:!1,scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always"},groupPanel:{visible:!1},grouping:{autoExpandAll:!0},paging:{enabled:!1,pageIndex:0,pageSize:20},hoverStateEnabled:!0,showBorders:!0,showRowLines:!1,showColumnLines:!0,rowAlternationEnabled:!0,columnAutoWidth:!0,columns:[{caption:"DOCUMENTO",dataField:"FOTO_DESCRIPCION",alignment:"left"},{caption:"FECHA DE ALTA",dataField:"FOTO_FECHA_ALTA",alignment:"left",cellTemplate:function(a,b){$("<div>").append(ConvertToDateSting(b.value,
"ddmmyyyyhhmmss")).appendTo(a)}}],onRowDblClick:function(a){console.log(a.data);window.open(a.data.FOTO_IMAGEN_RUTA)}});$("#Dg_Bitacota_OrdenTrabajo").dxDataGrid({deferRendering:!0,allowColumnResizing:!0,headerFilter:{visible:!1},keyExpr:"OTR_CSCORDENTRABAJO",remoteOperations:!1,searchPanel:{visible:!1,highlightCaseSensitive:!0},selection:{mode:"single"},scrolling:{mode:"virtual",showScrollbar:"always",useNative:!0},groupPanel:{visible:!1},grouping:{autoExpandAll:!0},paging:{enabled:!1,pageIndex:0,
pageSize:20},showBorders:!0,showRowLines:!0,showColumnLines:!0,rowAlternationEnabled:!0,columnAutoWidth:!0,columns:[{caption:"NOMBRE",dataField:"OTB_NOMBRE"},{caption:"DESCRIPCION",dataField:"OTB_DESCRIPCION"},{caption:"FECHA DE CAMBIO",dataField:"OTB_FECHAHORA",dataType:"date",format:"dd-MM-yyyy HH:mm:ss",sortIndex:1,sortOrder:"desc",calculateCellValue:function(a){return null!=a.OTB_FECHAHORA?ConvertStringToObjDateLong(a.OTB_FECHAHORA):null}}],onRowDblClick:function(a){}})};c.Run=function(){};c.Generar_Alta_OrdenTrabajo=
function(){var d=c.Frm_Ot_Instance,g=c.Frm_Ot_Instance.option("formData");!0===d.validate().isValid?(d=GetInsertData(g,d),d.AUDITORIA_USU_ALTA=m.EMPLEADO_CSC_EMPLEADO,d.AUDITORIA_USU_ULT_MOD=m.EMPLEADO_CSC_EMPLEADO,d.AUDITORIA_FEC_ALTA="GETDATE()",d.AUDITORIA_FEC_ULT_MOD="GETDATE()",d.OTR_FECHA_ALTA_CORTA="GETDATE()",d.OTR_FECHA_ALTA_HORA_COMPLETA="GETDATE()",d.EMP_CSC_EMPRESA_HOST=localStorage.getItem("EMP_CSC_EMPRESA_HOST"),d.CLIENTE_CSC=m.CLIENTE_CSC,d.PM_CSC_PROYECTO=m.PM_CSC_PROYECTO,d.CAM_CSC_SERVICIO=
m.CAM_CSC_SERVICIO,d.OTR_FECHA_ALTA&&(d.OTR_FECHA_ALTA=ConvertDatetimeToStringBD(d.OTR_FECHA_ALTA)),d.OTR_FECHA_PROMESA&&(d.OTR_FECHA_PROMESA=ConvertDatetimeToStringBD(d.OTR_FECHA_PROMESA)),d.OTR_FECHA_PROGRAMADA&&(d.OTR_FECHA_PROGRAMADA=ConvertDatetimeToStringBD(d.OTR_FECHA_PROGRAMADA)),""==d.OTR_CSCORDENTRABAJO&&delete d.OTR_CSCORDENTRABAJO,1==d.TIC_CERRADO&&(d.OTR_FECHA_CIERRE="GETDATE()"),d={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),Type:localStorage.getItem("Type"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),
DATA_INSERT:d},console.log(d),__Reques_ajax(getJSON(DeveloperType).ApiOrdenTrabajo_v2.url+"Insert_Orden_Trabajo","POST",JSON.stringify(d),getJSON(DeveloperType).ApiOrdenTrabajo_v2.token).then(a=>{1==a.success?(l.hide(),DevExpress.ui.notify("Ticket insertado correctamente","success",4E3),$Btn_Alta_OrdenTrabajo.option("visible",!0),$btn_Modificar_OrdenTrabajo.option("visible",!0),$btn_Cancelar_Alta_OrdenTrabajo.option("visible",!1),$btn_Salvar_Alta_OrdenTrabajo.option("visible",!1),c.Frm_Ot_Instance.option("readOnly",
!0),c.Get_OrdenTrabajos({OTR_NEWID:g.OTR_NEWID},!0,null)):l.hide();return a}).catch(function(a){l.hide();DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE","error",3E3)})):DevExpress.ui.notify({message:"Llene los campos en rojo",position:{my:"bottom center",at:"bottom center"}},"error",1E4)};c.Get_OrdenTrabajos=function(d,g,a){l.show();a={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),Type:localStorage.getItem("Type")};
d=Object.assign(a,d);__Reques_ajax(getJSON(DeveloperType).ApiOrdenTrabajo_v2.url+"Get_Orden_Trabajo","GET",d,getJSON(DeveloperType).ApiOrdenTrabajo_v2.token).then(b=>{if(1==b.success){l.hide();var e=b.JsonData[0];e.OTR_FECHA_CIERRE&&(e.OTR_FECHA_CIERRE=ConvertStringToObjDateLong(e.OTR_FECHA_CIERRE));e.OTR_FECHA_PROMESA&&(e.OTR_FECHA_PROMESA=ConvertStringToObjDateLong(e.OTR_FECHA_PROMESA));e.OTR_FECHA_ALTA&&(e.OTR_FECHA_ALTA=ConvertStringToObjDateLong(e.OTR_FECHA_ALTA));e.OTR_FECHA_PROGRAMADA&&(e.OTR_FECHA_PROGRAMADA=
ConvertStringToObjDateLong(e.OTR_FECHA_PROGRAMADA));var k=JSON.stringify(e);c.DataOtOpen=JSON.parse(k);c.Frm_Ot_Instance.updateData(c.DataOtOpen);setTimeout(()=>{c.Get_Bitacora_OrdenTrabajos(e.OTR_CSCORDENTRABAJO);c.Get_Archivos_BD(e.OTR_CSCORDENTRABAJO)},3E3);1==g&&($("#Pop_Notificacion").dxPopup("instance").option("height",300),$("#Pop_Notificacion").dxPopup("instance").option("width",360),$("#Pop_Notificacion").dxPopup("instance").option("contentTemplate",function(){return $("<div>").append($("<div class='popup-property-details'>").append($('<div class="Nice-Shadow-1" style="padding: 9px;">ORDEN DE TRABAJO GENERADA</div>'),
$('<div class="content">').append($('<img style=" width: 200px; height: 150px;" src="images/Icons/success_ticket.gif" alt="">'),$('<div style="flex-grow: 1; font-size: 20px; font-weight: bold;">No. Ot: '+b.JsonData[0].OTR_CSCORDENTRABAJO+"</div>"),$('<div style="flex-grow: 1; font-size: 12px;">GUARDE SU NUMERO DE OT PARA FUTURAS CONSULTAS</div>'))))}),$("#Pop_Notificacion").dxPopup("show"))}else l.hide(),DevExpress.ui.notify("OT NO LOCALIZADO","error",3E3);return b}).catch(function(b){l.hide();console.log(b);
DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE","error",3E3)})};c.Get_Bitacora_OrdenTrabajos=function(d){d={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),Type:localStorage.getItem("Type"),OTR_CSCORDENTRABAJO:d};__Reques_ajax(getJSON(DeveloperType).ApiOrdenTrabajo_v2.url+"Get_Ot_Bitacora","GET",d,getJSON(DeveloperType).ApiOrdenTrabajo_v2.token).then(g=>{1==g.success?(console.log(g.JsonData),$("#Dg_Bitacota_OrdenTrabajo").dxDataGrid("instance").option("dataSource",
g.JsonData)):$("#Dg_Bitacota_OrdenTrabajo").dxDataGrid("instance").option("dataSource",[])}).catch(function(g){DevExpress.ui.notify("ERROR EN COMUNICACION AL SERVIDOR, INTENTELO NUEVAMENTE","error",3E3);$("#Dg_Bitacota_OrdenTrabajo").dxDataGrid("instance").option("dataSource",[])})};c.Get_Archivos_BD=function(){var d=c.Frm_Ot_Instance.option("formData");d={EMP_CLV_EMPRESA:localStorage.getItem("EMP_CLV_EMPRESA"),Type:localStorage.getItem("Type"),EMP_CSC_EMPRESA_HOST:localStorage.getItem("EMP_CSC_EMPRESA_HOST"),
TIPO_ORIGEN_CSC:t[0].TIPO_ORIGEN_CSC,FOTO_CSC_EXTERNO:d.OTR_CSCORDENTRABAJO};__Reques_ajax(getJSON(DeveloperType).ApiGeneral.url+"Get_Archivos_General","GET",d,getJSON(DeveloperType).ApiGeneral.token).then(g=>{1==g.success?$("#Dg_Documentos_OrdenTrabajo").dxDataGrid("instance").option("dataSource",g.JsonData):(console.log(g),l.hide())})}};setTimeout(()=>{SalesDashboard.currentModel=new SalesDashboard.dashboardModel;SalesDashboard.currentModel.init()},1E3);
