SalesDashboard.dashboardModel=function(){var h=this;this.infoEmpleado=[];this.servEmpleado=[];this.onlyVideoService=[];this.EstatusEquipo=[];var l={},m={},p=null,n=io.connect("https://realtime.dnasystem.io",{forceNew:!0}),q=Highcharts.chart("agts-container-rpm",{chart:{type:"solidgauge"},credits:{enabled:!1},title:!1,exporting:!1,tooltip:!1,pane:{startAngle:0,endAngle:360,background:[{outerRadius:"112%",innerRadius:"88%",backgroundColor:Highcharts.color(Highcharts.getOptions().colors[0]).setOpacity(.3).get(),
borderWidth:0}]},yAxis:{min:0,max:100,lineWidth:0,tickPositions:[]},plotOptions:{solidgauge:{dataLabels:{y:-10,borderWidth:0,format:'<div style="text-align:center"><span style="font-size:14px;color: black">{point.y}%</span></div>'},linecap:"round",stickyTracking:!0,rounded:!0}},series:[{name:"%OCC",data:[{color:{radialGradient:{cx:.5,cy:.3,r:.7},stops:[[0,"#FFD54C"],[1,"#FF630A"]]},radius:"112%",innerRadius:"88%",y:0}]}]}),r=Highcharts.chart("agts-container-sla",{chart:{type:"solidgauge"},credits:{enabled:!1},
title:!1,exporting:!1,tooltip:!1,pane:{startAngle:0,endAngle:360,background:[{outerRadius:"112%",innerRadius:"88%",backgroundColor:Highcharts.color(Highcharts.getOptions().colors[0]).setOpacity(.3).get(),borderWidth:0}]},yAxis:{min:0,max:100,lineWidth:0,tickPositions:[]},plotOptions:{solidgauge:{dataLabels:{y:-10,borderWidth:0,format:'<div style="text-align:center"><span style="font-size:14px;color: black">{point.y}%</span></div>'},linecap:"round",stickyTracking:!0,rounded:!0}},series:[{name:"%OCC",
data:[{color:{radialGradient:{cx:.5,cy:.3,r:.7},stops:[[0,"#FFD54C"],[1,"#FF630A"]]},radius:"112%",innerRadius:"88%",y:0}]}]}),t=Highcharts.chart("agts-container-cont",{chart:{type:"solidgauge"},credits:{enabled:!1},title:!1,exporting:!1,tooltip:!1,pane:{startAngle:0,endAngle:360,background:[{outerRadius:"112%",innerRadius:"88%",backgroundColor:Highcharts.color(Highcharts.getOptions().colors[0]).setOpacity(.3).get(),borderWidth:0}]},yAxis:{min:0,max:100,lineWidth:0,tickPositions:[]},plotOptions:{solidgauge:{dataLabels:{y:-10,
borderWidth:0,format:'<div style="text-align:center"><span style="font-size:14px;color: black">{point.y}%</span></div>'},linecap:"round",stickyTracking:!0,rounded:!0}},series:[{name:"%OCC",data:[{color:{radialGradient:{cx:.5,cy:.3,r:.7},stops:[[0,"#FFD54C"],[1,"#FF630A"]]},radius:"112%",innerRadius:"88%",y:0}]}]});h.removeByKey=function(d,a){d.some(function(b,f){return d[f][a.CAM_CSC_SERVICIO]===a.CAM_CSC_SERVICIO?!!d.splice(f,1):!1});return d};h.init=function(){$("#splashscreen").fadeOut(1E3);Globalize.loadMessages(dictionary);
var d=function(){var a=sessionStorage.getItem("locale");return null!=a?a:"es-mx"}();Globalize.locale(d);DevExpress.localization.locale(d);this.infoEmpleado=JSON.parse(localStorage.getItem("obj_DatosEmpleado"));this.servEmpleado=JSON.parse(sessionStorage.getItem("serv_empl"));this.onlyVideoService=jslinq(this.servEmpleado).where(function(a){return 3==a.TIPO_SERVICIO_CAM_CSC}).toList();try{__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_CAM_ESTATUS_PRESENCIA_SOLICITUD",
NACTIVE:"ESTATUS_SOLICITUD_ACTIVO",NDEFAULT:"ESTATUS_SOLICITUD_DEFAULT"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return l=a.JsonData;console.log(a.message)})}catch(a){console.log(a)}try{__Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_CAM_TIPO_ESTATUS_OPERACION",NACTIVE:"TIPO_ESTATUS_ACTIVO",NDEFAULT:"TIPO_ESTATUS_DEFAULT"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return m=a.JsonData;console.log(a.message)})}catch(a){console.log(a)}$("#Mod_Agte_BarraFiltro").dxToolbar({items:[{template:function(){return $("<div class='toolbar-label' style='margin-left:5px;'><b> Campa\u00f1as:</div>")}},
{widget:"dxSelectBox",options:{dataSource:this.onlyVideoService,displayExpr:"CAM_SERVICIO_NOMBRE",valueExpr:"CAM_CSC_SERVICIO",onContentReady(a){let b=a.component.getDataSource().items();1<=b.length&&(a.component.option("value",b[0].CAM_CSC_SERVICIO),console.log(b[0].CAM_CSC_SERVICIO))},deferRendering:!1,readOnly:!1,label:{text:"Estatus de Documento"},validationRules:[{type:"required",message:"Seleccione campa\u00f1a"}],onValueChanged:function(a){p=a.value}}}]});$("#gridFilaEspera").dxDataGrid({selection:{mode:"single"},
height:"100%",paging:{enabled:!1,pageIndex:0,pageSize:20},headerFilter:{visible:!0},allowColumnReordering:!0,rowAlternationEnabled:!0,showBorders:!0,filterRow:{visible:!0,applyFilter:"auto"},repaintChangesOnly:!0,highlightChanges:!0,loadPanel:{enabled:!1},columns:[{caption:"FILA DE ESPERA",dataField:"ESTATUS_SOLICITUD_IDIOMA1",cellTemplate:function(a,b){var f=b.data.ESTATUS_SOLICITUD_CLAVE,k=b.data.TESTATUS,g=b.data.PRESENCIA_SOLICITUD_ORIGEN;$("<div>").append($("<img>",{src:"images/Icons/"+f+".gif"}).css({height:"32px",
width:"32px","float":"left","margin-right":"2px"})).append("<div>"+b.value+" "+k+"</div>").css({"font-size":"10px"}).append("<div>"+g+"</div>").css({"font-size":"9px"}).appendTo(a)}}]});$("#GridEqDesconectados").dxDataGrid({selection:{mode:"single"},height:"100%",paging:{enabled:!1,pageIndex:0,pageSize:20},headerFilter:{visible:!0},allowColumnReordering:!0,rowAlternationEnabled:!0,showBorders:!0,filterRow:{visible:!0,applyFilter:"auto"},repaintChangesOnly:!0,highlightChanges:!0,loadPanel:{enabled:!1},
columns:[{caption:"EQUIPOS DESCONECTADOS",dataField:"REQ_NOMBREAREA",cellTemplate:function(a,b){var f=b.data.TIPO_DISPOSITIVO_CLAVE;$("<div>").append($("<img>",{src:"images/Icons/"+f+".png"}).css({height:"24px",width:"24px","float":"left","margin-right":"2px"})).append("<div>"+b.value+"</div>").css({"line-height":"2"}).appendTo(a)}}]});$("#gridAgentes").dxDataGrid({selection:{mode:"single"},height:"100%",paging:{enabled:!1,pageIndex:0,pageSize:20},rowAlternationEnabled:!0,showBorders:!0,filterRow:{visible:!1,
applyFilter:"auto"},repaintChangesOnly:!0,highlightChanges:!0,loadPanel:{enabled:!1},onRowDblClick:async function(a){},columns:[{caption:"ID",dataField:"CAM_CSC_SERVICIO"},{caption:"AGENTE",dataField:"EMPLEADO_NOMBREEMPLEADO",cellTemplate:function(a,b){b=b.data.EMPLEADO_NOMBREEMPLEADO+" "+b.data.EMPLEADO_APATERNOEMPLEADO+" "+b.data.EMPLEADO_AMATERNOEMPLEADO;$("<div>").append("<div>"+b+"</div>").appendTo(a)}},{caption:"TIEMPO TOTAL FIRMADO",dataField:"TFIRMADO",cellTemplate:function(a,b){$("<div>").append("<div>"+
b.value+"</div>").appendTo(a)}},{caption:"CAMPA\u00d1A",groupIndex:1,dataField:"CAM_CSC_SERVICIO",width:200,lookup:{dataSource:this.onlyVideoService,displayExpr:"CAM_SERVICIO_NOMBRE",valueExpr:"CAM_CSC_SERVICIO"}},{caption:"ESTATUS",dataField:"ESTATUS_PRESENCIA_CSC",width:200,lookup:{dataSource:{store:new DevExpress.data.CustomStore({loadMode:"raw",paginate:!1,load:async function(){try{return __Get_catalogos(getJSON(DeveloperType).ApiGeneral.url+"Get_Cat_Full","GET",{Tbl:"SAMT_CAM_ESTATUS_PRESENCIA",
NACTIVE:"ESTATUS_ACTIVO",NDEFAULT:"ESTATUS_DEFAULT"},getJSON(DeveloperType).ApiGeneral.token).then(a=>{if(1==a.success)return a.JsonData;console.log(a.message)})}catch(a){console.log(a)}}})},displayExpr:"ESTATUS_IDIOMA1",valueExpr:"ESTATUS_PRESENCIA_CSC"}},{caption:"TIEMPO EN ESTATUS",dataField:"TULTIMOSTATUS",cellTemplate:function(a,b){$("<div>").append("<div>"+b.value+"</div>").appendTo(a)}}]});$("#PopVideoLlamada").dxPopup({hideOnOutsideClick:!0,title:"Video Llamada",height:function(){return 550},
width:function(){return 500},position:{my:"center",at:"center",of:window},onHiding:function(a){document.getElementById("Mod_Embebed_VideoRealTime").src=""},onShowing:function(a){},onShown:function(a){a=$("#gridAgentes").dxDataGrid("instance").getSelectedRowsData();console.log(a[0]);document.getElementById("Mod_Embebed_VideoRealTime").src="../MonitoreoVideoLlamada/?roomName="+a[0].PRESENCIA_SOLICITUD_NEWID}});n.on(localStorage.getItem("EMP_CLV_EMPRESA")+"_SOLICITUDES",function(a){var b=l.find(c=>"HANGUP"==
c.ESTATUS_SOLICITUD_CLAVE).ESTATUS_CAM_SOLICITUD_CSC;a=a.JsonData;a=jslinq(a).where(function(c){return c.CAM_CSC_SERVICIO==p}).toList();jslinq(a).where(function(c){return c.ESTATUS_CAM_SOLICITUD_CSC!=b}).toList();var f=l.find(c=>"FILA"==c.ESTATUS_SOLICITUD_CLAVE).ESTATUS_CAM_SOLICITUD_CSC,k=jslinq(a).where(function(c){return c.ESTATUS_CAM_SOLICITUD_CSC==f}).toList();$("#QueueAgentes").html(k.length);$("#gridFilaEspera").dxDataGrid("instance").option("dataSource",k);var g=l.find(c=>"CONECT"==c.ESTATUS_SOLICITUD_CLAVE).ESTATUS_CAM_SOLICITUD_CSC;
a=jslinq(a).where(function(c){return c.ESTATUS_CAM_SOLICITUD_CSC==g}).toList();$("#InCallAgentes").html(a.length)});n.on(localStorage.getItem("EMP_CLV_EMPRESA")+"_AGENTES",function(a){a=jslinq(a.JsonData).where(function(b){return 785==b.CAM_CSC_SERVICIO||786==b.CAM_CSC_SERVICIO||787==b.CAM_CSC_SERVICIO||788==b.CAM_CSC_SERVICIO}).toList();$("#gridAgentes").dxDataGrid("instance").option("dataSource",a)});n.on(localStorage.getItem("EMP_CLV_EMPRESA")+"_CDR",function(a){a=jslinq(a.JsonData).groupBy(function(e){return e.SAMT_CAM_TIPO_SERVICIO_CSC}).toList();
if(0==a.length)$("#TotalLlamadasAgentes").html(0),$("#TotalAbandonoAgentes").html(0),$("#TotalContestadasAgentes").html(0),$("#ahtAgente").html(0),$("#AsaAgente").html(0),$("#PorcentajeAbaAgentes").html("-"),$("#PorcentajeSLAAgentes").html("-"),$("#PorcentajeContestadasAgentes").html("-");else{$("#TotalLlamadasAgentes").html(a[0].count);var b=m.find(e=>"ABA"==e.TIPO_ESTATUS_CLAVE),f=jslinq(a[0].elements).where(function(e){return e.CDR_ESTATUS_OPERACION==b.SAMT_CAM_TIPO_ESTATUS_CSC}).toList();$("#TotalAbandonoAgentes").html(f.length);
var k=m.find(e=>"NCH"==e.TIPO_ESTATUS_CLAVE),g=jslinq(a[0].elements).where(function(e){return e.CDR_ESTATUS_OPERACION==k.SAMT_CAM_TIPO_ESTATUS_CSC}).toList();$("#TotalContestadasAgentes").html(g.length);var c=jslinq(g).average(function(e){return e.CDR_TIEMPO_DE_LLAMADA}),u=jslinq(g).sum(function(e){return e.CDR_TIEMPO_FILA_ESPERA}),v=jslinq(g).where(function(e){return 20>=e.CDR_TIEMPO_FILA_ESPERA}).toList();$("#ahtAgente").html(h.secondsToString(c));$("#AsaAgente").html(h.secondsToString(u));c=v.length/
a[0].count*100;f=f.length/a[0].count*100;a=g.length/a[0].count*100;pointAba=q.series[0].points[0];newValAba=incAba=parseFloat(f.toFixed(2));pointAba.update(newValAba);pointSLA=r.series[0].points[0];newValSLA=incSLA=parseFloat(c.toFixed(2));pointSLA.update(newValSLA);pointCont=t.series[0].points[0];newValCont=incCont=parseFloat(a.toFixed(2));pointCont.update(newValCont)}});setTimeout(()=>{h.Run()},500)};h.secondsToString=function(d){var a=Math.floor(d/3600),b=Math.floor(d/60%60);d=Math.trunc(d)%60;
return(10>a?"0"+a:a)+":"+(10>b?"0"+b:b)+":"+(10>d?"0"+d:d)};h.Run=function(){}};setTimeout(()=>{SalesDashboard.currentModel=new SalesDashboard.dashboardModel;SalesDashboard.currentModel.init()},1E3);
